!function(){return function e(t,n,r){function o(s,a){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){return o(t[s][1][e]||e)},l,l.exports,e,t,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}}()({1:[function(e,t,n){t.exports=function(e){var t=this;e=e||{},t.type=e.type||"cache-module",t.verbose=e.verbose||!1,t.defaultExpiration=e.defaultExpiration||900,t.readOnly=e.readOnly||!1,t.checkOnPreviousEmpty="boolean"!=typeof e.checkOnPreviousEmpty||e.checkOnPreviousEmpty,t.backgroundRefreshIntervalCheck="boolean"!=typeof e.backgroundRefreshIntervalCheck||e.backgroundRefreshIntervalCheck,t.backgroundRefreshInterval=e.backgroundRefreshInterval||6e4,t.backgroundRefreshMinTtl=e.backgroundRefreshMinTtl||7e4;var n,r,o=null,i=e.storageMock||!1,s=!1,a="undefined"!=typeof window,u={db:{},expirations:{},refreshKeys:{}};function c(){if(a&&o||i){var e=u;try{e=JSON.stringify(e),o.setItem(n,e)}catch(e){}}}function l(e,t){if(e)throw new Error(t)}function d(){Object.keys(u.refreshKeys).forEach(function(e){var t=u.refreshKeys[e];t.expiration-Date.now()<this.backgroundRefreshMinTtl&&t.refresh(e,function(e,t,n,r){n||this.set(e,r,t.lifeSpan/1e3,t.refresh,function(){})}.bind(this,e,t))},t)}function f(e,n,r){(t.verbose||e)&&(r?console.log(t.type+": "+n,r):console.log(t.type+n))}!function(){if(a||i){if(i)o=i,n="cache-module-storage-mock";else{var r="local"===e.storage||"session"===e.storage?e.storage:null;o=!(!r||void 0===typeof Storage)&&window[r+"Storage"],n=r?t.type+"-"+r+"-storage":null}if(o){var s=o.getItem(n);try{u=JSON.parse(s)||u}catch(e){}}else r&&f(!0,"Browser storage is not supported by this browser. Defaulting to an in-memory cache.")}}(),f(!1,"Cache-module client created with the following defaults:",{type:t.type,defaultExpiration:t.defaultExpiration,verbose:t.verbose,readOnly:t.readOnly}),t.get=function(e,t){l(arguments.length<2,"ARGUMENT_EXCEPTION: .get() requires 2 arguments."),f(!1,"get() called:",{key:e});try{var n=Date.now();if(u.expirations[e]>n){var r=u.db[e];"object"==typeof r&&(o=r,r=JSON.parse(JSON.stringify(o))),t(null,r)}else!function(e){delete u.db[e],delete u.expirations[e],c()}(e),t(null,null)}catch(e){t({name:"GetException",message:e},null)}var o},t.mget=function(e,n,r){l(arguments.length<2,"ARGUMENT_EXCEPTION: .mget() requires 2 arguments."),f(!1,".mget() called:",{keys:e});for(var o={},i=0;i<e.length;i++){var s=e[i];t.get(s,function(e,t){null!==t&&(o[s]=t)})}n(null,o,r)},t.set=function(){l(arguments.length<2,"ARGUMENT_EXCEPTION: .set() requires at least 2 arguments.");var e=arguments[0],n=arguments[1],o=arguments[2]||null,i=5==arguments.length?arguments[3]:null,a=5==arguments.length?arguments[4]:arguments[3];if(f(!1,".set() called:",{key:e,value:n}),!t.readOnly)try{var h=(o=o?1e3*o:1e3*t.defaultExpiration)+Date.now();u.expirations[e]=h,u.db[e]=n,a&&a(),i&&(u.refreshKeys[e]={expiration:h,lifeSpan:o,refresh:i},function(){if(!s){if(s=!0,t.backgroundRefreshIntervalCheck&&t.backgroundRefreshInterval>t.backgroundRefreshMinTtl)throw new Error("BACKGROUND_REFRESH_INTERVAL_EXCEPTION: backgroundRefreshInterval cannot be greater than backgroundRefreshMinTtl.");r=setInterval(d,t.backgroundRefreshInterval)}}()),c()}catch(e){f(!0,".set() failed for cache of type "+t.type,{name:"CacheModuleSetException",message:e})}},t.mset=function(e,n,r){for(var o in l(arguments.length<1,"ARGUMENT_EXCEPTION: .mset() requires at least 1 argument."),f(!1,".mset() called:",{data:e}),e)if(e.hasOwnProperty(o)){var i=n||t.defaultExpiration,s=e[o];"object"==typeof s&&s.cacheValue&&(i=s.expiration||i,s=s.cacheValue),t.set(o,s,i)}r&&r()},t.del=function(e,t){if(l(arguments.length<1,"ARGUMENT_EXCEPTION: .del() requires at least 1 argument."),f(!1,".del() called:",{keys:e}),"object"==typeof e){for(var n=0;n<e.length;n++){var r=e[n];delete u.db[r],delete u.expirations[r],delete u.refreshKeys[r]}t&&t(null,e.length)}else delete u.db[e],delete u.expirations[e],delete u.refreshKeys[e],t&&t(null,1);c()},t.flush=function(e){f(!1,".flush() called"),u.db={},u.expirations={},u.refreshKeys={},e&&e(),c(),r&&clearInterval(r),s=!1}}},{}],2:[function(e,t,n){function r(e){if(e)return function(e){for(var t in r.prototype)e[t]=r.prototype[t];return e}(e)}void 0!==t&&(t.exports=r),r.prototype.on=r.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},r.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var o=0;o<r.length;o++)if((n=r[o])===t||n.fn===t){r.splice(o,1);break}return 0===r.length&&delete this._callbacks["$"+e],this},r.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(n){r=0;for(var o=(n=n.slice(0)).length;r<o;++r)n[r].apply(this,t)}return this},r.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},r.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],3:[function(e,t,n){!function(e,n){void 0!==t?t.exports=n():"function"==typeof define&&"object"==typeof define.amd?define(n):this.domready=n()}(0,function(e){var t,n=[],r=document,o=r.documentElement,i=o.doScroll,s=(i?/^loaded|^c/:/^loaded|c/).test(r.readyState);function a(e){for(s=1;e=n.shift();)e()}return r.addEventListener&&r.addEventListener("DOMContentLoaded",t=function(){r.removeEventListener("DOMContentLoaded",t,!1),a()},!1),i&&r.attachEvent("onreadystatechange",t=function(){/^c/.test(r.readyState)&&(r.detachEvent("onreadystatechange",t),a())}),e=i?function(t){self!=top?s?t():n.push(t):function(){try{o.doScroll("left")}catch(n){return setTimeout(function(){e(t)},50)}t()}()}:function(e){s?e():n.push(e)}})},{}],4:[function(e,t,n){var r=e("./utils");t.exports=function(e,t){var n=this,o=["GET","HEAD","POST","PUT","PATCH","DELETE"],i=["GET","HEAD"];return this.cache=e,this.defaults=t||{},function(t){var s=r.resetProps(n.defaults);t.doQuery=function(e){return s.doQuery=e,t},t.pruneQuery=function(e){return s.pruneQuery=e,t},t.pruneHeader=function(e){return s.pruneHeader=e,t},t.prune=function(e){return s.prune=e,t},t.responseProp=function(e){return s.responseProp=e,t},t.expiration=function(e){return s.expiration=e,t},t.cacheWhenEmpty=function(e){return s.cacheWhenEmpty=e,t},t.forceUpdate=function(e){return s.forceUpdate="boolean"!=typeof e||e,t};var a=t.end;return t.end=function(n){if(t.scRedirectsList=t.scRedirectsList||[],t.scRedirectsList=t.scRedirectsList.concat(t._redirectList),~o.indexOf(t.method.toUpperCase())){var u=t,c=r.keygen(t,s);~i.indexOf(t.method.toUpperCase())?e.get(c,function(o,i){if(o||!i||s.forceUpdate){if(!s.doQuery)return r.callbackExecutor(n,null,null,c);a.call(t,function(t,o){if(t)return r.callbackExecutor(n,t,o,c);if(!t&&o){if(o.redirects=u.scRedirectsList,o=s.prune?s.prune(o):s.responseProp?o[s.responseProp]||null:r.gutResponse(o),r.isEmpty(o)&&!s.cacheWhenEmpty)return r.callbackExecutor(n,t,o,c);e.set(c,o,s.expiration,function(){return r.callbackExecutor(n,t,o,c)})}})}else r.callbackExecutor(n,o,i,c)}):a.call(t,function(t,o){if(t)return r.callbackExecutor(n,t,o,c);if(!t&&o){var i=c.replace('"method":"'+u.method+'"','"method":"GET"'),s=c.replace('"method":"'+u.method+'"','"method":"HEAD"');e.del([i,s],function(){r.callbackExecutor(n,t,o,c)})}})}else a.call(t,function(e,t){return r.callbackExecutor(n,e,t,void 0)})},t}}},{"./utils":5}],5:[function(e,t,n){t.exports={keygen:function(e,t){var n=null,r=null,o=this.getQueryParams(e),i=this.getHeaderOptions(e);return(t.pruneQuery||t.pruneHeader)&&(n=t.pruneQuery?this.pruneObj(this.cloneObject(o),t.pruneQuery):o,r=t.pruneHeader?this.pruneObj(this.cloneObject(i),t.pruneHeader,!0):i),JSON.stringify({method:e.method,uri:e.url,params:n||o||null,options:r||i||null})},getQueryParams:function(e){return e&&e.qs&&!this.isEmpty(e.qs)?e.qs:e&&e.qsRaw?this.arrayToObj(e.qsRaw):e&&e.req?this.stringToObj(e.req.path):e&&e._query?this.stringToObj(e._query.join("&")):null},getHeaderOptions:function(e){return e&&e._header?this.pruneObj(e._header,["User-Agent","user-agent"]):e&&e.req&&e.req._headers?this.pruneObj(e.req._headers,["User-Agent","user-agent"]):e&&e.header?this.pruneObj(e.header,["User-Agent","user-agent"]):null},arrayToObj:function(e){if(e&&e.length){for(var t={},n=0;n<e.length;n++)for(var r=e[n].split("&"),o=0;o<r.length;o++){var i=r[o].split("=");t[i[0]]=i[1]}return t}return null},stringToObj:function(e){if(e){var t={};if(~e.indexOf("?")){var n=e.split("?");e=n[1]}for(var r=e.split("&"),o=0;o<r.length;o++){var i=r[o].split("=");t[i[0]]=i[1]}return t}return null},pruneObj:function(e,t,n){for(var r=0;r<t.length;r++){var o=t[r];n&&delete e[o.toLowerCase()],delete e[o]}return e},gutResponse:function(e){var t={};return t.body=e.body,t.text=e.text,t.headers=e.headers,t.statusCode=e.statusCode,t.status=e.status,t.ok=e.ok,t},isEmpty:function(e){return!1===e||null===e||"object"==typeof e&&0==Object.keys(e).length},cloneObject:function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},resetProps:function(e){return{doQuery:"boolean"!=typeof e.doQuery||e.doQuery,cacheWhenEmpty:"boolean"!=typeof e.cacheWhenEmpty||e.cacheWhenEmpty,prune:e.prune,pruneQuery:e.pruneQuery,pruneHeader:e.pruneHeader,responseProp:e.responseProp,expiration:e.expiration,forceUpdate:e.forceUpdate,preventDuplicateCalls:e.preventDuplicateCalls,backgroundRefresh:e.backgroundRefresh}},callbackExecutor:function(e,t,n,r){if(1===e.length)e(n);else{if(!(e.length>1))throw new Error("UnsupportedCallbackException: Your .end() callback must pass at least one argument.");e(t,n,r)}}}},{}],6:[function(e,t,n){function r(){this._defaults=[]}["use","on","once","set","query","type","accept","auth","withCredentials","sortQuery","retry","ok","redirects","timeout","buffer","serialize","parse","ca","key","pfx","cert"].forEach(function(e){r.prototype[e]=function(){return this._defaults.push({fn:e,arguments:arguments}),this}}),r.prototype._setDefaults=function(e){this._defaults.forEach(function(t){e[t.fn].apply(e,t.arguments)})},t.exports=r},{}],7:[function(e,t,n){var r;"undefined"!=typeof window?r=window:"undefined"!=typeof self?r=self:(console.warn("Using browser-only version of superagent in non-browser environment"),r=this);var o=e("component-emitter"),i=e("./request-base"),s=e("./is-object"),a=e("./response-base"),u=e("./agent-base");function c(){}var l=n=t.exports=function(e,t){return"function"==typeof t?new n.Request("GET",e).end(t):1==arguments.length?new n.Request("GET",e):new n.Request(e,t)};n.Request=y,l.getXHR=function(){if(!(!r.XMLHttpRequest||r.location&&"file:"==r.location.protocol&&r.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}throw Error("Browser-only version of superagent could not find XHR")};var d="".trim?function(e){return e.trim()}:function(e){return e.replace(/(^\s*|\s*$)/g,"")};function f(e){if(!s(e))return e;var t=[];for(var n in e)h(t,n,e[n]);return t.join("&")}function h(e,t,n){if(null!=n)if(Array.isArray(n))n.forEach(function(n){h(e,t,n)});else if(s(n))for(var r in n)h(e,t+"["+r+"]",n[r]);else e.push(encodeURIComponent(t)+"="+encodeURIComponent(n));else null===n&&e.push(encodeURIComponent(t))}function p(e){for(var t,n,r={},o=e.split("&"),i=0,s=o.length;i<s;++i)-1==(n=(t=o[i]).indexOf("="))?r[decodeURIComponent(t)]="":r[decodeURIComponent(t.slice(0,n))]=decodeURIComponent(t.slice(n+1));return r}function g(e){return/[\/+]json($|[^-\w])/.test(e)}function m(e){this.req=e,this.xhr=this.req.xhr,this.text="HEAD"!=this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||void 0===this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText;var t=this.xhr.status;1223===t&&(t=204),this._setStatusProperties(t),this.header=this.headers=function(e){for(var t,n,r,o,i=e.split(/\r?\n/),s={},a=0,u=i.length;a<u;++a)-1!==(t=(n=i[a]).indexOf(":"))&&(r=n.slice(0,t).toLowerCase(),o=d(n.slice(t+1)),s[r]=o);return s}(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this._setHeaderProperties(this.header),null===this.text&&e._responseType?this.body=this.xhr.response:this.body="HEAD"!=this.req.method?this._parseBody(this.text?this.text:this.xhr.response):null}function y(e,t){var n=this;this._query=this._query||[],this.method=e,this.url=t,this.header={},this._header={},this.on("end",function(){var e,t=null,r=null;try{r=new m(n)}catch(e){return(t=new Error("Parser is unable to parse the response")).parse=!0,t.original=e,n.xhr?(t.rawResponse=void 0===n.xhr.responseType?n.xhr.responseText:n.xhr.response,t.status=n.xhr.status?n.xhr.status:null,t.statusCode=t.status):(t.rawResponse=null,t.status=null),n.callback(t)}n.emit("response",r);try{n._isResponseOK(r)||(e=new Error(r.statusText||"Unsuccessful HTTP response"))}catch(t){e=t}e?(e.original=t,e.response=r,e.status=r.status,n.callback(e,r)):n.callback(null,r)})}function v(e,t,n){var r=l("DELETE",e);return"function"==typeof t&&(n=t,t=null),t&&r.send(t),n&&r.end(n),r}l.serializeObject=f,l.parseString=p,l.types={html:"text/html",json:"application/json",xml:"text/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},l.serialize={"application/x-www-form-urlencoded":f,"application/json":JSON.stringify},l.parse={"application/x-www-form-urlencoded":p,"application/json":JSON.parse},a(m.prototype),m.prototype._parseBody=function(e){var t=l.parse[this.type];return this.req._parser?this.req._parser(this,e):(!t&&g(this.type)&&(t=l.parse["application/json"]),t&&e&&(e.length||e instanceof Object)?t(e):null)},m.prototype.toError=function(){var e=this.req,t=e.method,n=e.url,r="cannot "+t+" "+n+" ("+this.status+")",o=new Error(r);return o.status=this.status,o.method=t,o.url=n,o},l.Response=m,o(y.prototype),i(y.prototype),y.prototype.type=function(e){return this.set("Content-Type",l.types[e]||e),this},y.prototype.accept=function(e){return this.set("Accept",l.types[e]||e),this},y.prototype.auth=function(e,t,n){1===arguments.length&&(t=""),"object"==typeof t&&null!==t&&(n=t,t=""),n||(n={type:"function"==typeof btoa?"basic":"auto"});return this._auth(e,t,n,function(e){if("function"==typeof btoa)return btoa(e);throw new Error("Cannot use basic auth, btoa is not a function")})},y.prototype.query=function(e){return"string"!=typeof e&&(e=f(e)),e&&this._query.push(e),this},y.prototype.attach=function(e,t,n){if(t){if(this._data)throw Error("superagent can't mix .send() and .attach()");this._getFormData().append(e,t,n||t.name)}return this},y.prototype._getFormData=function(){return this._formData||(this._formData=new r.FormData),this._formData},y.prototype.callback=function(e,t){if(this._shouldRetry(e,t))return this._retry();var n=this._callback;this.clearTimeout(),e&&(this._maxRetries&&(e.retries=this._retries-1),this.emit("error",e)),n(e,t)},y.prototype.crossDomainError=function(){var e=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");e.crossDomain=!0,e.status=this.status,e.method=this.method,e.url=this.url,this.callback(e)},y.prototype.buffer=y.prototype.ca=y.prototype.agent=function(){return console.warn("This is not supported in browser version of superagent"),this},y.prototype.pipe=y.prototype.write=function(){throw Error("Streaming is not supported in browser version of superagent")},y.prototype._isHost=function(e){return e&&"object"==typeof e&&!Array.isArray(e)&&"[object Object]"!==Object.prototype.toString.call(e)},y.prototype.end=function(e){return this._endCalled&&console.warn("Warning: .end() was called twice. This is not supported in superagent"),this._endCalled=!0,this._callback=e||c,this._finalizeQueryString(),this._end()},y.prototype._end=function(){var e=this,t=this.xhr=l.getXHR(),n=this._formData||this._data;this._setTimeouts(),t.onreadystatechange=function(){var n=t.readyState;if(n>=2&&e._responseTimeoutTimer&&clearTimeout(e._responseTimeoutTimer),4==n){var r;try{r=t.status}catch(e){r=0}if(!r){if(e.timedout||e._aborted)return;return e.crossDomainError()}e.emit("end")}};var r=function(t,n){n.total>0&&(n.percent=n.loaded/n.total*100),n.direction=t,e.emit("progress",n)};if(this.hasListeners("progress"))try{t.onprogress=r.bind(null,"download"),t.upload&&(t.upload.onprogress=r.bind(null,"upload"))}catch(e){}try{this.username&&this.password?t.open(this.method,this.url,!0,this.username,this.password):t.open(this.method,this.url,!0)}catch(e){return this.callback(e)}if(this._withCredentials&&(t.withCredentials=!0),!this._formData&&"GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof n&&!this._isHost(n)){var o=this._header["content-type"],i=this._serializer||l.serialize[o?o.split(";")[0]:""];!i&&g(o)&&(i=l.serialize["application/json"]),i&&(n=i(n))}for(var s in this.header)null!=this.header[s]&&this.header.hasOwnProperty(s)&&t.setRequestHeader(s,this.header[s]);return this._responseType&&(t.responseType=this._responseType),this.emit("request",this),t.send(void 0!==n?n:null),this},l.agent=function(){return new u},["GET","POST","OPTIONS","PATCH","PUT","DELETE"].forEach(function(e){u.prototype[e.toLowerCase()]=function(t,n){var r=new l.Request(e,t);return this._setDefaults(r),n&&r.end(n),r}}),u.prototype.del=u.prototype.delete,l.get=function(e,t,n){var r=l("GET",e);return"function"==typeof t&&(n=t,t=null),t&&r.query(t),n&&r.end(n),r},l.head=function(e,t,n){var r=l("HEAD",e);return"function"==typeof t&&(n=t,t=null),t&&r.query(t),n&&r.end(n),r},l.options=function(e,t,n){var r=l("OPTIONS",e);return"function"==typeof t&&(n=t,t=null),t&&r.send(t),n&&r.end(n),r},l.del=v,l.delete=v,l.patch=function(e,t,n){var r=l("PATCH",e);return"function"==typeof t&&(n=t,t=null),t&&r.send(t),n&&r.end(n),r},l.post=function(e,t,n){var r=l("POST",e);return"function"==typeof t&&(n=t,t=null),t&&r.send(t),n&&r.end(n),r},l.put=function(e,t,n){var r=l("PUT",e);return"function"==typeof t&&(n=t,t=null),t&&r.send(t),n&&r.end(n),r}},{"./agent-base":6,"./is-object":8,"./request-base":9,"./response-base":10,"component-emitter":2}],8:[function(e,t,n){"use strict";t.exports=function(e){return null!==e&&"object"==typeof e}},{}],9:[function(e,t,n){"use strict";var r=e("./is-object");function o(e){if(e)return function(e){for(var t in o.prototype)e[t]=o.prototype[t];return e}(e)}t.exports=o,o.prototype.clearTimeout=function(){return clearTimeout(this._timer),clearTimeout(this._responseTimeoutTimer),delete this._timer,delete this._responseTimeoutTimer,this},o.prototype.parse=function(e){return this._parser=e,this},o.prototype.responseType=function(e){return this._responseType=e,this},o.prototype.serialize=function(e){return this._serializer=e,this},o.prototype.timeout=function(e){if(!e||"object"!=typeof e)return this._timeout=e,this._responseTimeout=0,this;for(var t in e)switch(t){case"deadline":this._timeout=e.deadline;break;case"response":this._responseTimeout=e.response;break;default:console.warn("Unknown timeout option",t)}return this},o.prototype.retry=function(e,t){return 0!==arguments.length&&!0!==e||(e=1),e<=0&&(e=0),this._maxRetries=e,this._retries=0,this._retryCallback=t,this};var i=["ECONNRESET","ETIMEDOUT","EADDRINFO","ESOCKETTIMEDOUT"];o.prototype._shouldRetry=function(e,t){if(!this._maxRetries||this._retries++>=this._maxRetries)return!1;if(this._retryCallback)try{var n=this._retryCallback(e,t);if(!0===n)return!0;if(!1===n)return!1}catch(e){console.error(e)}if(t&&t.status&&t.status>=500&&501!=t.status)return!0;if(e){if(e.code&&~i.indexOf(e.code))return!0;if(e.timeout&&"ECONNABORTED"==e.code)return!0;if(e.crossDomain)return!0}return!1},o.prototype._retry=function(){return this.clearTimeout(),this.req&&(this.req=null,this.req=this.request()),this._aborted=!1,this.timedout=!1,this._end()},o.prototype.then=function(e,t){if(!this._fullfilledPromise){var n=this;this._endCalled&&console.warn("Warning: superagent request was sent twice, because both .end() and .then() were called. Never call .end() if you use promises"),this._fullfilledPromise=new Promise(function(e,t){n.end(function(n,r){n?t(n):e(r)})})}return this._fullfilledPromise.then(e,t)},o.prototype.catch=function(e){return this.then(void 0,e)},o.prototype.use=function(e){return e(this),this},o.prototype.ok=function(e){if("function"!=typeof e)throw Error("Callback required");return this._okCallback=e,this},o.prototype._isResponseOK=function(e){return!!e&&(this._okCallback?this._okCallback(e):e.status>=200&&e.status<300)},o.prototype.get=function(e){return this._header[e.toLowerCase()]},o.prototype.getHeader=o.prototype.get,o.prototype.set=function(e,t){if(r(e)){for(var n in e)this.set(n,e[n]);return this}return this._header[e.toLowerCase()]=t,this.header[e]=t,this},o.prototype.unset=function(e){return delete this._header[e.toLowerCase()],delete this.header[e],this},o.prototype.field=function(e,t){if(null==e)throw new Error(".field(name, val) name can not be empty");if(this._data&&console.error(".field() can't be used if .send() is used. Please use only .send() or only .field() & .attach()"),r(e)){for(var n in e)this.field(n,e[n]);return this}if(Array.isArray(t)){for(var o in t)this.field(e,t[o]);return this}if(null==t)throw new Error(".field(name, val) val can not be empty");return"boolean"==typeof t&&(t=""+t),this._getFormData().append(e,t),this},o.prototype.abort=function(){return this._aborted?this:(this._aborted=!0,this.xhr&&this.xhr.abort(),this.req&&this.req.abort(),this.clearTimeout(),this.emit("abort"),this)},o.prototype._auth=function(e,t,n,r){switch(n.type){case"basic":this.set("Authorization","Basic "+r(e+":"+t));break;case"auto":this.username=e,this.password=t;break;case"bearer":this.set("Authorization","Bearer "+e)}return this},o.prototype.withCredentials=function(e){return null==e&&(e=!0),this._withCredentials=e,this},o.prototype.redirects=function(e){return this._maxRedirects=e,this},o.prototype.maxResponseSize=function(e){if("number"!=typeof e)throw TypeError("Invalid argument");return this._maxResponseSize=e,this},o.prototype.toJSON=function(){return{method:this.method,url:this.url,data:this._data,headers:this._header}},o.prototype.send=function(e){var t=r(e),n=this._header["content-type"];if(this._formData&&console.error(".send() can't be used if .attach() or .field() is used. Please use only .send() or only .field() & .attach()"),t&&!this._data)Array.isArray(e)?this._data=[]:this._isHost(e)||(this._data={});else if(e&&this._data&&this._isHost(this._data))throw Error("Can't merge these send calls");if(t&&r(this._data))for(var o in e)this._data[o]=e[o];else"string"==typeof e?(n||this.type("form"),n=this._header["content-type"],this._data="application/x-www-form-urlencoded"==n?this._data?this._data+"&"+e:e:(this._data||"")+e):this._data=e;return!t||this._isHost(e)?this:(n||this.type("json"),this)},o.prototype.sortQuery=function(e){return this._sort=void 0===e||e,this},o.prototype._finalizeQueryString=function(){var e=this._query.join("&");if(e&&(this.url+=(this.url.indexOf("?")>=0?"&":"?")+e),this._query.length=0,this._sort){var t=this.url.indexOf("?");if(t>=0){var n=this.url.substring(t+1).split("&");"function"==typeof this._sort?n.sort(this._sort):n.sort(),this.url=this.url.substring(0,t)+"?"+n.join("&")}}},o.prototype._appendQueryString=function(){console.trace("Unsupported")},o.prototype._timeoutError=function(e,t,n){if(!this._aborted){var r=new Error(e+t+"ms exceeded");r.timeout=t,r.code="ECONNABORTED",r.errno=n,this.timedout=!0,this.abort(),this.callback(r)}},o.prototype._setTimeouts=function(){var e=this;this._timeout&&!this._timer&&(this._timer=setTimeout(function(){e._timeoutError("Timeout of ",e._timeout,"ETIME")},this._timeout)),this._responseTimeout&&!this._responseTimeoutTimer&&(this._responseTimeoutTimer=setTimeout(function(){e._timeoutError("Response timeout of ",e._responseTimeout,"ETIMEDOUT")},this._responseTimeout))}},{"./is-object":8}],10:[function(e,t,n){"use strict";var r=e("./utils");function o(e){if(e)return function(e){for(var t in o.prototype)e[t]=o.prototype[t];return e}(e)}t.exports=o,o.prototype.get=function(e){return this.header[e.toLowerCase()]},o.prototype._setHeaderProperties=function(e){var t=e["content-type"]||"";this.type=r.type(t);var n=r.params(t);for(var o in n)this[o]=n[o];this.links={};try{e.link&&(this.links=r.parseLinks(e.link))}catch(e){}},o.prototype._setStatusProperties=function(e){var t=e/100|0;this.status=this.statusCode=e,this.statusType=t,this.info=1==t,this.ok=2==t,this.redirect=3==t,this.clientError=4==t,this.serverError=5==t,this.error=(4==t||5==t)&&this.toError(),this.created=201==e,this.accepted=202==e,this.noContent=204==e,this.badRequest=400==e,this.unauthorized=401==e,this.notAcceptable=406==e,this.forbidden=403==e,this.notFound=404==e,this.unprocessableEntity=422==e}},{"./utils":11}],11:[function(e,t,n){"use strict";n.type=function(e){return e.split(/ *; */).shift()},n.params=function(e){return e.split(/ *; */).reduce(function(e,t){var n=t.split(/ *= */),r=n.shift(),o=n.shift();return r&&o&&(e[r]=o),e},{})},n.parseLinks=function(e){return e.split(/ *, */).reduce(function(e,t){var n=t.split(/ *; */),r=n[0].slice(1,-1);return e[n[1].split(/ *= */)[1].slice(1,-1)]=r,e},{})},n.cleanHeader=function(e,t){return delete e["content-type"],delete e["content-length"],delete e["transfer-encoding"],delete e.host,t&&(delete e.authorization,delete e.cookie),e}},{}],12:[function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.candidates=t;var r=[{re:new RegExp(""+this.constructor.re.start+this.constructor.yearAndMonthName.parts.map(function(e){return n.constructor.re[e]}).join(this.constructor.re.separator)+this.constructor.re.end),year:this.constructor.yearAndMonthName.year,month:this.constructor.yearAndMonthName.month,name:!0}];this.patterns=r.concat(["yearAndMonth","dayMonthNameYear","monthDayYear","monthNameDayYear","monthYear","monthNameAndYear","year"].map(function(e){return n.constructor[e]}).map(function(e){return{re:new RegExp(""+n.constructor.re.start+e.parts.map(function(e){return n.constructor.re[e]}).join(n.constructor.re.separator)+n.constructor.re.end),year:e.year,month:e.month,name:e.name}})),this.extracted=this.constructor.compact(this.candidates.map(function(e){return n.extract(e)})),this.sorted=this.extracted.sort(function(e,t){return e[0]+"-"+(e[1]||99)<t[0]+"-"+(t[1]||99)?-1:1}),this.publicationDate=this.sorted[0]}return r(e,[{key:"extract",value:function(e){for(var t=["january","february","march","april","may","june","july","august","september","october","november","december"],n=0;n<this.patterns.length;n+=1){var r=this.patterns[n],o=e.match(r.re);if(o){var i=null;if(r.month&&(i=o[r.month],r.name))for(var s=i.toLowerCase(),a=0;a<t.length;a+=1){var u=t[a];u.match(s)&&(i=String(t.indexOf(u)+1))}return this.constructor.compact([o[r.year],i])}}return null}}],[{key:"compact",value:function(e){return e.filter(function(e){return null!=e})}}]),e}();o.re={year:"(1[89]\\d{2}|20\\d{2})",month:"(\\d{1,2})",monthName:"(\\w{3,9})",day:"\\d{1,2}\\w{0,2}",start:"(\\D|^)",end:"(\\D|$)",separator:"[.,/-\\s]+"},o.yearAndMonth={parts:["year","month"],year:2,month:3},o.yearAndMonthName={parts:["year","monthName"],year:2,month:3,name:!0},o.monthDayYear={parts:["month","day","year"],year:3,month:2},o.monthNameDayYear={parts:["monthName","day","year"],year:3,month:2,name:!0},o.dayMonthNameYear={parts:["day","monthName","year"],year:3,month:2,name:!0},o.monthYear={parts:["month","year"],year:3,month:2},o.monthNameAndYear={parts:["monthName","year"],year:3,month:2,name:!0},o.year={parts:["year"],year:2},t.exports={DateParser:o}},{}],13:[function(e,t,n){"use strict";t.exports=function(e){return e.replace(/_([a-z])/g,function(e){return e[1].toUpperCase()})}},{}],14:[function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=e("./sources"),i=e("./DateParser").DateParser,s=e("./camelCase"),a=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!t)throw new Error("document is required for new MetaExtractor instance");this.options=n,this.parse(t)}return r(e,[{key:"parse",value:function(e){var t=this,n=this.options.sources||this.constructor.defaultSources,r=this.options.meta_extractor_options,a=void 0===r?{prioritizeSelectors:void 0}:r,u=a.prioritizeSelectors,c=a.selectorsToRemoveFromInnerHTML||this.constructor.defaultSelectorsToRemoveFromInnerHTML;u&&(this.options.prioritizeSelectors=u,n=n.reduce(function(e,t){return"Selectors"===t?[t].concat(e):(e.push(t),e)},[])),this.sources=n.map(function(n){return new("string"==typeof n?o[n]:n)(e,t.options,c)}),[].slice.call(e.querySelectorAll("meta")).forEach(function(e){t.sources.forEach(function(t){t.add(e)})}),(this.options.tags||this.constructor.defaultTags).forEach(function(e){if("publication_date"===e){var n=new i(t.forCompact("publication_date")).publicationDate;n&&(t.publicationYear=n[0],t.publicationMonth=n[1])}else{var r="get"+t.constructor.ucCamelCase(e);t[s(e)]=t[r]?t[r]():t.firstFor(e)}})}},{key:"getPubmedId",value:function(){return this.firstFor("pubmed_id",Number)}},{key:"getDoi",value:function(){var e=this.firstFor("doi");if(e)return e.trim().replace("doi:","").replace("info:doi/","").replace("http://","").replace("https://","").replace("dx.doi.org/","").replace("doi.org/","").replace("doi","").replace("DOI","")}},{key:"getIssn",value:function(){var e=this.firstFor("issn");if(e)return e.trim().replace("issn:","").replace("info:issn/","")}},{key:"getAuthors",value:function(){var e=this.constructor.uniq(this.forCompact("authors"));if(!(e.length>1))return e[0]||void 0;for(var t=0;t<e.length;t+=1)if(e[t])return e[t]+" et al."}},{key:"getAbstract",value:function(){var e=this.options.prioritizeSelectors?0:7;return this.sources[e].get("abstract")||this.firstFor("abstract")}},{key:"firstFor",value:function(e,t){var n=this.forCompact(e);return t&&(n=n.filter(t)),n[0]}},{key:"forCompact",value:function(e){var t=[];return this.sources.map(function(t){return t.get(e)}).forEach(function(n){t="title"===e&&n?t.concat(n.replace(/^(【In Press】|In Press):?/i,"").trim()):t.concat(n)}),this.constructor.compact(t)}},{key:"publication_year",get:function(){return this.publicationYear},set:function(e){this.publicationYear=e}},{key:"publication_month",get:function(){return this.publicationMonth},set:function(e){this.publicationMonth=e}},{key:"journal_title",get:function(){return this.journalTitle.trim()},set:function(e){this.journalTitle=e}},{key:"custom_id",get:function(){return this.customId},set:function(e){this.customId=e}}],[{key:"ucCamelCase",value:function(e){var t=s(e);return t.charAt(0).toUpperCase()+t.substr(1)}},{key:"compact",value:function(e){return e.filter(function(e){return null!=e})}},{key:"uniq",value:function(e){return e.filter(function(t,n){return e.indexOf(t)===n})}}]),e}();a.defaultSources=["HighWire","DublinCore","DCTerms","Prism","BEPress","EPrints","WolterKluwer","Selectors","OpenGraph"],a.defaultTags=["pubmed_id","doi","title","publication_date","authors","abstract"],a.defaultSelectorsToRemoveFromInnerHTML=[".overlay"],t.exports={MetaExtractor:a,sources:o}},{"./DateParser":12,"./camelCase":13,"./sources":27}],15:[function(e,t,n){"use strict";var r=e("./Source"),o=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r),t}();o.prefix=["bepress","citation"],o.separator="_",t.exports=o},{"./Source":24}],16:[function(e,t,n){"use strict";var r=e("./Source"),o=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r),t}();o.defaultTags=["issn","journal_title","doi"],o.prefix="dcsext.wt",o.separator="_",o.issn="issn",o.journalTitle="name",o.doi="doi",t.exports=o},{"./Source":24}],17:[function(e,t,n){"use strict";var r=e("./Source"),o=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r),t}();o.defaultTags=["pubmed_id","doi","title","authors","abstract"],o.prefix="dcterms",o.authors="creator",o.abstract=["abstract","description"],o.journalTitle="publisher",o.issn="identifier.issn",t.exports=o},{"./Source":24}],18:[function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=e("./Source"),i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),r(t,[{key:"getIssn",value:function(){for(var e=this.forCompact("issn"),t=0;t<e.length;t+=1){var n=e[t];if(!this.constructor.checkDoi(n))return n}}},{key:"sortScore",value:function(e,n){var r=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(r):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"sortScore",this).call(this,e,n);if("doi"===e||"issn"===e){r*=10;var o=n.getAttribute("scheme");o&&o.toLowerCase()===e&&(r-=5);var i=this.clean(n.getAttribute("content"));i&&0===i.toLowerCase().indexOf(e+":")&&(r-=1)}return r}}]),t}();i.prefix="dc",i.doi=["identifier.doi","identifier"],i.authors=["creator","contributor"],i.publicationDate=["date","issued"],i.abstract=["abstract","description"],i.journalTitle="publisher",i.issn=["identifier.issn","identifier"],t.exports=i},{"./Source":24}],19:[function(e,t,n){"use strict";var r=e("./Source"),o=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r),t}();o.prefix="eprints",o.authors="creators_name",o.journalTitle=["publication","publisher"],t.exports=o},{"./Source":24}],20:[function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=e("./Source"),i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),r(t,[{key:"forCompact",value:function(e){return this.buckets[e]=this.constructor.prioritizeEngMeta(this.buckets[e]),function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(r):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"forCompact",this).call(this,e)}}],[{key:"prioritizeEngMeta",value:function(e){return[].concat(e.filter(function(e){return e.getAttribute&&"en"===e.getAttribute("xml:lang")}),e.filter(function(e){return!e.getAttribute||"en"!==e.getAttribute("xml:lang")}))}}]),t}();i.prefix="citation",i.separator="_",t.exports=i},{"./Source":24}],21:[function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=e("./Source"),i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),r(t,null,[{key:"nodeTag",value:function(e){var n=e.getAttribute("property");return n?n.toLowerCase():function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(r):void 0}(t.__proto__||Object.getPrototypeOf(t),"nodeTag",this).call(this,e)}}]),t}();i.prefix="og",i.separator=":",i.authors=[],i.publicationDate="article:published_time",i.abstract="description",t.exports=i},{"./Source":24}],22:[function(e,t,n){"use strict";var r=e("./Source"),o=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r),t}();o.prefix="prism",o.publicationDate="publicationdate",o.journalTitle="publicationname",o.issn=["eissn","issn"],t.exports=o},{"./Source":24}],23:[function(e,t,n){(function(n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var i=e("./Source"),s=function(e){function t(e,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));return i.options.selectors=i.options.selectors||{},i.buckets={},i.tags.forEach(function(e){i.options.selectors[e]&&(i.buckets[e]=[].slice.call(i.document.querySelectorAll(i.options.selectors[e])).map(function(e){if("META"===e.tagName)return e.content;n.NodeList&&!n.NodeList.prototype.forEach&&(n.NodeList.prototype.forEach=Array.prototype.forEach);var t=e.cloneNode(!0);return t.querySelectorAll(o).forEach(function(e){return e.parentNode.removeChild(e)}),t.innerHTML}))}),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"forCompact",value:function(e){var t,n=this;if(!this.buckets[e])return[];var r=this.buckets[e].map(function(e){return n.clean(e)});if("authors"===e&&1===r.length){var i=r[0].split(",");return this.constructor.handleCommaSeparatedNameNotation(i)}return(t=[]).concat.apply(t,o(r))}},{key:"add",value:function(){this.added=this.added}}],[{key:"handleCommaSeparatedNameNotation",value:function(e){var t=e[0].split(/[\s;:.!?+&*\/%]+/).filter(function(e){return e}).length;return e.length>1&&t<2?this.joinFirstTwoItemsOfArray(e):e}},{key:"joinFirstTwoItemsOfArray",value:function(e){var t=[].concat(o(e));return t[0]=t[0]+","+t[1],t.splice(1,1),t}}]),t}();t.exports=s}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Source":24}],24:[function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=e("../camelCase"),i=function(){function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.document=t,this.options=r,this.tags=this.options.tags||this.constructor.defaultTags,this.tagMap={},this.buckets={},this.tagOrder={},this.tags.forEach(function(e){n.buckets[e]=[],n.tagOrder[e]=[],[].concat(n.constructor[o(e)]).forEach(function(t){var r=n.constructor.tag(t);n.tagMap[r]=n.tagMap[r]||[],n.tagMap[r].push(e),n.tagOrder[e].push(r)})})}return r(e,[{key:"add",value:function(e){var t=this,n=this.constructor.nodeTag(e);(this.tagMap[n]||[]).forEach(function(n){e.getAttribute("content")&&t.buckets[n].push(e)})}},{key:"get",value:function(e){var t="get"+this.constructor.ucCamelCase(e);return"function"==typeof this[t]?this[t]():this.firstFor(e)}},{key:"getAuthors",value:function(){return this.forCompact("authors")}},{key:"getPublicationDate",value:function(){return this.forCompact("publication_date")}},{key:"getAbstract",value:function(){var e=this.forCompact("abstract");return e&&e.length?e.join(" ").trim():null}},{key:"getDoi",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"doi",t=this.forCompact(e),n=0;n<t.length;n+=1){var r=t[n];if(this.constructor.checkDoi(r))return r}}},{key:"firstFor",value:function(e){return this.forCompact(e)[0]}},{key:"forCompact",value:function(e){var t,n=this;if(!this.buckets[e])return[];"authors"!==e&&this.buckets[e].sort(function(t,r){return n.sortScore(e,t)-n.sortScore(e,r)});var r=this.buckets[e].map(function(t){var r=t.getAttribute?t.getAttribute("content"):t;return"authors"===e?n.clean(r).split(","):n.clean(r)});return(t=[]).concat.apply(t,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(r))}},{key:"sortScore",value:function(e,t){return(this.tagOrder[e]||"").indexOf(this.constructor.nodeTag(t))}},{key:"clean",value:function(e){return this.htmlDecode(e).replace(/[\n\t]+/g," ").replace(/\s+/g," ").trim()}},{key:"htmlDecode",value:function(e){if(!e)return"";var t=this.document.createElement("div");return t.innerHTML=e.replace(/<style.*?>.*?<\/style>|<script.*?>.*?<\/script>/g,"").replace(/(<span*>)/g,"$1 "),t.textContent}}],[{key:"checkDoi",value:function(e){return e.match(/\//g)}},{key:"tag",value:function(e){return[].concat(this.prefix).concat(e).join(this.separator)}},{key:"nodeTag",value:function(e){var t=e.getAttribute("name");return t?t.toLowerCase():"invalid"}},{key:"ucCamelCase",value:function(e){var t=o(e);return t.charAt(0).toUpperCase()+t.substr(1)}}]),e}();i.prefix=[],i.separator=".",i.defaultTags=["pubmed_id","doi","title","authors","publication_date","abstract"],i.pubmedId=["pubmed_id","pmid"],i.doi="doi",i.title="title",i.authors=["authors","author"],i.publicationDate=["publication_date","date"],i.abstract="abstract",i.journalTitle=["journal_title","journal_abbrev"],i.issn="issn",t.exports=i},{"../camelCase":13}],25:[function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=e("./Source"),i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),r(t,[{key:"getCustomId",value:function(){var e=this.document.querySelector('meta[name="pbContext"]');if(e&&e.content){var t=new RegExp("journal\\:journal\\:(\\w+?)(?:\\W|$)").exec(e.content);if(t&&t.length>1)return t[1]}return null}}]),t}();t.exports=i},{"./Source":24}],26:[function(e,t,n){"use strict";var r=e("./Source"),o=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r),t}();o.prefix="wkhealth",o.separator="_",t.exports=o},{"./Source":24}],27:[function(e,t,n){"use strict";var r=e("./Source"),o=e("./HighWire"),i=e("./DublinCore"),s=e("./Prism"),a=e("./BEPress"),u=e("./EPrints"),c=e("./OpenGraph"),l=e("./WolterKluwer"),d=e("./DCTerms"),f=e("./Selectors"),h=e("./TandFonline"),p=e("./DCSext");t.exports={Source:r,HighWire:o,DublinCore:i,Prism:s,BEPress:a,EPrints:u,OpenGraph:c,WolterKluwer:l,DCTerms:d,Selectors:f,TandFonline:h,DCSext:p}},{"./BEPress":15,"./DCSext":16,"./DCTerms":17,"./DublinCore":18,"./EPrints":19,"./HighWire":20,"./OpenGraph":21,"./Prism":22,"./Selectors":23,"./Source":24,"./TandFonline":25,"./WolterKluwer":26}],28:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t&&(t.split(",").forEach(function(e){if(-1!==e.indexOf("=")){var t=e.split("="),o=r(t,2),i=o[0],s=o[1];n[n.trim(i)]=n.trim(s)}else n[n.trim(e)]=!0}),this.abstract=parseInt(this.abstract,10))}return o(e,[{key:"trim",value:function(e){return e.replace(/^\s+|\s+$/g,"")}}]),e}();n.default=i},{}],29:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=s(e("superagent")),i=s(e("./TimeLogger"));function s(e){return e&&e.__esModule?e:{default:e}}var a=function(){function e(t){var n=t.dtConfig,r=t.eventLogger,o=t.queryParams,i=t.tag,s=t.integrations;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.dtConfig=n,this.switches={},this.eventLogger=r,this.queryParams=o,this.res={},this.tag=i,this._integrations=s,this._dtAdded=!1}return r(e,[{key:"addDt",value:function(){return!this._dtAdded&&(!(!this.dtConfig||!this.switches.dt||this.switches.gdpr||!this.switches.isUS)&&(this.dtConfig.dmd&&this._addDmdIframe(),this.dtConfig.lhk&&this._makeLhkReq(),this._integrations.loop(),this._dtAdded=!0,!0))}},{key:"_addDmdIframe",value:function(){var e=this,t=document.createElement("iframe");if(t.setAttribute("style","display:none!important"),"function"!=typeof t.getAttribute)return!1;var n=Date.now(),r="?client-origin="+window.location.origin+"&timestamp="+n;return this.dtConfig.dmd.permittedOrigin=""+this.dtConfig.dmd.origin,t.src=""+this.dtConfig.dmd.permittedOrigin+this.dtConfig.dmd.path+r,document.body.appendChild(t),window.addEventListener("message",function(t){return e.dmdPostMessageHandler(t)},!1),!0}},{key:"_makeLhkReq",value:function(){var e=this;o.default.get(this.dtConfig.lhk.api).withCredentials().end(function(t,n){e.eventLogger.log({},{lhk:n.body})})}},{key:"dmdPostMessageHandler",value:function(e){e.origin===this.dtConfig.dmd.permittedOrigin&&(this.res=e.data,i.default.log("dt"),this.eventLogger.dmdObj=this.dmdObj(),i.default.times.recos&&this.eventLogger.log({},{dmd:this.dmdObj()}))}},{key:"dmdObj",value:function(){if(!this.dtConfig||!this.dtConfig.dmd||!this.switches.dt)return!1;for(var e={url:document.location.href,title:document.title,article:this.queryParams(),referrer:document.referrer,time:new Date,recos:[],iframe:{data:this.res,iframeResponse:i.default.times.dt,recosVisible:i.default.times.recos}},t=document.getElementsByClassName(this.tag+"-widget-list-item__link"),n=0;n<t.length;n++){var r=t[n];e.recos.push(r.getAttribute("data-"+this.tag+"-id"))}return e}}]),e}();n.default=a},{"./TimeLogger":37,superagent:7}],30:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("superagent"),s=(r=i)&&r.__esModule?r:{default:r};var a=function(){function e(t){var n=t.config;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tag=n.tag,this.version=n.version,this.relevancyUrl=n.relevancyUrl,this.eventsEndpoint="/events",this.swoopObj={},this.dmdObj={},this.switches={},this.stack=[],this.concurrent=0,this._stackInterval=0,this._stackInProgress=!1,this.hasAdBlock=null}return o(e,[{key:"log",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments[2];this.stack.push({events:e,misc:n,cb:r}),this._stackInterval||(this._log(),this._stackInterval=setInterval(function(){!t._stackInProgress&&t.stack.length&&t._log()},200))}},{key:"_log",value:function(){var e=this;this._stackInProgress=!0;var t=this.stack.pop(),n=t.events,r=t.misc,o=t.cb;return r.switches=this.switches||{},this.concurrent+=1,s.default.post(this.relevancyUrl+this.eventsEndpoint).set(this.tag+"-widget-version",this.version).withCredentials().send({events:n,misc:r}).end(function(t,n){e.concurrent-=1,e._stackInProgress=!1,"function"==typeof o&&o(n)})}}]),e}();n.default=a},{superagent:7}],31:[function(e,t,n){(function(t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("./TimeLogger"),s=(r=i)&&r.__esModule?r:{default:r};function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u=function(){function e(t){var n=t.config,r=t.eventLogger;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tag=n.tag,this.version=n.version,this.testID=null,this.journalId=null,this.articleId=null,this.elements={},this.eventsStoreKey=this.tag+"SentEvents",this.attributes={articleId:"data-"+this.tag+"-id",journalId:"data-"+this.tag+"-journal-id",sponsored:"data-"+this.tag+"-sponsored",campaignId:"data-"+this.tag+"-campaign-id",ct:"data-"+this.tag+"-ct"},this.selectors={organic:"a[data-"+this.tag+'-sponsored="false"]',sponsored:"a[data-"+this.tag+'-sponsored="true"]'},this._eventLogger=r}return o(e,[{key:"impression",value:function(e,t){var n=this,r={},o=[],i=[];e.forEach(function(e){for(var t=n.nodes("organic",e),s=0;s<t.length;s++){o.push(n.params(t[s]));var a=t[s].getAttribute(n.attributes.articleId);r[a]=t[s].getAttribute(n.attributes.ct)}for(var u=n.nodes("sponsored",e),c=0;c<u.length;c++){i.push(n.params(u[c]));var l=u[c].getAttribute(n.attributes.articleId);r[l]=u[c].getAttribute(n.attributes.ct)}});var a={"organic-impressions":o,"sponsored-impressions":i};if(!this.hasSentImpressionsEvents(a)){var u=o.length+i.length<t;this._eventLogger.log(a,{"loading-times":s.default.times,dmd:this._eventLogger.dmdObj,swoop:this._eventLogger.swoopObj,hasAdBlock:this._eventLogger.hasAdBlock,testID:this.testID,widgetVersion:this.version,websiteId:this.journalId,articleId:this.articleId,ct:r,hasInsufficientRecommendations:u})}}},{key:"click",value:function(e){var t=e.getAttribute(this.attributes.articleId),n=e.getAttribute(this.attributes.ct),r="true"===e.getAttribute(this.attributes.sponsored)?"sponsored":"organic",o={dt:this._eventLogger.dmdObj,swoop:this._eventLogger.swoopObj,testID:this.testID,ct:a({},t,n)};s.default.times.timeToClickStart&&(s.default.log("timeToClick","timeToClickStart"),o.ttc=s.default.times.timeToClick),this._eventLogger.log(a({},r+"-recommendations",[this.params(e)]),o)}},{key:"hasSentImpressionsEvents",value:function(e){var n=JSON.stringify(e);return t[this.eventsStoreKey]||(t[this.eventsStoreKey]=[]),-1!==t[this.eventsStoreKey].indexOf(n)||(t[this.eventsStoreKey].push(n),!1)}},{key:"nodes",value:function(e,t){return this.elements[t].querySelectorAll(this.selectors[e])}},{key:"params",value:function(e){return{from_journal_id:this.journalId,from_article_id:this.articleId,to_journal_id:e.getAttribute(this.attributes.journalId),to_article_id:e.getAttribute(this.attributes.articleId),campaign_id:e.getAttribute(this.attributes.campaignId)}}},{key:"switches",set:function(e){this._eventLogger.switches=e}}]),e}();n.default=u}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./TimeLogger":37}],32:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(t){var n=t.eventLogger,r=t.tag;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.prConsent=null,this.trConsent=null,this.gaConsent=null,this.gaClientId=null,this.gaConsentInGdpr=null,this.newClientId=!1,this.gdpr=!0,this.isUS=!1,this.gaCode="UA-139886559-1",this.tag=r,this.eventLogger=n,this.sessionCookieName=this.tag+"-disable-gdpr-ga-popup",this.flag="cf_widget_j",this.journalId=null,this.widgetIsLoaded=!1}return r(e,[{key:"addGaTrackingCode",value:function(e,t,n){var r=this;e&&(this.gaCode=e),t&&(this.flag=t),this._addGaTrackingCode(function(){r.gdpr&&!r.gaConsent?navigator.cookieEnabled&&-1!==document.cookie.indexOf(r.sessionCookieName)||("function"==typeof n?n():r._askForGaConsent()):r.newClientId?r._registerGaConsent(!0,function(e){e||r._gaTrackPageView()}):r._gaTrackPageView()})}},{key:"_addGaTrackingCode",value:function(e){var t,n,r,o,i,s,a,u=this;t=window,n=document,r="script",o="//www.google-analytics.com/analytics.js",i="ga",t.GoogleAnalyticsObject=i,t[i]=t[i]||function(){return(t[i].q=t[i].q||[]).push(arguments)},t[i].l=1*new Date,s=n.createElement(r),a=n.getElementsByTagName(r)[0],s.async=1,s.src=o,a.parentNode.insertBefore(s,a),this.gaClientId?ga("create",this.gaCode,"auto",{storage:"none",name:"tmdWidget",clientId:this.gaClientId}):ga("create",this.gaCode,"auto",{storage:"none",name:"tmdWidget"}),ga("set","anonymizeIp",!0),ga(function(){"function"==typeof ga.getAll&&ga.getAll().forEach(function(t){"tmdWidget"===t.get("name")&&(u.gaClientId||(u.gaClientId=t.get("clientId"),u.newClientId=!0),e())})})}},{key:"_gaTrackPageView",value:function(){"cf_widget"===this.flag.substring(0,9)?ga("tmdWidget.send","pageview",window.location.hostname+"/"+this.journalId):ga("tmdWidget.send","pageview")}},{key:"_askForGaConsent",value:function(){document.getElementsByClassName(this.tag+"-widget-cookie-notification").length&&(this._hideProgress(),document.getElementsByClassName(this.tag+"-widget-cookie-notification")[0].setAttribute("style","display: block!important"))}},{key:"_registerGaConsent",value:function(e){var t=this,n=function(){var n=t.flag;"cf_widget"===t.flag.substring(0,9)&&(n=""+t.flag+t.journalId),t.eventLogger.log({},{gdprGaConsent:{gdpr:t.gdpr,gaClientId:t.gaClientId,gaCode:t.gaCode,gaConsent:t.gaConsent,gaConsentInGdpr:t.gaConsentInGdpr,flag:n}},function(n){n&&n.ok?(t.gaConsent&&t._gaTrackPageView(),"function"==typeof e&&e(!1),t.gdpr&&(document.cookie=t.sessionCookieName+"=1;path=/")):n&&n.ok||"function"==typeof e&&e({error:"other"})})};if(!this.gdpr&&this.eventLogger.concurrent>0)var r=setInterval(function(){0===t.eventLogger.concurrent&&(n(),clearInterval(r))},500);else n()}},{key:"_handleGaConsentError",value:function(){var e=this;this._hideConsentFooter(),clearTimeout(this._handleGaConsentErrorTimeout),this._handleGaConsentErrorTimeout=setTimeout(function(){e._askForGaConsent()},500)}},{key:"_hideConsentFooter",value:function(){var e=document.getElementsByClassName(this.tag+"-widget-cookie-notification");if(e)for(var t=0;t<e.length;t++)e[t]&&"function"==typeof e[t].setAttribute&&e[t].setAttribute("style","display: none!important")}},{key:"_showProgress",value:function(){var e=this;document.querySelectorAll("."+this.tag+"-widget-cookie-notification button").forEach(function(e){return e.style.display="none"});var t=document.querySelectorAll("."+this.tag+"-widget-cookie-notification span")[1];clearInterval(this._showProgressInterval),this._showProgressDots=1,this._showProgressInterval=setInterval(function(){for(var n="Saving",r=0;r<e._showProgressDots;r++)n+=".";t&&(t.innerHTML=n),e._showProgressDots+=1,e._showProgressDots>3&&(e._showProgressDots=1)},500)}},{key:"_hideProgress",value:function(){document.querySelectorAll("."+this.tag+"-widget-cookie-notification button").forEach(function(e){return e.style.display="inline-block"});var e=document.querySelectorAll("."+this.tag+"-widget-cookie-notification span")[1];clearInterval(this._showProgressInterval),e.innerHTML=""}},{key:"_clearSessionCookie",value:function(){document.cookie=this.sessionCookieName+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"}},{key:"setGaConsent",value:function(e,t){var n=this,r=t;return"function"!=typeof r&&(r=function(e){e?n._handleGaConsentError():n._hideConsentFooter()}),navigator.cookieEnabled?(this.gaConsent=!0===e,this._showProgress(),this._registerGaConsent(r)):r({error:"cookie"})}},{key:"setPrConsent",value:function(e,t,n){return navigator.cookieEnabled?(this.prConsent=!0===e,this.trConsent=!0===t,this.eventLogger.log({},{gdprPrConsent:{gdpr:this.gdpr,prConsent:this.prConsent,trConsent:this.trConsent}},function(e){"function"==typeof n&&(e.ok?n(!1):e.ok||n({error:"other"}))})):n({error:"cookie"})}},{key:"switches",set:function(e){e&&(this.isUS=!!e.isUS),e&&null!==e.gdpr&&(this.gdpr=e.gdpr),e&&e.gaCode&&(this.gaCode=e.gaCode),e&&e.mainCookie&&e.mainCookie.ga?(this.gaConsent=!!e.mainCookie.ga.consent,this.gaClientId=e.mainCookie.ga.clientId):this.gdpr?this.gaConsent=!1:this.gaConsent=!0,e&&e.mainCookie&&e.mainCookie.pr?(this.prConsent=!!e.mainCookie.pr.consent,this.trConsent=!!e.mainCookie.pr.tr):this.gdpr?(this.prConsent=!1,this.trConsent=!1):(this.prConsent=!0,this.trConsent=!0),e&&e.mainCookie&&e.mainCookie.gdprGaConsent&&(this.gaConsentInGdpr=!0),e&&void 0!==e.mainCookieWasCleared&&!0===e.mainCookieWasCleared&&this._clearSessionCookie()}}]),e}();n.default=o},{}],33:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=h(e("./WebsiteProperties")),i=h(e("./Events")),s=h(e("./EventLogger")),a=h(e("./Recommendations")),u=h(e("./WidgetInstances")),c=h(e("./WidgetIntegrations")),l=h(e("./Gdpr")),d=h(e("./Dt")),f=h(e("./TimeLogger"));function h(e){return e&&e.__esModule?e:{default:e}}var p=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=t,window.trendmdGlobalState=window.trendmdGlobalState||{},window.trendmdGlobalState.cache=window.trendmdGlobalState.cache||{},window.trendmdGlobalState.urlLocked=window.trendmdGlobalState.urlLocked||new Set,this._getOptions(),this.eventLogger=null,this.gdprInstance=null,this.widgetInstances=null,this.options&&this.register()}return r(e,[{key:"register",value:function(e){var t=e||this.options;if(t){f.default.init();var n=new o.default({apiUrl:this.config.apiUrl,options:t,version:this.config.version,tag:this.config.tag});this.eventLogger||(this.eventLogger=new s.default({config:this.config}));var r=new c.default({config:this.config,eventLogger:this.eventLogger}),h=new i.default({config:this.config,eventLogger:this.eventLogger}),p=new a.default({config:this.config,websiteProperties:n,options:t});p.run(),this.gdprInstance||(this.gdprInstance=new l.default({tag:this.config.tag,eventLogger:this.eventLogger}));var g=new d.default({dtConfig:this.config.dtConfig,eventLogger:this.eventLogger,queryParams:function(){return p.queryParams()},tag:this.config.tag,integrations:r});this.widgetInstances=new u.default({config:this.config,events:h,websiteProperties:n,options:t,recommendations:p,integrations:r,gdpr:this.gdprInstance,dt:g}),this.widgetInstances.init()}}},{key:"gdpr",value:function(e){var t=this;if(this.gdprInstance)"function"==typeof e&&e();else{f.default.init();var n=new o.default({apiUrl:this.config.apiUrl,options:{journal_id:1},version:this.config.version,tag:this.config.tag});this.eventLogger||(this.eventLogger=new s.default({config:this.config})),this.gdprInstance||(this.gdprInstance=new l.default({tag:this.config.tag,eventLogger:this.eventLogger})),Promise.resolve(n.get()).then(function(n){t.gdprInstance.journalId=n.id,t.gdprInstance.switches=n.switches,t.eventLogger.switches=n.switches,"function"==typeof e&&e()})}return this.gdprInstance}},{key:"_getURLParam",value:function(e){var t=new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(window.location.search),n=!1;return t&&t.length&&(n=t[1].replace(/\+/g,"%20"),n=decodeURIComponent(t[1])),n}},{key:"_getOptions",value:function(){var e=this,t=void 0,n=document.currentScript||function(){for(var t=document.getElementsByTagName("script"),n="",r=0;r<t.length;r++){var o=t[r];o.getAttribute("data-"+e.tag+"config")&&(n=o)}return n}();if(n&&(t=n.getAttribute("data-amp")),t){this.options={title:this._getURLParam("title"),doi:this._getURLParam("doi"),journal_id:this._getURLParam("journalId"),issn:this._getURLParam("issn"),pubmed_id:this._getURLParam("pubmed"),url:this._getURLParam("url"),custom:this._getURLParam("custom"),element:"#"+this.tag+"-suggestions"},window.parent.postMessage({sentinel:"amp",type:"embed-size",height:document.body.scrollHeight},"*");for(var r=document.getElementsByClassName(this.tag+"-widget-list-item__link"),o=0;o<r.length;o++)r[o].setAttribute("target","_blank")}else n&&(this.options=n.getAttribute("data-"+this.config.tag+"config"),this.options&&(this.options=this.options.replace(/'/g,'"'),this.options=JSON.parse(this.options)))}}]),e}();n.default=p},{"./Dt":29,"./EventLogger":30,"./Events":31,"./Gdpr":32,"./Recommendations":34,"./TimeLogger":37,"./WebsiteProperties":38,"./WidgetInstances":40,"./WidgetIntegrations":41}],34:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=a(e("superagent")),i=e("trendmd-meta-extractor"),s=a(e("./RequestCache"));function a(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t){var n=t.config,r=t.options,o=t.websiteProperties;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.apiUrl=n.apiUrl,this.tag=n.tag,this.version=n.version,this.options=r,this.websiteProperties=o,this.website={}}return r(e,[{key:"run",value:async function(){var e=this,t=await this.websiteProperties.get(),n=t.widgets;this.website=t,this.missingEndpoint="/journals/"+t.id+"/missing",this.articlesEndpoint="/journals/"+t.id+"/articles",this.extractor=new i.MetaExtractor(document,t);var r=this.queryParams();if(this.isMissing(r))this.missing();else{this.createExecuted=!1,this.updateExecuted=!1,this.sponsoredRequestPromises={},this.organicRequestPromises={};var o=0;n.forEach(function(t){e.sponsoredRequestPromises[t.id]=new Promise(function(n,i){e.getSimilarArticle("sponsored",Object.assign({},r,{offset:o,boostedRecommendationsLimit:t.boostedRecommendationsLimit,recommendationsType:t.recommendationsType,numberOfRecommendations:t.numberOfRecommendations,sponsoredLimit:t.sponsoredLimit,titleSize:t.titleSize,fontSize:t.fontSize,titleWording:t.titleWording,logoStyle:t.logoStyle,columns:t.columns}),n,i)}),e.organicRequestPromises[t.id]=new Promise(function(n,i){e.getSimilarArticle("nonsponsored",Object.assign({},r,{offset:o,boostedRecommendationsLimit:t.boostedRecommendationsLimit,recommendationsType:t.recommendationsType,numberOfRecommendations:t.numberOfRecommendations,sponsoredLimit:t.sponsoredLimit,titleSize:t.titleSize,fontSize:t.fontSize,titleWording:t.titleWording,logoStyle:t.logoStyle,columns:t.columns}),n,i)}),"both"===t.recommendationsType?o+=Math.floor(t.numberOfRecommendations/2):o+=t.numberOfRecommendations})}}},{key:"getSponsored",value:async function(e){return this.sponsoredRequestPromises[e]}},{key:"getNonSponsored",value:async function(e){return this.organicRequestPromises[e]}},{key:"getSimilarArticle",value:function(e,t,n,r){var o=this,i=Object.assign({},t,"nonsponsored"===e&&{timestamp:this.website.updatedAt});this.article({endpoint:"/journals/"+this.website.id+"/similar-"+e,params:this.website.findArticlesByUrlOnly?{url:i.url}:i,type:e},function(t,i){if(t&&t.timeout)n({timeout:!0});else if(t&&-1!==[404,403].indexOf(i.status))r({status:i.status,error:t});else{if(404===i.status)return o.createExecuted||(o.createExecuted=!0,o.create()),void r({status:i.status,error:t});i.type=e,n(i)}})}},{key:"article",value:function(e,t){var n=e.endpoint,r=e.params,i="nonsponsored"===e.type?this.apiUrl.nonSponsored:this.apiUrl.sponsored;return o.default.get(i+n).set(this.tag+"-widget-version",this.version).timeout(3e4).withCredentials().query(r).use(s.default).end(t)}},{key:"create",value:function(e){o.default.post(this.apiUrl.sponsored+this.articlesEndpoint).set(this.tag+"-widget-version",this.version).timeout(3e4).send(this.storeParams()).end(e)}},{key:"missing",value:function(){this.nonMissingUrl()||o.default.post(this.apiUrl.sponsored+this.missingEndpoint).set(this.tag+"-widget-version",this.version).timeout(3e4).send({url:this.options.url||window.location.href}).end()}},{key:"queryParams",value:function(){return this.params("pubmed_id","doi","title","authors","url","publication_year","publication_month")}},{key:"storeParams",value:function(){return this.params("staging","pubmed_id","doi","title","authors","url","publication_year","publication_month","abstract")}},{key:"params",value:function(){for(var e=this,t={},n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];return-1!==r.indexOf("url")&&(t.url=this.options.url||window.location.href),-1!==r.indexOf("staging")&&(t.staging=this.website.staging),r.forEach(function(n){"url"!==n&&"staging"!==n&&(t[n]=e.checkParam(n,e.options[n]||e.extractor[n]))}),t}},{key:"checkParam",value:function(e,t){return"publication_year"===e?t>=1900&&t<=2100?t:null:"publication_month"===e?t>=1&&t<=12?t:null:t}},{key:"isMissing",value:function(e){return this.missingParameters(e)}},{key:"missingParameters",value:function(e){return!e.title&&!e.doi&&!e.pubmed_id}},{key:"nonMissingUrl",value:function(){return this.fileUrl()||this.googleCacheUrl()}},{key:"fileUrl",value:function(){return(this.options.url||window.location.href).match(/^file:\/\//)}},{key:"googleCacheUrl",value:function(){return(this.options.url||window.location.href).match(/^http:\/\/webcache\.googleusercontent\.com\/search/)}}]),e}();n.default=u},{"./RequestCache":36,superagent:7,"trendmd-meta-extractor":14}],35:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.widgetsInfo={},t.forEach(function(e){var t=null,r=new Promise(function(e){t=e}),o=null,i=new Promise(function(e){o=e});n.widgetsInfo[e.widgetId]={numberOfRecommendations:e.numberOfRecommendations,recommendationsType:e.recommendationsType,sponsoredLimit:e.sponsoredLimit,recommendations:{sponsored:[],nonsponsored:[]},readyPromise:r,onReady:t,loadedPromise:i,onLoaded:o,responsesReceived:0,container:null}}),this.maxWidgetId=t.length-1}return r(e,[{key:"balanceRecommendations",value:async function(e){var t=this.widgetsInfo[e],n=t.recommendations.sponsored.length,r=t.recommendations.nonsponsored.length,o=[],i=[];if("sponsored"===t.recommendationsType){var s=t.numberOfRecommendations-n;o=await this.getExtraRecommendations(e,"sponsored",s)}else if("nonsponsored"===t.recommendationsType){var a=t.numberOfRecommendations-r;i=await this.getExtraRecommendations(e,"nonsponsored",a)}else{var u=t.sponsoredLimit-n,c=t.numberOfRecommendations-t.sponsoredLimit-r;c+=u-(o=await this.getExtraRecommendations(e,"sponsored",u)).length,i=await this.getExtraRecommendations(e,"nonsponsored",c)}var l=t.container.querySelectorAll("ol.trendmd-widget-list"),d=document.createDocumentFragment(),f=document.createDocumentFragment();t.recommendations.sponsored.forEach(function(e){d.appendChild(e)}),o.forEach(function(e){d.appendChild(e)}),t.recommendations.nonsponsored.forEach(function(e){f.appendChild(e)}),i.forEach(function(e){f.appendChild(e)}),l.forEach(function(e,t){e.innerHTML="",0===t&&e.appendChild(f),t===l.length-1&&e.appendChild(d)}),t.onReady(t.container.innerHTML)}},{key:"getExtraRecommendations",value:async function(e,t,n){var r=this,o=async function(e){if(e>r.maxWidgetId)return[];await r.widgetsInfo[e].loadedPromise;var o=r.widgetsInfo[e].recommendations[t],i=[];return o.length>0&&(i=o.slice(0,n),r.widgetsInfo[e].recommendations[t]=o.slice(n)),i};if(0===n)return[];var i=[];return(i=await o(e+1)).length<n&&(i=i.concat(await o(e+2))),i}},{key:"onRecommendationsReceived",value:function(e,t,n){var r=document.createElement("html"),o=this.widgetsInfo[e];r.innerHTML=t;var i=r.querySelectorAll("li.trendmd-widget-list-item");o.recommendations[n]=Array.from(i),o.responsesReceived+=1,null!==o.container&&"sponsored"!==n||(o.container=r),2===o.responsesReceived&&this.onLoaded(e)}},{key:"onLoaded",value:async function(e){this.widgetsInfo[e].onLoaded();for(var t=[],n=0;n<e;n++)t.push(this.widgetsInfo[n].readyPromise);await Promise.all(t),this.balanceRecommendations(e)}},{key:"onError",value:async function(e){this.widgetsInfo[e].onReady()}},{key:"getBalancedRecommendations",value:async function(e){return this.widgetsInfo[e].readyPromise}}]),e}();n.default=o},{}],36:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=i(e("cache-service-cache-module")),o=i(e("superagent-cache-plugin"));function i(e){return e&&e.__esModule?e:{default:e}}var s=new r.default({storage:"",defaultExpiration:900,verbose:!1}),a=(0,o.default)(s);n.default=a},{"cache-service-cache-module":1,"superagent-cache-plugin":4}],37:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.times={}}return r(e,[{key:"init",value:function(){this.times.start||(this.times.start=new Date)}},{key:"log",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"start";this.times.start||console.error("TimeLogger: can't log "+e+", logger isn't initilized yet"),this.times[e]=new Date-this.times[t]}}]),e}());n.default=o},{}],38:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=u(e("superagent")),i=e("trendmd-meta-extractor"),s=u(e("./TimeLogger")),a=u(e("./RequestCache"));function u(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(t){var n=this,r=t.apiUrl,u=t.options,c=t.version,l=t.tag;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.apiUrl=r,this.options=u,this.version=c,this.tag=l,this.requestPromise=new Promise(function(e,t){var r=void 0,u=void 0;if(n.options.journal_id)r="/journals/"+n.options.journal_id+"/selectors",u={};else{r="/journals/identification";var c=new i.MetaExtractor(window.document,{sources:["HighWire","DCSext","DublinCore","DCTerms","Prism","BEPress","EPrints","WolterKluwer","TandFonline"],tags:["doi","issn","journal_title","custom_id"]});u={doi:c.doi,issn:c.issn,url:n.options.url||window.location.href,custom_id:n.options.custom_id||c.custom_id}}window.trendmdGlobalState.journal?e(window.trendmdGlobalState.journal):o.default.get(n.apiUrl.sponsored+r).set(n.tag+"-widget-version",n.version).withCredentials().query(u).use(a.default).end(function(n,o){"/journals/identification"===r?s.default.log("identification"):s.default.log("selectors"),n||o.error?t(n||o.error):(window.trendmdGlobalState.journal=o.body.journal,e(o.body.journal))})})}return r(e,[{key:"get",value:async function(){return this.requestPromise}}]),e}();n.default=c},{"./RequestCache":36,"./TimeLogger":37,superagent:7,"trendmd-meta-extractor":14}],39:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=s(e("./WidgetPosition")),i=s(e("./ArticleHeader"));function s(e){return e&&e.__esModule?e:{default:e}}var a=function(){function e(t){var n=t.config,r=t.options,i=t.events,s=t.recommendations,a=t.instanceOptions,u=t.integrations,c=t.gdpr,l=t.dt,d=t.recommendationsBalancer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tag=n.tag,this.widgetOptionsId=a.id,this.widgetId=a.widgetId,this.mainWidget=0===a.widgetId,this.recommendations=s,this.events=i,this.recommendationsBalancer=d,this.position=new o.default({config:n,options:r,eventLogger:this.events._eventLogger,instanceOptions:a,integrations:u,gdpr:c,dt:l})}return r(e,[{key:"init",value:function(){var e=this;return this.position.define(),Promise.race([this.recommendations.getSponsored(this.widgetOptionsId),this.recommendations.getNonSponsored(this.widgetOptionsId)]).then(async function(t){var n=t.headers,r=t.text,o=t.type;if(t.timeout)return Promise.reject(new Error("timeout"));var s=new i.default(n[e.tag+"-article"]),a=void 0,u=void 0;e.events.testID=n["x-testid"],e.events.articleId=s.id;try{await e.position.isDefinedPromise}catch(e){return console.error("WidgetPosition error: "+e),Promise.reject()}e.recommendationsBalancer.onRecommendationsReceived(e.widgetId,r,o),e.position.setFirstResponse({type:o,text:r,articleHeader:s}),a="sponsored"===o?e.recommendations.getNonSponsored(e.widgetOptionsId):e.recommendations.getSponsored(e.widgetOptionsId);var c=await a;e.recommendationsBalancer.onRecommendationsReceived(e.widgetId,c.text||"",c.type);try{u=await e.recommendationsBalancer.getBalancedRecommendations(e.widgetId)}catch(e){return console.error("WidgetPosition error: "+e),Promise.reject()}return e.position.setSecondResponse(Object.assign({},c,{text:u})),e.position.onClick(function(t){return e.events.click(t)}),e.events.elements[e.widgetOptionsId]=e.position.widgetContainer,c.timeout?Promise.reject(new Error("timeout")):Promise.resolve(e.widgetOptionsId)}).catch(function(t){if(e.recommendationsBalancer.onError(e.widgetId),t){var n=t.error;return Promise.reject(n)}return Promise.reject(t)})}}]),e}();n.default=a},{"./ArticleHeader":28,"./WidgetPosition":42}],40:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=s(e("./Widget")),i=s(e("./RecommendationsBalancer"));function s(e){return e&&e.__esModule?e:{default:e}}var a=function(){function e(t){var n=t.config,r=t.options,o=t.websiteProperties,i=t.events,s=t.recommendations,a=t.integrations,u=t.gdpr,c=t.dt;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=n,this.options=r,this.websiteProperties=o,this.events=i,this.recommendations=s,this.integrations=a,this.gdpr=u,this.dt=c,this.instancesOptions=[],this.instances=[]}return r(e,[{key:"init",value:async function(){var e=this,t=void 0;try{t=await this.websiteProperties.get()}catch(e){return void console.error("WebsiteProperties error: "+e)}this.events.journalId=t.id,this.events.switches=t.switches||{},this.gdpr.journalId=t.id,this.gdpr.switches=t.switches||{},this.dt.switches=t.switches||{},this.integrations._websiteId=t.id;var n=new i.default(t.widgets),r=t.widgets.map(function(r){var i=Object.assign({},r,{websiteId:t.id,switches:t.switches,hideWidget:t.hideExtraWidgets}),s=new o.default({config:e.config,options:e.options,events:e.events,recommendations:e.recommendations,instanceOptions:i,integrations:e.integrations,gdpr:e.gdpr,dt:e.dt,recommendationsBalancer:n});return e.instances.push(s),e.instancesOptions.push(i),s.init()}),s=await Promise.all(r.map(function(e){return e.catch(function(){return!1})})).then(function(e){return e.filter(function(e){return!1!==e})}),a=t.widgets.filter(function(e){return-1!==s.indexOf(e.id)}).reduce(function(e,t){return e+t.numberOfRecommendations},0);this.gdpr.widgetIsLoaded&&this.gdpr.addGaTrackingCode(),this.events.impression(s,a)}}]),e}();n.default=a},{"./RecommendationsBalancer":35,"./Widget":39}],41:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=s(e("superagent")),i=s(e("./TimeLogger"));function s(e){return e&&e.__esModule?e:{default:e}}var a=function(){function e(t){var n=t.config,r=t.eventLogger;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.apiUrl=n.apiUrl,this.tag=n.tag,this.version=n.version,this.integrationsEndpoint="/integrations",this.dataset=null,this._swoopInserted=!1,this._loopInitialized=!1,this._articleId=null,this._websiteId=null,this._swoopWebsiteId=null,this._pubn=null,this._inn=null,this._detected=null,this._initialized=!1,this._eventLogger=r}return r(e,[{key:"init",value:function(e){var t=e.dataset,n=e.articleId;this._initialized||(this._initialized=!0,this._articleId=n,this.dataset=t,this.swoopParseSimilarHtml())}},{key:"swoopParseSimilarHtml",value:function(){try{var e=this.dataset.trendmdSwoop,t=window.atob(e),n=JSON.parse(t),r=n.swi,o=n.pubn,i=n.inn;return this._swoopWebsiteId=r,this._pubn=o,this._inn=i,this._swoopAppend()}catch(e){return null}}},{key:"_loop",value:function(){this._swoopInserted||setTimeout(this._request.bind(this),5e3)}},{key:"loop",value:function(){return this._loopInitialized?null:(this._loopInitialized=!0,this._loop())}},{key:"_swoopAppend",value:function(){if(this._swoopWebsiteId&&this._pubn&&!this._swoopInserted){var e=document.createElement("script");return e.src="https://ardrone.swoop.com/js/spxw.js",e.id="swoop_sdk",e.dataset.domain=this._swoopWebsiteId,e.dataset.npi=this._pubn,document.getElementsByTagName("body")[0].appendChild(e),this._swoopLog(),this._swoopInserted=!0,!0}return!1}},{key:"_swoopLog",value:function(){return i.default.times.recos?this._eventLogger.log({},{swoop:this._swoopData()}):(this._eventLogger.swoopObj=this._swoopData(),null)}},{key:"_swoopData",value:function(){return{articleId:this._articleId,websiteId:this._websiteId,inn:this._inn,swoopId:this._swoopWebsiteId}}},{key:"_integration",value:function(e){return o.default.get(this.apiUrl.sponsored+this.integrationsEndpoint).set(this.tag+"-widget-version",this.version).withCredentials().end(e)}},{key:"_request",value:function(){var e=this;this._integration(function(t,n){if(t)return null;var r=n.body,o=r.inn,i=r.pubn,s=r.detected;return e._inn=o,e._pubn=i,e._detected=s,e._detected&&e._swoopWebsiteId&&!e._swoopAppend()?e._loop():null})}}]),e}();n.default=a},{"./TimeLogger":37,superagent:7}],42:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=a(e("domready")),s=a(e("./TimeLogger"));function a(e){return e&&e.__esModule?e:{default:e}}i.default.domready=i.default;var u=function(){function e(t){var n=t.config,r=t.options,o=t.instanceOptions,i=t.eventLogger,s=t.integrations,a=t.gdpr,u=t.dt;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var c=o.selectors,l=o.placementSelector,d=o.placementPosition,f=o.wrapperStart,h=o.wrapperEnd,p=o.numberOfRecommendations;this.numberOfRecommendations=p,this.mainWidget=0===o.widgetId,this.widgetId=o.widgetId,this.styleSheetUrl=n.styleSheetUrl,this.selectors=c,this.placementSelector=l,this.placementPosition=d,this.widgetWrapperStart=f,this.widgetWrapperEnd=h,this.options=r,this.config=n,this.integrations=s,this.gdpr=a,this.dt=u,this.responsesTracked=0,this.widgetIsInIframe=function(){try{return window.self!==window.top}catch(e){return!0}}(),this._widgetContainerSelector="."+this.config.tag+"-widget-container",this._dedicatedContainerSelector=this._widgetContainerSelector,this._adBlockCheckingContainerId=this.config.tag+"-check",this._journalId=o.id,this._switches=o.switches||{},this._eventLogger=i,this.handleIntegrations=function(){return null},this.isDefinedPromise=null}return o(e,[{key:"define",value:function(){var e=this;this.isDefinedPromise=new Promise(function(t,n){i.default.domready(function(){s.default.log("domReady");var r=document.querySelector(e.options.element),o=e.placementSelector?document.querySelector(e.placementSelector):null,i=!1;if(o){var a=window.getComputedStyle(o);i="hidden"!==a.getPropertyValue("visibility")&&"none"!==a.getPropertyValue("display")}e.wrapperStart="",e.wrapperEnd="",o&&i?(e.element=o,e.insertPosition=e.placementPosition||null,e.wrapperStart=e.widgetWrapperStart||"",e.wrapperEnd=e.widgetWrapperEnd||""):e.mainWidget&&(e.element=r),e.element?(e.dt.addDt(),e.addStyle(),"function"==typeof e.options.cbRetrieve&&e.options.cbRetrieve(),t("OK")):n(new Error("No element"))})})}},{key:"prepareIntegrations",value:function(e){var t=this,n=e.articleHeader;this.handleIntegrations=function(){t.integrations.init({dataset:t.dataset,articleId:n.id}),s.default.log("recos"),s.default.log("timeToClickStart"),t.checkAdBlock(),t.gdpr.widgetIsLoaded=!0,t._switches.isUS&&Array.prototype.forEach.call(document.querySelectorAll(".trendmd-widget-dns"),function(e){e.style.display="block"}),"function"==typeof t.options.cb&&t.options.cb()}}},{key:"setFirstResponse",value:function(e){var t=e.type,n=e.text,r=e.articleHeader,o=this.wrapResponsedText(n);this.insertPosition&&"replace"!==this.insertPosition?this.element.insertAdjacentHTML(this.insertPosition,o):this.element.innerHTML=o;var i=this.element.querySelector(this._widgetContainerSelector);i.setAttribute("similar-"+t+"-merged",!0),i.setAttribute("style","display: none;"),i.dataset[this.config.tag+"WidgetId"]=this.widgetId,this._dedicatedContainerSelector=this._widgetContainerSelector+'[data-trendmd-widget-id="'+this.widgetId+'"]',this.trackResponse(),this.prepareIntegrations({articleHeader:r})}},{key:"showWidget",value:function(){this.element.querySelector(this._dedicatedContainerSelector).setAttribute("style","")}},{key:"setSecondResponse",value:function(e){var t=e.type,n=e.text;if(n&&n.length){var r=document.createElement("html");r.innerHTML=n;var o=r.querySelectorAll("li.trendmd-widget-list-item").length,i=this.numberOfRecommendations>o;(this.mainWidget&&o>0||!i)&&(this.mergeSecondaryResponse(n,t),this.balanceListing(),this.showWidget())}this.trackResponse(),this.handleIntegrations()}},{key:"mergeSecondaryResponse",value:function(e,t){var n=this.element.querySelector(this._dedicatedContainerSelector),r=n.querySelectorAll("ol.trendmd-widget-list"),o=document.createElement("html");if(n.setAttribute("similar-"+t+"-merged",!0),o.innerHTML=e,Array.prototype.forEach.call(o.querySelectorAll("ol.trendmd-widget-list"),function(e,t){r[t].innerHTML=e.innerHTML}),"sponsored"===t){var i=o.querySelector(this._widgetContainerSelector);Object.keys(i.dataset).forEach(function(e){n.dataset[e]=i.dataset[e]})}}},{key:"balanceListing",value:function(){var e=this.element.querySelector(this._dedicatedContainerSelector).querySelectorAll("ol.trendmd-widget-list"),t=r(e,2),n=t[0],o=t[1];if(n&&o)for(var i=6,s=-(n.children.length+o.children.length)%2;o.children.length-n.children.length!==s;){if(o.children.length-n.children.length>s){var a=o.removeChild(o.children[0]);n.appendChild(a)}if(o.children.length-n.children.length<s){var u=n.removeChild(n.children[n.children.length-1]);o.insertBefore(u,o.children[0])}if(!(i-=1))return}}},{key:"trackResponse",value:function(){this.responsesTracked+=1,2===this.responsesTracked&&this.widgetIsInIframe&&window.parent.postMessage({linksLoaded:document.getElementsByClassName("trendmd-widget-list-item__link").length,sender:"trendmd"},"*")}},{key:"onClick",value:function(e){this.element.querySelector(this._dedicatedContainerSelector).onclick=function(t){"A"===t.target.tagName&&e(t.target)}}},{key:"wrapResponsedText",value:function(e){return this.wrapperStart+e.replace(/Pending(<span.*?),\s/gm,"$1")+this.wrapperEnd}},{key:"addStyle",value:function(){var e=document.querySelector('link[rel="stylesheet"][href="'+this.styleSheetUrl+'"]');if(e)return e;var t=document.createElement("link");return t.rel="stylesheet",t.type="text/css",t.href=this.styleSheetUrl,t.media="all",document.getElementsByTagName("head")[0].appendChild(t)}},{key:"checkAdBlock",value:function(){var e=document.getElementById(this._adBlockCheckingContainerId);if(e){var t=void 0,n=e.querySelector("#ad-holder");if(n)t="none"===window.getComputedStyle(n).display;else t=!0;this._eventLogger.hasAdBlock=t}}},{key:"dataset",get:function(){return this.element.querySelector(this._dedicatedContainerSelector).dataset}},{key:"widgetContainer",get:function(){return this.element.querySelector(this._dedicatedContainerSelector)}}]),e}();n.default=u},{"./TimeLogger":37,domready:3}],43:[function(e,t,n){(function(t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TrendMD=n.config=void 0;var r=i(e("../Initializer")),o=i(e("../../../version"));function i(e){return e&&e.__esModule?e:{default:e}}var s=n.config={tag:"trendmd",apiUrl:{sponsored:"undefined"!=typeof RSEnvEndpoint&&RSEnvEndpoint?RSEnvEndpoint:"https://www.trendmd.com",nonSponsored:"undefined"!=typeof RSEnvEndpoint&&RSEnvEndpoint?RSEnvEndpoint:"https://cc.trendmd.co"},relevancyUrl:"undefined"!=typeof CollectorEnvEndpoint&&CollectorEnvEndpoint?CollectorEnvEndpoint:"https://academia.trendmd.com",styleSheetUrl:"https://trendmd.s3.amazonaws.com/trendmd.min.css",dtConfig:{dmd:{origin:"https://www.medtargetsystem.com",path:"/beacon/portal-lite"},lhk:{api:"https://caramel.press"}},version:o.default},a=n.TrendMD=r.default;t.TrendMD=new a(s)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../version":44,"../Initializer":33}],44:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default="3.0.5"},{}]},{},[43]);