/*! visualCaptcha - v0.0.8 - 2016-01-23
* http://visualcaptcha.net
* Copyright (c) 2016 emotionLoop; Licensed MIT */

/**
 * @license almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

!function(a,b){"function"==typeof define&&define.amd?define(["jquery"],b):b(a.jQuery)}(this,function(a){var b,c,d;!function(a){function p(a,b){return m.call(a,b)}function q(a,b){var c,d,e,f,g,h,i,j,l,m,n,p=b&&b.split("/"),q=k.map,r=q&&q["*"]||{};if(a&&"."===a.charAt(0))if(b){for(p=p.slice(0,p.length-1),a=a.split("/"),g=a.length-1,k.nodeIdCompat&&o.test(a[g])&&(a[g]=a[g].replace(o,"")),a=p.concat(a),l=0;l<a.length;l+=1)if(n=a[l],"."===n)a.splice(l,1),l-=1;else if(".."===n){if(1===l&&(".."===a[2]||".."===a[0]))break;l>0&&(a.splice(l-1,2),l-=2)}a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((p||r)&&q){for(c=a.split("/"),l=c.length;l>0;l-=1){if(d=c.slice(0,l).join("/"),p)for(m=p.length;m>0;m-=1)if(e=q[p.slice(0,m).join("/")],e&&(e=e[d])){f=e,h=l;break}if(f)break;!i&&r&&r[d]&&(i=r[d],j=l)}!f&&i&&(f=i,h=j),f&&(c.splice(0,h,f),a=c.join("/"))}return a}function r(b,c){return function(){return f.apply(a,n.call(arguments,0).concat([b,c]))}}function s(a){return function(b){return q(b,a)}}function t(a){return function(b){i[a]=b}}function u(b){if(p(j,b)){var c=j[b];delete j[b],l[b]=!0,e.apply(a,c)}if(!p(i,b)&&!p(l,b))throw new Error("No "+b);return i[b]}function v(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function w(a){return function(){return k&&k.config&&k.config[a]||{}}}var e,f,g,h,i={},j={},k={},l={},m=Object.prototype.hasOwnProperty,n=[].slice,o=/\.js$/;g=function(a,b){var c,d=v(a),e=d[0];return a=d[1],e&&(e=q(e,b),c=u(e)),e?a=c&&c.normalize?c.normalize(a,s(b)):q(a,b):(a=q(a,b),d=v(a),e=d[0],a=d[1],e&&(c=u(e))),{f:e?e+"!"+a:a,n:a,pr:e,p:c}},h={require:function(a){return r(a)},exports:function(a){var b=i[a];return"undefined"!=typeof b?b:i[a]={}},module:function(a){return{id:a,uri:"",exports:i[a],config:w(a)}}},e=function(b,c,d,e){var f,k,m,n,o,v,q=[],s=typeof d;if(e=e||b,"undefined"===s||"function"===s){for(c=!c.length&&d.length?["require","exports","module"]:c,o=0;o<c.length;o+=1)if(n=g(c[o],e),k=n.f,"require"===k)q[o]=h.require(b);else if("exports"===k)q[o]=h.exports(b),v=!0;else if("module"===k)f=q[o]=h.module(b);else if(p(i,k)||p(j,k)||p(l,k))q[o]=u(k);else{if(!n.p)throw new Error(b+" missing "+k);n.p.load(n.n,r(e,!0),t(k),{}),q[o]=i[k]}m=d?d.apply(i[b],q):void 0,b&&(f&&f.exports!==a&&f.exports!==i[b]?i[b]=f.exports:m===a&&v||(i[b]=m))}else b&&(i[b]=d)},b=c=f=function(b,c,d,i,j){if("string"==typeof b)return h[b]?h[b](c):u(g(b,c).f);if(!b.splice){if(k=b,k.deps&&f(k.deps,k.callback),!c)return;c.splice?(b=c,c=d,d=null):b=a}return c=c||function(){},"function"==typeof d&&(d=i,i=j),i?e(a,b,c,d):setTimeout(function(){e(a,b,c,d)},4),f},f.config=function(a){return f(a)},b._defined=i,d=function(a,b,c){b.splice||(c=b,b=[]),p(i,a)||p(j,a)||(j[a]=[a,b,c])},d.amd={jQuery:!0}}(),d("almond",function(){}),d("visualcaptcha/core",[],function(){"use strict";var a,b,c,d,e,f,g,h;return a=function(a,b,c){return c=c||[],a.namespace&&a.namespace.length>0&&c.push(a.namespaceFieldName+"="+a.namespace),c.push(a.randomParam+"="+a.randomNonce),b+"?"+c.join("&")},b=function(a){var d,b=this;a.applyRandomNonce(),a.isLoading=!0,d=c(a),a._loading(b),a.callbacks.loading&&a.callbacks.loading(b),a.request(d,function(c){c.audioFieldName&&(a.audioFieldName=c.audioFieldName),c.imageFieldName&&(a.imageFieldName=c.imageFieldName),c.imageName&&(a.imageName=c.imageName),c.values&&(a.imageValues=c.values),a.isLoading=!1,a.hasLoaded=!0,a._loaded(b),a.callbacks.loaded&&a.callbacks.loaded(b)})},c=function(b){var c=b.url+b.routes.start+"/"+b.numberOfImages;return a(b,c)},d=function(b,c){var d="",e=[];return c<0||c>=b.numberOfImages?d:(this.isRetina()&&e.push("retina=1"),d=b.url+b.routes.image+"/"+c,a(b,d,e))},e=function(b,c){var d=b.url+b.routes.audio;return c&&(d+="/ogg"),a(b,d)},f=function(a,b){return b>=0&&b<a.numberOfImages?a.imageValues[b]:""},g=function(){return void 0!==window.devicePixelRatio&&window.devicePixelRatio>1},h=function(){var a,b=!1;try{a=document.createElement("audio"),a.canPlayType&&(b=!0)}catch(a){}return b},function(a){var c,i,j,k,l,m,n,o,p,q,r,s,t;return i=function(){return b.call(this,a)},j=function(){return a.isLoading},k=function(){return a.hasLoaded},l=function(){return a.imageValues.length},m=function(){return a.imageName},n=function(b){return f.call(this,a,b)},o=function(b){return d.call(this,a,b)},p=function(b){return e.call(this,a,b)},q=function(){return a.imageFieldName},r=function(){return a.audioFieldName},s=function(){return a.namespace},t=function(){return a.namespaceFieldName},c={refresh:i,isLoading:j,hasLoaded:k,numberOfImages:l,imageName:m,imageValue:n,imageUrl:o,audioUrl:p,imageFieldName:q,audioFieldName:r,namespace:s,namespaceFieldName:t,isRetina:g,supportsAudio:h},a.autoRefresh&&c.refresh(),c}}),d("visualcaptcha/xhr-request",[],function(){"use strict";var a=window.XMLHttpRequest;return function(b,c){var d=new a;d.open("GET",b,!0),d.onreadystatechange=function(){var a;4===d.readyState&&200===d.status&&(a=JSON.parse(d.responseText),c(a))},d.send()}}),d("visualcaptcha/config",["visualcaptcha/xhr-request"],function(a){"use strict";return function(b){var c=window.location.href.split("/");c[c.length-1]="";var d={request:a,url:c.join("/").slice(0,-1),namespace:"",namespaceFieldName:"namespace",routes:{start:"/start",image:"/image",audio:"/audio"},isLoading:!1,hasLoaded:!1,autoRefresh:!0,numberOfImages:6,randomNonce:"",randomParam:"r",audioFieldName:"",imageFieldName:"",imageName:"",imageValues:[],callbacks:{},_loading:function(){},_loaded:function(){}};return d.applyRandomNonce=function(){return d.randomNonce=Math.random().toString(36).substring(2)},b.request&&(d.request=b.request),b.url&&(d.url=b.url),b.namespace&&(d.namespace=b.namespace),b.namespaceFieldName&&(d.namespaceFieldName=b.namespaceFieldName),"undefined"!=typeof b.autoRefresh&&(d.autoRefresh=b.autoRefresh),b.numberOfImages&&(d.numberOfImages=b.numberOfImages),b.routes&&(b.routes.start&&(d.routes.start=b.routes.start),b.routes.image&&(d.routes.image=b.routes.image),b.routes.audio&&(d.routes.audio=b.routes.audio)),b.randomParam&&(d.randomParam=b.randomParam),b.callbacks&&(b.callbacks.loading&&(d.callbacks.loading=b.callbacks.loading),b.callbacks.loaded&&(d.callbacks.loaded=b.callbacks.loaded)),b._loading&&(d._loading=b._loading),b._loaded&&(d._loaded=b._loaded),d}}),d("visualcaptcha",["require","visualcaptcha/core","visualcaptcha/config"],function(a){"use strict";var b=a("visualcaptcha/core"),c=a("visualcaptcha/config");return function(a){return a=a||{},b(c(a))}}),d("visualcaptcha/templates",[],function(){"use strict";var a,b,c,d,e,f,g;return a=function(a,b){for(var c in b)a=a.replace(new RegExp("{"+c+"}","g"),b[c]);return a},b=function(b,c,d){var e,f,g,h;return e='<div class="visualCaptcha-accessibility-button" id="captcha-audio-challenge"><a href="#"><img src="{path}accessibility{retinaExtra}.png" title="{accessibilityTitle}" alt="{accessibilityAlt}" /></a></div>',f='<div class="visualCaptcha-refresh-button"><a href="#"><img src="{path}refresh{retinaExtra}.png" title="{refreshTitle}" alt="{refreshAlt}" /></a></div>',g='<div class="visualCaptcha-button-group">'+f+(b.supportsAudio()?e:"")+"</div>",h={path:d||"",refreshTitle:c.refreshTitle,refreshAlt:c.refreshAlt,accessibilityTitle:c.accessibilityTitle,accessibilityAlt:c.accessibilityAlt,retinaExtra:b.isRetina()?"@2x":""},a(g,h)},c=function(b,c){var d,e;return b.supportsAudio()?(d='<div class="visualCaptcha-accessibility-wrapper visualCaptcha-hide"><div class="accessibility-description">{accessibilityDescription}</div><audio preload="preload"><source src="{audioURL}" type="audio/ogg" /><source src="{audioURL}" type="audio/mpeg" /></audio></div>',e={accessibilityDescription:c.accessibilityDescription,audioURL:b.audioUrl(),audioFieldName:b.audioFieldName()},a(d,e)):""},d=function(b,c){for(var e,f,d="",g=0,h=b.numberOfImages();g<h;g++)e='<div class="img"><a href="#"><img src="{imageUrl}" id="visualCaptcha-img-{i}" data-index="{i}" alt="Visual cue {count}" title=""/></a></div>',f={imageUrl:b.imageUrl(g),i:g,count:g+1},d+=a(e,f);return e='<p class="visualCaptcha-explanation">{explanation}</p><div class="visualCaptcha-possibilities" aria-hidden="true">{images}</div>',f={imageFieldName:b.imageFieldName(),explanation:c.explanation.replace(/ANSWER/,b.imageName()),images:d},a(e,f)},e=function(b){var c,d;return c='<input class="form-control audioField" type="text" aria-label="Answer to the audio challenge" name="{audioFieldName}" value="" autocomplete="off" />',d={audioFieldName:b.audioFieldName()},a(c,d)},f=function(b,c){var d,e;return d='<input class="form-control imageField" type="hidden" name="{imageFieldName}" value="{value}" readonly="readonly" />',e={imageFieldName:b.imageFieldName(),value:b.imageValue(c)},a(d,e)},g=function(b){var c,d,e=b.namespace();return e&&0!==e.length?(c='<input type="hidden" name="{fieldName}" value="{value}" />',d={fieldName:b.namespaceFieldName(),value:e},a(c,d)):""},{buttons:b,accessibility:c,images:d,audioInput:e,imageInput:f,namespaceInput:g}}),d("visualcaptcha/language",[],function(){"use strict";return{accessibilityAlt:"Sound icon",accessibilityTitle:"Accessibility option: listen to a question and answer it!",accessibilityDescription:"Type below the <strong>answer</strong> to what you hear. Numbers or words:",explanation:"Click or touch the <strong>ANSWER</strong>",refreshAlt:"Refresh/reload icon",refreshTitle:"Refresh/reload: get new images and accessibility option!"}}),d("visualcaptcha.jquery",["jquery","visualcaptcha","visualcaptcha/templates","visualcaptcha/language"],function(a,b,c,d){"use strict";var e,f,g,h,i,j,k;e=function(b,c){a.get(b,c,"json")},f=function(){},g=function(a,b,d){var e;e=c.namespaceInput(d)+c.accessibility(d,a.language)+c.images(d,a.language)+c.buttons(d,a.language,a.imgPath),b.html(e)},h=function(){var h,b=a(this).closest(".visualCaptcha"),d=b.find(".visualCaptcha-accessibility-wrapper"),e=b.find(".visualCaptcha-possibilities"),f=b.find(".visualCaptcha-explanation"),g=d.find("audio");d.hasClass("visualCaptcha-hide")?(e.toggleClass("visualCaptcha-hide"),f.toggleClass("visualCaptcha-hide"),e.find(".img").removeClass("visualCaptcha-selected"),f.find("input").val(""),h=c.audioInput(b.data("captcha")),a(h).insertAfter(b.children().last()),d.toggleClass("visualCaptcha-hide"),g[0].load(),g[0].play()):(g[0].pause(),d.toggleClass("visualCaptcha-hide"),b.find("input").remove(),f.toggleClass("visualCaptcha-hide"),e.toggleClass("visualCaptcha-hide"))},i=function(){var g,h,i,b=a(this),d=b.closest(".visualCaptcha"),e=d.find(".visualCaptcha-possibilities"),f=d.find(".visualCaptcha-explanation");h=f.find("input"),h&&(h.remove(),e.find(".img").removeClass("visualCaptcha-selected")),b.addClass("visualCaptcha-selected"),g=b.find("img").data("index"),i=c.imageInput(d.data("captcha"),g),f.append(a(i))},j=function(){var b=a(this).closest(".visualCaptcha");b.data("captcha").refresh()},k=function(a){var b=a.find(".imageField"),c=a.find(".audioField"),d=!(!b.val()&&!c.val());return d?{valid:d,name:b.val()?b.attr("name"):c.attr("name"),value:b.val()?b.val():c.val()}:{valid:d}},a.fn.visualCaptcha=function(c){var l;return l=a.extend({imgPath:"/",language:d,captcha:{request:e}},c),this.addClass("visualCaptcha").on("click",".visualCaptcha-accessibility-button",h).on("click",".visualCaptcha-refresh-button",j).on("click",".visualCaptcha-possibilities .img",i),this.each(function(){var d,e,c=a(this);e=a.extend(l.captcha,{_loading:f.bind(null,l,c),_loaded:g.bind(null,l,c)}),"undefined"!=typeof c.data("namespace")&&(e.namespace=c.data("namespace")),d=b(e),d.getCaptchaData=k.bind(null,c),c.data("captcha",d)})}}),d("jquery",function(){return a}),c("visualcaptcha.jquery")});