/*
 Fresco - A Beautiful Responsive Lightbox - v2.1.4
 (c) 2012-2016 Nick Stakenburg

 http://www.frescojs.com

 License: http://www.frescojs.com/license
 imagesLoaded PACKAGED v3.1.8
 JavaScript is all like "You images are done yet or what?"
 MIT License
 EventEmitter v4.2.6 - git.io/ee
 Oliver Caldwell
 MIT license
 @preserve
 eventie v1.0.4
 event binding helper
   eventie.bind( elem, 'click', myFn )
   eventie.unbind( elem, 'click', myFn )
 imagesLoaded v3.1.8
 JavaScript is all like "You images are done yet or what?"
 MIT License
 Lazy Load XT v1.0.6 2014-11-19
 http://ressio.github.io/lazy-load-xt
 (C) 2014 RESS.io
 Licensed under MIT */
!function(a,k){"function"==typeof define&&define.amd?define(["jquery"],k):"object"==typeof module&&module.exports?module.exports=k(require("jquery")):a.Fresco=k(jQuery)}(this,function(a){function k(){return this.initialize.apply(this,q.call(arguments))}function h(b){var f={type:"image"};return a.each(J,function(a,c){var n=c.data(b);n&&(f=n,f.type=a,f.url=b)}),f}function e(b){return(b=(b||"").replace(/\?.*/g,"").match(/\.([^.]{3,4})$/))?b[1].toLowerCase():null}function t(){this.initialize.apply(this,
q.call(arguments))}function u(){this.initialize.apply(this,q.call(arguments))}var l={};a.extend(l,{version:"2.1.4"});l.Skins={fresco:{}};var g={viewport:function(){var b={width:a(window).width()};b.height=c.MobileSafari||c.Android&&c.Gecko?document.documentElement.clientWidth/window.innerWidth*window.innerHeight:a(window).height();return b}},c=function(b){function a(a){return(a=(new RegExp(a+"([\\d.]+)")).exec(b))?parseFloat(a[1]):!0}return{IE:!(!window.attachEvent||-1!==b.indexOf("Opera"))&&a("MSIE "),
Opera:-1<b.indexOf("Opera")&&(!!window.opera&&opera.version&&parseFloat(opera.version())||7.55),WebKit:-1<b.indexOf("AppleWebKit/")&&a("AppleWebKit/"),Gecko:-1<b.indexOf("Gecko")&&-1===b.indexOf("KHTML")&&a("rv:"),MobileSafari:!!b.match(/Apple.*Mobile.*Safari/),Chrome:-1<b.indexOf("Chrome")&&a("Chrome/"),ChromeMobile:-1<b.indexOf("CrMo")&&a("CrMo/"),Android:-1<b.indexOf("Android")&&a("Android "),IEMobile:-1<b.indexOf("IEMobile")&&a("IEMobile/")}}(navigator.userAgent),q=Array.prototype.slice,x={isElement:function(b){return b&&
1==b.nodeType},String:{capitalize:function(b){return b="string"==typeof b?b:null==b?"":b+"",b&&b.charAt(0).toUpperCase()+b.slice(1)}}};!function(){a(document.documentElement).on("mousewheel DOMMouseScroll",function(b){var f;if(b.originalEvent.wheelDelta?f=b.originalEvent.wheelDelta/120:b.originalEvent.detail&&(f=-b.originalEvent.detail/3),f){var r=a.Event("fresco:mousewheel");a(b.target).trigger(r,f);r.isPropagationStopped()&&b.stopPropagation();r.isDefaultPrevented()&&b.preventDefault()}})}();var B=
{within:function(b,f,r){var c=a.extend({height:!0,width:!0},r||{}),n=a.extend({},f);r=5;for(var d=c.width,c=c.height;0<r&&(d&&n.width>b.width||c&&n.height>b.height);){var m=1,g=1;d&&n.width>b.width&&(m=b.width/n.width);c&&n.height>b.height&&(g=b.height/n.height);n=Math.min(m,g);n={width:Math.round(f.width*n),height:Math.round(f.height*n)};r--}return n.width=Math.max(n.width,0),n.height=Math.max(n.height,0),n}};a.extend(a.easing,{frescoEaseInCubic:function(b,a,r,c,n){return c*(a/=n)*a*a+r},frescoEaseInSine:function(b,
a,r,c,n){return-c*Math.cos(a/n*(Math.PI/2))+c+r},frescoEaseOutSine:function(b,a,r,c,n){return c*Math.sin(a/n*(Math.PI/2))+r}});var v=function(){function b(b,f){var n=b.charAt(0).toUpperCase()+b.substr(1),c;a:{n=(b+" "+r.join(n+" ")+n).split(" ");for(c in n)if(void 0!==a.style[n[c]]){c="prefix"==f?n[c]:!0;break a}c=!1}return c}var a=document.createElement("div"),r=["Webkit","Moz","O","ms","Khtml"],c=function(){var b=document.createElement("canvas");return!(!b.getContext||!b.getContext("2d"))}(),n=
{animation:b("animation"),transform:b("transform"),prefixed:function(a){return b(a,"prefix")}},d=!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,m;try{m=!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)}catch(K){m=!1}return{canvas:c,css:n,svg:d,touch:m}}();v.detectMobileTouch=function(){v.mobileTouch=v.touch&&(c.MobileSafari||c.Android||c.IEMobile||c.ChromeMobile||!/^(Win|Mac|Linux)/.test(navigator.platform))};
v.detectMobileTouch();var y=function(){return this.initialize.apply(this,Array.prototype.slice.call(arguments))};a.extend(y.prototype,{supports:{naturalWidth:"naturalWidth"in new Image},initialize:function(b,f,c,d){return this.img=a(b)[0],this.successCallback=f,this.errorCallback=c,this.isLoaded=!1,this.options=a.extend({method:"naturalWidth",pollFallbackAfter:1E3},d||{}),this.supports.naturalWidth&&"onload"!=this.options.method?this.img.complete&&"undefined"!=a.type(this.img.naturalWidth)?void setTimeout(a.proxy(function(){0<
this.img.naturalWidth?this.success():this.error()},this)):(a(this.img).bind("error",a.proxy(function(){setTimeout(a.proxy(function(){this.error()},this))},this)),this.intervals=[[1E3,10],[2E3,50],[4E3,100],[2E4,500]],this._ipos=0,this._time=0,this._delay=this.intervals[this._ipos][1],void this.poll()):void setTimeout(a.proxy(this.fallback,this))},poll:function(){this._polling=setTimeout(a.proxy(function(){if(0<this.img.naturalWidth)return void this.success();if(this._time+=this._delay,this.options.pollFallbackAfter&&
this._time>=this.options.pollFallbackAfter&&!this._usedPollFallback&&(this._usedPollFallback=!0,this.fallback()),this._time>this.intervals[this._ipos][0]){if(!this.intervals[this._ipos+1])return void this.error();this._ipos++;this._delay=this.intervals[this._ipos][1]}this.poll()},this),this._delay)},fallback:function(){var b=new Image;this._fallbackImg=b;b.onload=a.proxy(function(){b.onload=function(){};this.supports.naturalWidth||(this.img.naturalWidth=b.width,this.img.naturalHeight=b.height);this.success()},
this);b.onerror=a.proxy(this.error,this);b.src=this.img.src},abort:function(){this._fallbackImg&&(this._fallbackImg.onload=function(){});this._polling&&(clearTimeout(this._polling),this._polling=null)},success:function(){this._calledSuccess||(this._calledSuccess=!0,this.isLoaded=!0,this.successCallback(this))},error:function(){this._calledError||(this._calledError=!0,this.abort(),this.errorCallback&&this.errorCallback(this))}});a.extend(k.prototype,{initialize:function(){this._timers={}},set:function(b,
a,c){this._timers[b]=setTimeout(a,c)},get:function(b){return this._timers[b]},clear:function(b){b?this._timers[b]&&(clearTimeout(this._timers[b]),delete this._timers[b]):this.clearAll()},clearAll:function(){a.each(this._timers,function(b,a){clearTimeout(a)});this._timers={}}});var z={isVideo:function(b){return/^(youtube|vimeo)$/.test(b)}},J={image:{extensions:"bmp gif jpeg jpg png webp",detect:function(b){return-1<a.inArray(e(b),this.extensions.split(" "))},data:function(b){return this.detect()?{extension:e(b)}:
!1}},vimeo:{detect:function(b){return(b=/(vimeo\.com)\/([a-zA-Z0-9-_]+)(?:\S+)?$/i.exec(b))&&b[2]?b[2]:!1},data:function(b){return(b=this.detect(b))?{id:b}:!1}},youtube:{detect:function(b){var a=/(youtube\.com|youtu\.be)\/watch\?(?=.*vi?=([a-zA-Z0-9-_]+))(?:\S+)?$/.exec(b);return a&&a[2]?a[2]:(a=/(youtube\.com|youtu\.be)\/(vi?\/|u\/|embed\/)?([a-zA-Z0-9-_]+)(?:\S+)?$/i.exec(b),a&&a[3]?a[3]:!1)},data:function(b){return(b=this.detect(b))?{id:b}:!1}}},D=function(){var b=function(){return this.initialize.apply(this,
q.call(arguments))};a.extend(b.prototype,{initialize:function(b,a,f){this.url=b;this.successCallback=a;this.errorCallback=f;this.load()},load:function(){var b=f.get(this.url);if(b)return this.successCallback(b.data.url);var b="http"+(window.location&&"https:"==window.location.protocol?"s":"")+":",c=h(this.url).id;this._xhr=a.getJSON(b+"//vimeo.com/api/oembed.json?url="+b+"//vimeo.com/"+c+"&callback=?",a.proxy(function(b){b&&b.thumbnail_url?(b={url:b.thumbnail_url},f.set(this.url,b),this.successCallback(b.url)):
this.errorCallback()},this))},abort:function(){this._xhr&&(this._xhr.abort(),this._xhr=null)}});var f={cache:[],get:function(b){for(var a=null,f=0;f<this.cache.length;f++)this.cache[f]&&this.cache[f].url==b&&(a=this.cache[f]);return a},set:function(b,a){this.remove(b);this.cache.push({url:b,data:a})},remove:function(b){for(var a=0;a<this.cache.length;a++)this.cache[a]&&this.cache[a].url==b&&delete this.cache[a]}};return b}(),H=function(){var b=function(){return this.initialize.apply(this,q.call(arguments))};
a.extend(b.prototype,{initialize:function(b,a){this.url=b;this.callback=a;this.load()},load:function(){var b=f.get(this.url);if(b)return this.callback(b.data);var b="http"+(window.location&&"https:"==window.location.protocol?"s":"")+":",c=h(this.url).id;this._xhr=a.getJSON(b+"//vimeo.com/api/oembed.json?url="+b+"//vimeo.com/"+c+"&callback=?",a.proxy(function(b){b={dimensions:{width:b.width,height:b.height}};f.set(this.url,b);this.callback&&this.callback(b)},this))},abort:function(){this._xhr&&(this._xhr.abort(),
this._xhr=null)}});var f={cache:[],get:function(b){for(var a=null,f=0;f<this.cache.length;f++)this.cache[f]&&this.cache[f].url==b&&(a=this.cache[f]);return a},set:function(b,a){this.remove(b);this.cache.push({url:b,data:a})},remove:function(b){for(var a=0;a<this.cache.length;a++)this.cache[a]&&this.cache[a].url==b&&delete this.cache[a]}};return b}(),F={defaults:{effects:{content:{show:0,hide:0},spinner:{show:150,hide:150},window:{show:440,hide:300},thumbnail:{show:300,delay:150},thumbnails:{slide:0}},
keyboard:{left:!0,right:!0,esc:!0},loadedMethod:"naturalWidth",loop:!1,onClick:"previous-next",overflow:!1,overlay:{close:!0},preload:[1,2],position:!0,skin:"fresco",spinner:!0,spinnerDelay:300,sync:!0,thumbnails:"horizontal",ui:"outside",uiDelay:3E3,vimeo:{autoplay:1,api:1,title:1,byline:1,portrait:0,loop:0},youtube:{autoplay:1,controls:1,enablejsapi:1,hd:1,iv_load_policy:3,loop:0,modestbranding:1,rel:0,vq:"hd1080"},initialTypeOptions:{image:{},vimeo:{width:1280},youtube:{width:1280,height:720}}},
create:function(b,f,d){b=b||{};d=d||{};b.skin=b.skin||this.defaults.skin;var r=b.skin?a.extend({},l.Skins[b.skin]||l.Skins[this.defaults.skin]):{},r=a.extend(!0,{},this.defaults,r);r.initialTypeOptions&&(f&&r.initialTypeOptions[f]&&(r=a.extend(!0,{},r.initialTypeOptions[f],r)),delete r.initialTypeOptions);var n=a.extend(!0,{},r,b);if(v.mobileTouch&&"inside"==n.ui&&(n.ui="outside"),(!n.effects||c.IE&&9>c.IE)&&(n.effects={},a.each(this.defaults.effects,function(b,f){a.each(n.effects[b]=a.extend({},
f),function(a){n.effects[b][a]=0})}),n.spinner=!1),n.keyboard&&("boolean"==a.type(n.keyboard)&&(n.keyboard={},a.each(this.defaults.keyboard,function(b,a){n.keyboard[b]=!0})),("vimeo"==f||"youtube"==f)&&a.extend(n.keyboard,{left:!1,right:!1})),!n.overflow||v.mobileTouch?n.overflow={x:!1,y:!1}:"boolean"==a.type(n.overflow)&&(n.overflow={x:!1,y:!0}),("vimeo"==f||"youtube"==f)&&(n.overlap=!1),(c.IE&&9>c.IE||v.mobileTouch)&&(n.thumbnail=!1,n.thumbnails=!1),"youtube"!=f&&(n.width&&!n.maxWidth&&(n.maxWidth=
n.width),n.height&&!n.maxHeight&&(n.maxHeight=n.height)),!n.thumbnail&&"boolean"!=a.type(n.thumbnail)){b=!1;switch(f){case "youtube":b="http"+(window.location&&"https:"==window.location.protocol?"s":"")+"://img.youtube.com/vi/"+d.id+"/0.jpg";break;case "image":case "vimeo":b=!0}n.thumbnail=b}return n}},C={initialize:function(){this.build();this.visible=!1},build:function(){this.element=a("<div>").addClass("fr-overlay").hide().append(a("<div>").addClass("fr-overlay-background"));this.element.on("click",
a.proxy(function(){var b=m.page;b&&b.view&&b.view.options.overlay&&!b.view.options.overlay.close||d.hide()},this));v.mobileTouch&&this.element.addClass("fr-mobile-touch");this.element.on("fresco:mousewheel",function(b){b.preventDefault()})},setSkin:function(b){this.skin&&this.element.removeClass("fr-overlay-skin-"+this.skin);this.element.addClass("fr-overlay-skin-"+b);this.skin=b},attach:function(){a(document.body).append(this.element)},detach:function(){this.element.detach()},show:function(b,f){if(this.visible)return void(b&&
b());this.visible=!0;this.attach();this.max();var c=m.page&&m.page.view.options.effects.window.show||0,c=("number"==a.type(f)?f:c)||0;this.element.stop(!0).fadeTo(c,1,b)},hide:function(b,f){if(!this.visible)return void(b&&b());var c=m.page&&m.page.view.options.effects.window.hide||0,c=("number"==a.type(f)?f:c)||0;this.element.stop(!0).fadeOut(c||0,a.proxy(function(){this.detach();this.visible=!1;b&&b()},this))},getScrollDimensions:function(){var b={};return a.each(["width","height"],function(a,d){var f=
d.substr(0,1).toUpperCase()+d.substr(1),n=document.documentElement;b[d]=(c.IE?Math.max(n["offset"+f],n["scroll"+f]):c.WebKit?document.body["scroll"+f]:n["scroll"+f])||0}),b},max:function(){var b;if(c.MobileSafari&&c.WebKit&&533.18>c.WebKit&&(b=this.getScrollDimensions(),this.element.css(b)),c.IE&&9>c.IE){var a=g.viewport();this.element.css({height:a.height,width:a.width})}v.mobileTouch&&!b&&this.element.css({height:this.getScrollDimensions().height})}},d={initialize:function(){this.queues=[];this.queues.hide=
a({});this.pages=[];this._tracking=[];this._first=!0;this.timers=new k;this.build();this.setSkin(F.defaults.skin)},build:function(){if(this.element=a("<div>").addClass("fr-window fr-measured").hide().append(this._box=a("<div>").addClass("fr-box").append(this._pages=a("<div>").addClass("fr-pages"))).append(this._thumbnails=a("<div>").addClass("fr-thumbnails")),C.initialize(),m.initialize(this._pages),E.initialize(this._thumbnails),w.initialize(),A.initialize(),this.element.addClass("fr"+(v.mobileTouch?
"":"-no")+"-mobile-touch"),this.element.addClass("fr"+(v.svg?"":"-no")+"-svg"),c.IE)for(var b=7;9>=b;b++)c.IE<b&&this.element.addClass("fr-ltIE"+b);this.element.on("fresco:mousewheel",function(b){b.preventDefault()})},attach:function(){this._attached||(a(document.body).append(this.element),this._attached=!0)},detach:function(){this._attached&&(this.element.detach(),this._attached=!1)},setSkin:function(b){this._skin&&this.element.removeClass("fr-window-skin-"+this._skin);this.element.addClass("fr-window-skin-"+
b);C.setSkin(b);this._skin=b},setShowingType:function(b){this._showingType!=b&&(this._showingType&&(this.element.removeClass("fr-showing-type-"+this._showingType),z.isVideo(this._showingType)&&this.element.removeClass("fr-showing-type-video")),this.element.addClass("fr-showing-type-"+b),z.isVideo(b)&&this.element.addClass("fr-showing-type-video"),this._showingType=b)},startObservingResize:function(){this._onWindowResizeHandler||a(window).on("resize orientationchange",this._onWindowResizeHandler=a.proxy(this._onWindowResize,
this))},stopObservingResize:function(){this._onWindowResizeHandler&&(a(window).off("resize orientationchange",this._onWindowResizeHandler),this._onWindowResizeHandler=null)},_onScroll:function(){v.mobileTouch&&this.timers.set("scroll",a.proxy(this.adjustToScroll,this),0)},_onWindowResize:function(){var b;(b=m.page)&&(E.fitToViewport(),this.updateBoxDimensions(),b.fitToBox(),A.update(),A.adjustPrevNext(null,0),w.center(),C.max(),A._onWindowResize(),this._onScroll())},adjustToScroll:function(){v.mobileTouch&&
this.element.css({top:a(window).scrollTop()})},getBoxDimensions:function(){return this._boxDimensions},updateBoxDimensions:function(){if(m.page){var b=g.viewport(),f=E.getDimensions(),c="horizontal"==E._orientation;this._boxDimensions={width:c?b.width:b.width-f.width,height:c?b.height-f.height:b.height};this._boxPosition={top:0,left:c?0:f.width};this._box.css(a.extend({},this._boxDimensions,this._boxPosition))}},show:function(b,f){if(this.visible)return void(b&&b());this.opening=this.visible=!0;this.attach();
this.timers.clear("show-window");this.timers.clear("hide-overlay");this.adjustToScroll();var c=("number"==a.type(f)?f:m.page&&m.page.view.options.effects.window.show)||0,d=2;C[m.page&&m.page.view.options.overlay?"show":"hide"](function(){b&&1>--d&&b()},c);this.timers.set("show-window",a.proxy(function(){this._show(a.proxy(function(){this.opening=!1;b&&1>--d&&b()},this),c)},this),1<c?Math.min(.5*c,50):1)},_show:function(b,f){var c=("number"==a.type(f)?f:m.page&&m.page.view.options.effects.window.show)||
0;this.element.stop(!0).fadeTo(c,1,b)},hide:function(b){if(this.view){var f=this.queues.hide;f.queue([]);this.timers.clear("show-window");this.timers.clear("hide-overlay");var c=m.page?m.page.view.options.effects.window.hide:0;f.queue(a.proxy(function(b){m.stop();w.hide();b()},this));f.queue(a.proxy(function(b){A.disable();A.hide(null,c);p.disable();b()},this));f.queue(a.proxy(function(b){var f=2;this._hide(function(){1>--f&&b()},c);this.timers.set("hide-overlay",a.proxy(function(){C.hide(function(){1>
--f&&b()},c)},this),1<c?Math.min(.5*c,150):1);this._first=!0},this));f.queue(a.proxy(function(b){this._reset();this.stopObservingResize();m.removeAll();E.clear();this.timers.clear();this._position=-1;var f=m.page&&m.page.view.options.afterHide;"function"==a.type(f)&&f.call(l);this.view=null;this.closing=this.opening=!1;this.detach();b()},this));"function"==a.type(b)&&f.queue(a.proxy(function(a){b();a()},this))}},_hide:function(b,f){var c=("number"==a.type(f)?f:m.page&&m.page.view.options.effects.window.hide)||
0;this.element.stop(!0).fadeOut(c,b)},load:function(b,a){this.views=b;this.attach();E.load(b);m.load(b);this.startObservingResize();a&&this.setPosition(a)},setPosition:function(b,f){this._position=b;this.view=this.views[b-1];this.stopHideQueue();this.page=m.show(b,a.proxy(function(){f&&f()},this))},stopHideQueue:function(){this.queues.hide.queue([])},_reset:function(){this.visible=!1;A.hide(null,0);A.reset()},mayPrevious:function(){return this.view&&this.view.options.loop&&this.views&&1<this.views.length||
1!=this._position},previous:function(b){var a=this.mayPrevious();(b||a)&&this.setPosition(this.getSurroundingIndexes().previous)},mayNext:function(){var b=this.views&&1<this.views.length;return this.view&&this.view.options.loop&&b||b&&1!=this.getSurroundingIndexes().next},next:function(b){var a=this.mayNext();(b||a)&&this.setPosition(this.getSurroundingIndexes().next)},getSurroundingIndexes:function(){if(!this.views)return{};var b=this._position,a=this.views.length;return{previous:1>=b?a:b-1,next:b>=
a?1:b+1}}},p={enabled:!1,keyCode:{left:37,right:39,esc:27},enable:function(b){this.disable();b&&(a(document).on("keydown",this._onKeyDownHandler=a.proxy(this.onKeyDown,this)).on("keyup",this._onKeyUpHandler=a.proxy(this.onKeyUp,this)),this.enabled=b)},disable:function(){this.enabled=!1;this._onKeyUpHandler&&(a(document).off("keyup",this._onKeyUpHandler).off("keydown",this._onKeyDownHandler),this._onKeyUpHandler=this._onKeyDownHandler=null)},onKeyDown:function(b){if(this.enabled){var a=this.getKeyByKeyCode(b.keyCode);
if(a&&(!a||!this.enabled||this.enabled[a]))switch(b.preventDefault(),b.stopPropagation(),a){case "left":d.previous();break;case "right":d.next()}}},onKeyUp:function(b){if(this.enabled&&(b=this.getKeyByKeyCode(b.keyCode))&&(!b||!this.enabled||this.enabled[b]))switch(b){case "esc":d.hide()}},getKeyByKeyCode:function(b){for(var a in this.keyCode)if(this.keyCode[a]==b)return a;return null}},G=function(){function b(){return this.initialize.apply(this,q.call(arguments))}var f=0,c={},g=a("<div>").addClass("fr-stroke fr-stroke-top fr-stroke-horizontal").append(a("<div>").addClass("fr-stroke-color")).add(a("<div>").addClass("fr-stroke fr-stroke-bottom fr-stroke-horizontal").append(a("<div>").addClass("fr-stroke-color"))).add(a("<div>").addClass("fr-stroke fr-stroke-left fr-stroke-vertical").append(a("<div>").addClass("fr-stroke-color"))).add(a("<div>").addClass("fr-stroke fr-stroke-right fr-stroke-vertical").append(a("<div>").addClass("fr-stroke-color")));
return a.extend(b.prototype,{initialize:function(b,c,d){this.view=b;this.dimensions={width:0,height:0};this.uid=f++;this._position=c;this._total=d;this._visible=this._fullClick=!1;this.queues={};this.queues.showhide=a({})},create:function(){if(!this._created){m.element.append(this.element=a("<div>").addClass("fr-page").append(this.container=a("<div>").addClass("fr-container")).css({opacity:0}).hide());var b=this.view.options.position&&1<this._total;if(b&&this.element.addClass("fr-has-position"),(this.view.caption||
b)&&(this.element.append(this.info=a("<div>").addClass("fr-info").append(a("<div>").addClass("fr-info-background")).append(g.clone(!0)).append(this.infoPadder=a("<div>").addClass("fr-info-padder"))),b&&(this.element.addClass("fr-has-position"),this.infoPadder.append(this.pos=a("<div>").addClass("fr-position").append(a("<span>").addClass("fr-position-text").html(this._position+" / "+this._total)))),this.view.caption&&this.infoPadder.append(this.caption=a("<div>").addClass("fr-caption").html(this.view.caption))),
this.container.append(this.background=a("<div>").addClass("fr-content-background")).append(this.content=a("<div>").addClass("fr-content")),"image"==this.view.type&&(this.content.append(this.image=a("<img>").addClass("fr-content-element").attr({src:this.view.url})),this.content.append(g.clone(!0))),b&&"outside"==this.view.options.ui&&this.container.append(this.positionOutside=a("<div>").addClass("fr-position-outside").append(a("<div>").addClass("fr-position-background")).append(a("<span>").addClass("fr-position-text").html(this._position+
" / "+this._total))),"inside"==this.view.options.ui)this.content.append(this.previousInside=a("<div>").addClass("fr-side fr-side-previous fr-toggle-ui").append(a("<div>").addClass("fr-side-button").append(a("<div>").addClass("fr-side-button-background")).append(a("<div>").addClass("fr-side-button-icon")))).append(this.nextInside=a("<div>").addClass("fr-side fr-side-next fr-toggle-ui").append(a("<div>").addClass("fr-side-button").append(a("<div>").addClass("fr-side-button-background")).append(a("<div>").addClass("fr-side-button-icon")))).append(this.closeInside=
a("<div>").addClass("fr-close fr-toggle-ui").append(a("<div>").addClass("fr-close-background")).append(a("<div>").addClass("fr-close-icon"))),(this.view.caption||b&&this.view.grouped.caption)&&(this.content.append(this.infoInside=a("<div>").addClass("fr-info fr-toggle-ui").append(a("<div>").addClass("fr-info-background")).append(g.clone(!0)).append(this.infoPadderInside=a("<div>").addClass("fr-info-padder"))),b&&this.infoPadderInside.append(this.posInside=a("<div>").addClass("fr-position").append(a("<span>").addClass("fr-position-text").html(this._position+
" / "+this._total))),this.view.caption&&this.infoPadderInside.append(this.captionInside=a("<div>").addClass("fr-caption").html(this.view.caption))),this.view.caption||!b||this.view.grouped.caption||this.content.append(this.positionInside=a("<div>").addClass("fr-position-inside fr-toggle-ui").append(a("<div>").addClass("fr-position-background")).append(a("<span>").addClass("fr-position-text").html(this._position+" / "+this._total))),b=this.view.options.loop&&1<this._total||this._position<this._total,
this.previousInside[(this.view.options.loop&&1<this._total||1!=this._position?"remove":"add")+"Class"]("fr-side-disabled"),this.nextInside[(b?"remove":"add")+"Class"]("fr-side-disabled");a.each(["x","y"],a.proxy(function(b,a){this.view.options.overflow[a]&&this.element.addClass("fr-overflow-"+a)},this));this.element.addClass("fr-type-"+this.view.type);z.isVideo(this.view.type)&&this.element.addClass("fr-type-video");2>this._total&&this.element.addClass("fr-no-sides");this._created=!0}},_getSurroundingPages:function(){var b;
if(!(b=this.view.options.preload))return[];var a=[],f=Math.max(1,this._position-b[0]);b=Math.min(this._position+b[1],this._total);for(var c=this._position,d=c;b>=d;d++){var g=m.pages[d-1];g._position!=c&&a.push(g)}for(d=c;d>=f;d--)g=m.pages[d-1],g._position!=c&&a.push(g);return a},preloadSurroundingImages:function(){var b=this._getSurroundingPages();a.each(b,a.proxy(function(b,a){a.preload()},this))},preload:function(){this.preloading||this.preloaded||"image"!=this.view.type||!this.view.options.preload||
this.loaded||(this.create(),this.preloading=!0,this.preloadReady=new y(this.image[0],a.proxy(function(b){this.loaded=!0;c[this.view.url]=!0;this.preloading=!1;this.preloaded=!0;this.dimensions={width:b.img.naturalWidth,height:b.img.naturalHeight}},this),null,{method:"naturalWidth"}))},load:function(b,f){if(this.create(),this.loaded)return void(b&&b());switch(this.abort(),this.loading=!0,this.view.options.spinner&&(this._spinnerDelay=setTimeout(a.proxy(function(){w.show()},this),this.view.options.spinnerDelay||
0)),this.view.type){case "image":if(this.error)return void(b&&b());this.imageReady=new y(this.image[0],a.proxy(function(a){this._markAsLoaded();this.setDimensions({width:a.img.naturalWidth,height:a.img.naturalHeight});b&&b()},this),a.proxy(function(){this._markAsLoaded();this.image.hide();this.content.prepend(this.error=a("<div>").addClass("fr-error fr-content-element").append(a("<div>").addClass("fr-error-icon")));this.element.addClass("fr-has-error");this.setDimensions({width:this.error.outerWidth(),
height:this.error.outerHeight()});this.error.css({width:"100%",height:"100%"});b&&b()},this),{method:this.view.options.loadedMethod});break;case "vimeo":this.vimeoReady=new H(this.view.url,a.proxy(function(a){this._markAsLoaded();this.setDimensions({width:a.dimensions.width,height:a.dimensions.height});b&&b()},this));break;case "youtube":this._markAsLoaded(),this.setDimensions({width:this.view.options.width,height:this.view.options.height}),b&&b()}},setDimensions:function(b){if(this.dimensions=b,
this.view.options.maxWidth||this.view.options.maxHeight)b=this.view.options,this.dimensions=B.within({width:b.maxWidth?b.maxWidth:this.dimensions.width,height:b.maxHeight?b.maxHeight:this.dimensions.height},this.dimensions)},_markAsLoaded:function(){this._abortSpinnerDelay();this.loading=!1;this.loaded=!0;c[this.view.url]=!0;w.hide(null,null,this._position)},isVideo:function(){return z.isVideo(this.view.type)},insertVideo:function(b){if(this.playerIframe||!this.isVideo())return void(b&&b());var f=
"http"+(window.location&&"https:"==window.location.protocol?"s":"")+":",c=a.extend({},this.view.options[this.view.type]||{}),c=a.param(c),f={vimeo:f+"//player.vimeo.com/video/{id}?{queryString}",youtube:f+"//www.youtube.com/embed/{id}?{queryString}"}[this.view.type].replace("{id}",this.view._data.id).replace("{queryString}",c);this.content.prepend(this.playerIframe=a("<iframe webkitAllowFullScreen mozallowfullscreen allowFullScreen>").addClass("fr-content-element").attr({src:f,height:this._contentDimensions.height,
width:this._contentDimensions.width,frameborder:0}));b&&b()},raise:function(){var b=m.element[0].lastChild;b&&b==this.element[0]||m.element.append(this.element)},show:function(b){var f=this.queues.showhide;f.queue([]);f.queue(a.proxy(function(b){var a=this.view.options.spinner&&!c[this.view.url];w._visible&&!a&&w.hide();m.stopInactive();b()},this));f.queue(a.proxy(function(b){this.updateUI();A.set(this._ui);b()},this));f.queue(a.proxy(function(b){p.enable(this.view.options.keyboard);b()},this));f.queue(a.proxy(function(b){w.setSkin(this.view.options.skin);
this.load(a.proxy(function(){this.preloadSurroundingImages();b()},this))},this));f.queue(a.proxy(function(b){this.raise();d.setSkin(this.view.options.skin);A.enable();this.fitToBox();d.adjustToScroll();b()},this));this.isVideo()&&f.queue(a.proxy(function(b){this.insertVideo(a.proxy(function(){b()}))},this));this.view.options.sync||f.queue(a.proxy(function(b){m.hideInactive(b)},this));f.queue(a.proxy(function(b){var f=3,c=this.view.options.effects.content.show;d.setShowingType(this.view.type);d.visible||
(c=this.view.options.effects.window.show,"function"==a.type(this.view.options.onShow)&&this.view.options.onShow.call(l));this.view.options.sync&&(f++,m.hideInactive(function(){1>--f&&b()}));d.show(function(){1>--f&&b()},this.view.options.effects.window.show);this._show(function(){1>--f&&b()},c);A.adjustPrevNext(function(){1>--f&&b()},d._first?0:c);d._first?(A.show(null,0),d._first=!1):A.show(null,0);c=this.view.options.afterPosition;"function"==a.type(c)&&c.call(l,this._position)},this));f.queue(a.proxy(function(a){this._visible=
!0;b&&b();a()},this))},_show:function(b,f){var c=d.visible?"number"==a.type(f)?f:this.view.options.effects.content.show:0;this.element.stop(!0).show().fadeTo(c||0,1,b)},hide:function(b,f){if(!this.element)return void(b&&b());this.removeVideo();this.abort();var c="number"==a.type(f)?f:this.view.options.effects.content.hide;this.isVideo()&&(c=0);this.element.stop(!0).fadeTo(c,0,"frescoEaseInCubic",a.proxy(function(){this.element.hide();this._visible=!1;m.removeTracking(this._position);b&&b()},this))},
stop:function(){this.queues.showhide.queue([]);this.element&&this.element.stop(!0);this.abort()},removeVideo:function(){this.playerIframe&&(this.playerIframe[0].src="//about:blank",this.playerIframe.remove(),this.playerIframe=null)},remove:function(){this.stop();this.removeVideo();this.element&&this.element.remove();this._track&&(m.removeTracking(this._position),this._track=!1);this.preloadReady&&(this.preloadReady.abort(),this.preloadReady=null,this.preloading=null,this.preloaded=null);this._visible=
!1;this.removed=!0},abort:function(){this.imageReady&&(this.imageReady.abort(),this.imageReady=null);this.vimeoReady&&(this.vimeoReady.abort(),this.vimeoReady=null);this._abortSpinnerDelay();this.loading=!1},_abortSpinnerDelay:function(){this._spinnerDelay&&(clearTimeout(this._spinnerDelay),this._spinnerDelay=null)},_getInfoHeight:function(b){var a=this.view.options.position&&1<this._total;switch(this._ui){case "fullclick":case "inside":if(!this.view.caption&&!a)return 0;break;case "outside":if(!this.view.caption)return 0}a=
"inside"==this._ui?this.infoInside:this.info;"outside"==this._ui&&(b=Math.min(b,d._boxDimensions.width));var f,c=a[0].style.width;return("inside"==this._ui||"fullclick"==this._ui)&&(c="100%"),a.css({width:b+"px"}),f=parseFloat(a.outerHeight()),a.css({width:c}),f},_whileVisible:function(b,f){var c=[],g=d.element.add(this.element);f&&(g=g.add(f));a.each(g,function(b,f){a(f).is(":visible")||c.push(a(f).show())});g=this.element.hasClass("fr-no-caption");this.element.removeClass("fr-no-caption");var m=
this.element.hasClass("fr-has-caption");this.element.addClass("fr-has-caption");d.element.css({visibility:"hidden"});b();d.element.css({visibility:"visible"});g&&this.element.addClass("fr-no-caption");m||this.element.removeClass("fr-has-caption");a.each(c,function(b,a){a.hide()})},updateForced:function(){this.create();this._fullClick=this.view.options.fullClick;this._noOverflow=!1;0<parseInt(this.element.css("min-width"))&&(this._fullClick=!0);0<parseInt(this.element.css("min-height"))&&(this._noOverflow=
!0)},updateUI:function(b){this.updateForced();b=this._fullClick?"fullclick":this.view.options.ui;this._ui&&this.element.removeClass("fr-ui-"+this._ui);this.element.addClass("fr-ui-"+b);this._ui=b},fitToBox:function(){if(this.content){var b=(this.element,a.extend({},d.getBoxDimensions())),f=a.extend({},this.dimensions),c=this.container;this.updateUI();c={left:parseInt(c.css("padding-left")),top:parseInt(c.css("padding-top"))};if("outside"==this._ui&&this._positionOutside){var g=0;this._whileVisible(a.proxy(function(){this._positionOutside.is(":visible")&&
(g=this._positionOutside.outerWidth(!0))},this));g>c.left&&(c.left=g)}b.width-=2*c.left;b.height-=2*c.top;var l,e={width:!0,height:this._noOverflow?!0:!this.view.options.overflow.y},f=B.within(b,f,e),r=a.extend({},f),p=(this.content,0),h=(f="inside"==this._ui)?this.infoInside:this.info,w=f?this.captionInside:this.caption,G=f?this.posInside:this.pos,k=!!w;switch(this._ui){case "outside":var q,x=a.extend({},r);this.caption&&(q=this.caption,this._whileVisible(a.proxy(function(){for(var a=0;2>a;){p=this._getInfoHeight(r.width);
var f=b.height-r.height;p>f&&(r=B.within({width:r.width,height:Math.max(r.height-(p-f),0)},r,e));a++}p=this._getInfoHeight(r.width);(!this.view.options.overflow.y&&p+r.height>b.height||h&&"none"==h.css("display")||p>=.5*r.height)&&(k=!1,p=0,r=x)},this),q));h&&h.css({width:r.width+"px"});l={width:r.width,height:r.height+p};break;case "inside":this.caption&&(q=w,this._whileVisible(a.proxy(function(){p=this._getInfoHeight(r.width);p>=.45*r.height&&(k=!1,p=0)},this),q));l=r;break;case "fullclick":q=[],
w&&q.push(w),this._whileVisible(a.proxy(function(){if((w||G)&&h.css({width:"100%"}),p=this._getInfoHeight(d._boxDimensions.width),w&&p>.5*b.height)if(k=!1,G){var a=this.caption.is(":visible");this.caption.hide();p=this._getInfoHeight(d._boxDimensions.width);a&&this.caption.show()}else p=0;l=r=B.within({width:b.width,height:Math.max(0,b.height-p)},r,e)},this),q),this.content.css({"padding-bottom":0})}w&&w[k?"show":"hide"]();this.element[(k?"remove":"add")+"Class"]("fr-no-caption");this.element[(k?
"add":"remove")+"Class"]("fr-has-caption");this.content.css(r);this.background.css(l);this.playerIframe&&this.playerIframe.attr(r);this.overlap={y:l.height+("fullclick"==this._ui?p:0)-d._boxDimensions.height,x:0};this._track=!this._noOverflow&&this.view.options.overflow.y&&0<this.overlap.y;this._infoHeight=p;this._padding=c;this._contentDimensions=r;this._backgroundDimensions=l;m[(this._track?"set":"remove")+"Tracking"](this._position);this.position()}},position:function(){if(this.content){var b=
this._contentDimensions,a=this._backgroundDimensions,f={top:.5*d._boxDimensions.height-.5*a.height,left:.5*d._boxDimensions.width-.5*a.width},c={top:f.top+b.height,left:f.left},g=0,r="inside"==this._ui?this.infoInside:this.info;switch(this._ui){case "fullclick":f.top=.5*(d._boxDimensions.height-this._infoHeight)-.5*a.height;c={top:d._boxDimensions.height-this._infoHeight,left:0,bottom:"auto"};g=this._infoHeight;break;case "inside":c={top:"auto",left:0,bottom:0}}if(0<this.overlap.y)switch(a=m.getXYP(),
f.top=0-a.y*this.overlap.y,this._ui){case "outside":case "fullclick":c.top=d._boxDimensions.height-this._infoHeight;break;case "inside":if(b=f.top+b.height-d._boxDimensions.height,a=-1*f.top,c.bottom=b,this.closeInside.css({top:a}),1<this._total){var p=d.element.is(":visible");p||d.element.show();var l=this.previousInside.attr("style");this.previousInside.removeAttr("style");var e=parseInt(this.previousInside.css("margin-top"));this.previousInside.attr({style:l});p||d.element.hide();this.previousInside.add(this.nextInside).css({"margin-top":e+
(a-.5*this.overlap.y)});this.positionInside&&this.positionInside.css({bottom:b})}}else"inside"==this._ui&&this.element.find(".fr-info, .fr-side, .fr-close, .fr-position-inside").removeAttr("style");r&&r.css(c);this.container.css({bottom:g});this.content.css(f);this.background.css(f)}}}),b}(),m={initialize:function(b){this.element=b;this.pages=[];this.uid=1;this._tracking=[]},load:function(b){this.views=b;this.removeAll();a.each(b,a.proxy(function(b,a){this.pages.push(new G(a,b+1,this.views.length))},
this))},show:function(b,f){var c=this.pages[b-1];this.page&&this.page.uid==c.uid||(this.page=c,E.show(b),d.updateBoxDimensions(),c.show(a.proxy(function(){f&&f()},this)))},getPositionInActivePageGroup:function(b){var f=0;return a.each(this.pages,function(a,c){c.view.element&&c.view.element==b&&(f=a+1)}),f},getLoadingCount:function(){var b=0;return a.each(this.pages,function(a,c){c.loading&&b++}),b},removeAll:function(){a.each(this.pages,function(b,a){a.remove()});this.pages=[]},hideInactive:function(b,
f){var c=[];a.each(this.pages,a.proxy(function(b,a){a.uid!=this.page.uid&&c.push(a)},this));var d=0+c.length;return 1>d?b&&b():a.each(c,function(a,c){c.hide(function(){b&&1>--d&&b()},f)}),c.length},stopInactive:function(){a.each(this.pages,a.proxy(function(b,a){a.uid!=this.page.uid&&a.stop()},this))},stop:function(){a.each(this.pages,function(b,a){a.stop()})},handleTracking:function(b){c.IE&&9>c.IE?(this.setXY({x:b.pageX,y:b.pageY}),this.updatePositions()):this._tracking_timer=setTimeout(a.proxy(function(){this.setXY({x:b.pageX,
y:b.pageY});this.updatePositions()},this),30)},clearTrackingTimer:function(){this._tracking_timer&&(clearTimeout(this._tracking_timer),this._tracking_timer=null)},startTracking:function(){v.mobileTouch||this._handleTracking||a(document.documentElement).on("mousemove",this._handleTracking=a.proxy(this.handleTracking,this))},stopTracking:function(){!v.mobileTouch&&this._handleTracking&&(a(document.documentElement).off("mousemove",this._handleTracking),this._handleTracking=null,this.clearTrackingTimer())},
setTracking:function(b){this.isTracking(b)||(this._tracking.push(this.pages[b-1]),1==this._tracking.length&&this.startTracking())},clearTracking:function(){this._tracking=[]},removeTracking:function(b){this._tracking=a.grep(this._tracking,function(a){return a._position!=b});1>this._tracking.length&&this.stopTracking()},isTracking:function(b){var f=!1;return a.each(this._tracking,function(a,c){return c._position==b?(f=!0,!1):void 0}),f},setXY:function(b){this._xy=b},getXYP:function(b){var f=m.page,
c=a.extend({},d._boxDimensions);b=a.extend({},this._xy);b.y-=a(window).scrollTop();f&&("outside"==f._ui||"fullclick"==f._ui)&&0<f._infoHeight&&(c.height-=f._infoHeight);b.y-=d._boxPosition.top;var g={x:0,y:Math.min(Math.max(b.y/c.height,0),1)},p={x:"width",y:"height"},l={};return a.each(["y"],a.proxy(function(b,a){l[a]=Math.min(Math.max(20/c[p[a]],0),1);g[a]*=1+2*l[a];g[a]-=l[a];g[a]=Math.min(Math.max(g[a],0),1)},this)),this.setXYP(g),this._xyp},setXYP:function(b){this._xyp=b},updatePositions:function(){1>
this._tracking.length||a.each(this._tracking,function(b,a){a.position()})}};a.extend(t.prototype,{initialize:function(b,f){var c=f||{},d;"string"==a.type(b)?b={url:b}:b&&1==b.nodeType&&(d=a(b),b={element:d[0],url:d.attr("href"),caption:d.data("fresco-caption"),group:d.data("fresco-group"),extension:d.data("fresco-extension"),type:d.data("fresco-type"),options:d.data("fresco-options")&&eval("({"+d.data("fresco-options")+"})")||{}});b&&(b.extension||(b.extension=e(b.url)),!b.type)&&(d=h(b.url),b._data=
d,b.type=d.type);return b._data||(b._data=h(b.url)),b&&b.options?b.options=a.extend(!0,a.extend({},c),a.extend({},b.options)):b.options=a.extend({},c),b.options=F.create(b.options,b.type,b._data),a.extend(this,b),this}});var w={supported:v.css.transform&&v.css.animation,initialize:function(b){this.element=a("<div>").addClass("fr-spinner").hide();for(b=1;12>=b;b++)this.element.append(a("<div>").addClass("fr-spin-"+b));this.element.on("click",a.proxy(function(){d.hide()},this));this.element.on("fresco:mousewheel",
function(b){b.preventDefault()})},setSkin:function(b){this.supported&&(this._skin&&this.element.removeClass("fr-spinner-skin-"+this._skin),this.updateDimensions(),this.element.addClass("fr-spinner-skin-"+b),this._skin=b)},updateDimensions:function(){var b=this._attached;b||this.attach();this._dimensions={width:this.element.outerWidth(),height:this.element.outerHeight()};b||this.detach()},attach:function(){this._attached||(a(document.body).append(this.element),this._attached=!0)},detach:function(){this._attached&&
(this.element.detach(),this._attached=!1)},show:function(b,f){this._visible=!0;this.attach();this.center();var c=m.page&&m.page.view.options.effects.spinner.show||0,c=("number"==a.type(f)?f:c)||0;this.element.stop(!0).fadeTo(c,1,b)},hide:function(b,f,c){this._visible=!1;c=m.page&&m.page.view.options.effects.spinner.hide||0;f=("number"==a.type(f)?f:c)||0;this.element.stop(!0).fadeOut(f||0,a.proxy(function(){this.detach();b&&b()},this))},center:function(){if(this.supported){this._dimensions||this.updateDimensions();
var b=m.page,a=0;b&&"fullclick"==b._ui&&b._whileVisible(function(){a=b._getInfoHeight(d._boxDimensions.width)});this.element.css({top:d._boxPosition.top+.5*d._boxDimensions.height-.5*this._dimensions.height-.5*a,left:d._boxPosition.left+.5*d._boxDimensions.width-.5*this._dimensions.width})}}},I={_disabled:!1,_fallback:!0,initialize:function(){d.initialize();this._disabled||this.startDelegating()},startDelegating:function(){this._delegateHandler||a(document.documentElement).on("click",".fresco[href]",
this._delegateHandler=a.proxy(this.delegate,this)).on("click",this._setClickXYHandler=a.proxy(this.setClickXY,this))},stopDelegating:function(){this._delegateHandler&&(a(document.documentElement).off("click",".fresco[href]",this._delegateHandler).off("click",this._setClickXYHandler),this._setClickXYHandler=null,this._delegateHandler=null)},setClickXY:function(b){m.setXY({x:b.pageX,y:b.pageY})},delegate:function(b){if(!this._disabled){b.stopPropagation();b.preventDefault();var a=b.currentTarget;this.setClickXY(b);
I.show(a)}},show:function(b){if(this._disabled)return void this.showFallback.apply(I,q.call(arguments));var f=arguments[1]||{},c=arguments[2];arguments[1]&&"number"==a.type(arguments[1])&&(c=arguments[1],f={});var g=[],p=x.isElement(b);switch(a.type(b)){case "string":case "object":var l=new t(b,f);if(l.group){if(p){var l=a('.fresco[data-fresco-group="'+a(b).data("fresco-group")+'"]'),e={};l.filter("[data-fresco-group-options]").each(function(b,f){a.extend(e,eval("({"+(a(f).attr("data-fresco-group-options")||
"")+"})"))});l.each(function(d,l){c||l!=b||(c=d+1);g.push(new t(l,a.extend({},e,f)))})}}else e={},p&&a(b).is("[data-fresco-group-options]")&&(a.extend(e,eval("({"+(a(b).attr("data-fresco-group-options")||"")+"})")),l=new t(b,a.extend({},e,f))),g.push(l);break;case "array":a.each(b,function(b,a){var c=new t(a,f);g.push(c)})}var h={grouped:{caption:!1}},w=g[0].options.ui;a.each(g,function(b,a){a.caption&&(h.grouped.caption=!0);0<b&&a.options.ui!=w&&(a.options.ui=w)});a.each(g,function(b,f){a.extend(f,
h)});(!c||1>c)&&(c=1);c>g.length&&(c=g.length);var k;p&&(k=m.getPositionInActivePageGroup(b))?d.setPosition(k):d.load(g,c)},showFallback:function(){function b(f){var c=a.type(f);return"string"==c?f:"array"==c&&f[0]?b(f[0]):x.isElement(f)&&a(f).attr("href")?a(f).attr("href"):f.url?f.url:!1}return function(a){this._fallback&&(a=b(a))&&(window.location.href=a)}}()};a.extend(l,{show:function(b){return I.show.apply(I,q.call(arguments)),this},hide:function(){return d.hide(),this},disable:function(){return I.stopDelegating(),
I._disabled=!0,this},enable:function(){return I._disabled=!1,I.startDelegating(),this},fallback:function(b){return I._fallback=b,this},setDefaultSkin:function(b){return F.defaults.skin=b,this}});(c.IE&&7>c.IE||"number"==a.type(c.Android)&&3>c.Android||c.MobileSafari&&"number"==a.type(c.WebKit)&&533.18>c.WebKit)&&(I.show=I.showFallback);var E={initialize:function(b){this.element=b;this._thumbnails=[];this._orientation="vertical";this._vars={thumbnail:{},thumbnailFrame:{},thumbnails:{}};this.build();
this.startObserving()},build:function(){this.element.append(this.wrapper=a("<div>").addClass("fr-thumbnails-wrapper").append(this._slider=a("<div>").addClass("fr-thumbnails-slider").append(this._previous=a("<div>").addClass("fr-thumbnails-side fr-thumbnails-side-previous").append(this._previous_button=a("<div>").addClass("fr-thumbnails-side-button").append(a("<div>").addClass("fr-thumbnails-side-button-background")).append(a("<div>").addClass("fr-thumbnails-side-button-icon")))).append(this._thumbs=
a("<div>").addClass("fr-thumbnails-thumbs").append(this._slide=a("<div>").addClass("fr-thumbnails-slide"))).append(this._next=a("<div>").addClass("fr-thumbnails-side fr-thumbnails-side-next").append(this._next_button=a("<div>").addClass("fr-thumbnails-side-button").append(a("<div>").addClass("fr-thumbnails-side-button-background")).append(a("<div>").addClass("fr-thumbnails-side-button-icon"))))))},startObserving:function(){this._slider.delegate(".fr-thumbnail","click",a.proxy(function(b){b.stopPropagation();
(b=(b=a(b.target).closest(".fr-thumbnail")[0])&&a(b).data("fr-position"))&&(this.setActive(b),d.setPosition(b))},this));this._slider.bind("click",function(b){b.stopPropagation()});this._previous.bind("click",a.proxy(this.previousPage,this));this._next.bind("click",a.proxy(this.nextPage,this))},load:function(b){this.clear();var f="horizontal",c=!1;a.each(b,a.proxy(function(b,a){"vertical"==a.options.thumbnails&&(f="vertical");a.options.thumbnails||(c=!0)},this));this.setOrientation(f);this._disabledGroup=
c;a.each(b,a.proxy(function(b,a){this._thumbnails.push(new u(a,b+1))},this));this.fitToViewport()},clear:function(){a.each(this._thumbnails,function(b,a){a.remove()});this._thumbnails=[];this._page=this._position=-1},setOrientation:function(b){this._orientation&&d.element.removeClass("fr-thumbnails-"+this._orientation);d.element.addClass("fr-thumbnails-"+b);this._orientation=b},disable:function(){d.element.removeClass("fr-thumbnails-enabled").addClass("fr-thumbnails-disabled");this._disabled=!0},
enable:function(){d.element.removeClass("fr-thumbnails-disabled").addClass("fr-thumbnails-enabled");this._disabled=!1},enabled:function(){return!this._disabled},disabled:function(){return this._disabled},updateVars:function(){var b=d.element,f=this._vars,c="horizontal"==this._orientation,l=c?"top":"left",p=c?"left":"top",m=c?"bottom":"left",e=c?"top":"right",h=c?"width":"height",w=c?"height":"width",k={left:"right",right:"left",top:"bottom",bottom:"top"};this.element.removeClass("fr-thumbnails-measured");
var G=b.is(":visible");if(G||b.show(),this.disabled()&&this.enable(),!this.element.is(":visible")||2>this._thumbnails.length||this._disabledGroup)return this.disable(),a.extend(this._vars.thumbnails,{width:0,height:0}),G||b.hide(),void this.element.addClass("fr-thumbnails-measured");this.enable();var q=this._previous,y=this._next,B=g.viewport(),w=this.element["inner"+x.String.capitalize(w)](),l=parseInt(this._thumbs.css("padding-"+l))||0,z=Math.max(w-2*l,0),t=parseInt(this._thumbs.css("padding-"+
p))||0,m=(parseInt(this.element.css("margin-"+m))||0)+(parseInt(this.element.css("margin-"+e))||0);a.extend(f.thumbnails,{height:w+m,width:B[c?"width":"height"],paddingTop:l});a.extend(f.thumbnail,{height:z,width:z});a.extend(f.thumbnailFrame,{width:z+2*t,height:w});f.sides={previous:{width:y["inner"+x.String.capitalize(h)](),marginLeft:parseInt(q.css("margin-"+p))||0,marginRight:parseInt(q.css("margin-"+k[p]))||0},next:{width:y["inner"+x.String.capitalize(h)](),marginLeft:parseInt(y.css("margin-"+
p))||0,marginRight:parseInt(y.css("margin-"+k[p]))||0}};p=B[h];h=f.thumbnailFrame.width;c=this._thumbnails.length;f.thumbnails.width=p;f.sides.enabled=1<c*h/p;k=p;y=f.sides;q=y.previous;y=y.next;q=q.marginLeft+q.width+q.marginRight+y.marginLeft+y.width+y.marginRight;f.sides.enabled&&(k-=q);k=Math.floor(k/h)*h;y=c*h;k>y&&(k=y);q=k+(f.sides.enabled?q:0);f.ipp=k/h;this._mode="page";1>=f.ipp&&(k=p,q=p,f.sides.enabled=!1,this._mode="center");f.pages=Math.ceil(c*h/k);f.wrapper={width:q+1,height:w};f.thumbs=
{width:k,height:w};f.slide={width:c*h+1,height:w};G||b.hide();this.element.addClass("fr-thumbnails-measured")},hide:function(){this.disable();this.thumbnails.hide();this._visible=!1},getDimensions:function(){var b="horizontal"==this._orientation;return{width:b?this._vars.thumbnails.width:this._vars.thumbnails.height,height:b?this._vars.thumbnails.height:this._vars.thumbnails.width}},fitToViewport:function(){if(this.updateVars(),!this.disabled()){var b=a.extend({},this._vars),c="horizontal"==this._orientation;
a.each(this._thumbnails,function(b,a){a.resize()});this._previous[b.sides.enabled?"show":"hide"]();this._next[b.sides.enabled?"show":"hide"]();this._thumbs.css({width:b.thumbs[c?"width":"height"],height:b.thumbs[c?"height":"width"]});this._slide.css({width:b.slide[c?"width":"height"],height:b.slide[c?"height":"width"]});var d={width:b.wrapper[c?"width":"height"],height:b.wrapper[c?"height":"width"]};d["margin-"+(c?"left":"top")]=Math.round(-.5*b.wrapper.width)+"px";d["margin-"+(c?"top":"left")]=0;
this.wrapper.css(d);this._position&&this.moveTo(this._position,!0)}},moveToPage:function(b){1>b||b>this._vars.pages||b==this._page||this.moveTo(this._vars.ipp*(b-1)+1)},previousPage:function(){this.moveToPage(this._page-1)},nextPage:function(){this.moveToPage(this._page+1)},show:function(b){var a=0>this._position;1>b&&(b=1);var c=this._thumbnails.length;b>c&&(b=c);this._position=b;this.setActive(b);"page"==this._mode&&this._page==Math.ceil(b/this._vars.ipp)||this.moveTo(b,a)},moveTo:function(b,c){if(this.updateVars(),
!this.disabled()){var f,d="horizontal"==this._orientation,p=.5*g.viewport()[d?"width":"height"];f=this._vars.thumbnailFrame.width;"page"==this._mode?(this._page=p=Math.ceil(b/this._vars.ipp),f=-1*f*(this._page-1)*this._vars.ipp,this._previous_button[(2>p?"add":"remove")+"Class"]("fr-thumbnails-side-button-disabled"),this._next_button[(p>=this._vars.pages?"add":"remove")+"Class"]("fr-thumbnails-side-button-disabled")):f=p+-1*(f*(b-1)+.5*f);var p=m.page,l={},e={};l[d?"top":"left"]=0;e[d?"left":"top"]=
f+"px";this._slide.stop(!0).css(l).animate(e,c?0:p?p.view.options.effects.thumbnails.slide||0:0,a.proxy(function(){this.loadCurrentPage()},this))}},loadCurrentPage:function(){var b,a;if(this._position&&this._vars.thumbnailFrame.width&&!(1>this._thumbnails.length)){if("page"==this._mode){if(1>this._page)return;b=(this._page-1)*this._vars.ipp+1;a=Math.min(b-1+this._vars.ipp,this._thumbnails.length)}else a=("horizontal"==this._orientation,Math.ceil(this._vars.thumbnails.width/this._vars.thumbnailFrame.width)),
b=Math.max(Math.floor(Math.max(this._position-.5*a,0)),1),a=Math.ceil(Math.min(this._position+.5*a)),this._thumbnails.length<a&&(a=this._thumbnails.length);for(;a>=b;b++)this._thumbnails[b-1].load()}},setActive:function(b){this._slide.find(".fr-thumbnail-active").removeClass("fr-thumbnail-active");(b=b&&this._thumbnails[b-1])&&b.activate()},refresh:function(){this._position&&this.setPosition(this._position)}};a.extend(u.prototype,{initialize:function(b,a){this.view=b;this._dimension={};this._position=
a;this.preBuild()},preBuild:function(){this.thumbnail=a("<div>").addClass("fr-thumbnail").data("fr-position",this._position)},build:function(){if(!this.thumbnailFrame){var b=this.view.options;E._slide.append(this.thumbnailFrame=a("<div>").addClass("fr-thumbnail-frame").append(this.thumbnail.append(this.thumbnailWrapper=a("<div>").addClass("fr-thumbnail-wrapper"))));"image"==this.view.type&&this.thumbnail.addClass("fr-load-thumbnail").data("thumbnail",{view:this.view,src:b.thumbnail||this.view.url});
(b=b.thumbnail&&b.thumbnail.icon)&&this.thumbnail.append(a("<div>").addClass("fr-thumbnail-icon fr-thumbnail-icon-"+b));this.thumbnail.append(a("<div>").addClass("fr-thumbnail-overlay").append(a("<div>").addClass("fr-thumbnail-overlay-background")).append(this.loading=a("<div>").addClass("fr-thumbnail-loading").append(a("<div>").addClass("fr-thumbnail-loading-background")).append(this.spinner=a("<div>").addClass("fr-thumbnail-spinner").hide().append(a("<div>").addClass("fr-thumbnail-spinner-spin")))).append(a("<div>").addClass("fr-thumbnail-overlay-border")));
this.thumbnail.append(a("<div>").addClass("fr-thumbnail-state"));this.resize()}},remove:function(){this.thumbnailFrame&&(this.thumbnailFrame.remove(),this.thumbnailFrame=null,this.image=null);this.ready&&(this.ready.abort(),this.ready=null);this.vimeoThumbnail&&(this.vimeoThumbnail.abort(),this.vimeoThumbnail=null);this._loading=!1;this._removed=!0;this.view=null;this._clearDelay()},load:function(){if(!(this._loaded||this._loading||this._removed)){this.thumbnailWrapper||this.build();this._loading=
!0;var b=this.view.options.thumbnail,c=b&&"boolean"==a.type(b)?this.view.url:b||this.view.url;if(this._url=c,c)if("vimeo"==this.view.type)if(c==b)this._url=c,this._load(this._url);else switch(this.view.type){case "vimeo":this.vimeoThumbnail=new D(this.view.url,a.proxy(function(b){this._url=b;this._load(b)},this),a.proxy(function(){this._error()},this))}else this._load(this._url)}},activate:function(){this.thumbnail.addClass("fr-thumbnail-active")},_load:function(b){this.thumbnailWrapper.prepend(this.image=
a("<img>").addClass("fr-thumbnail-image").attr({src:b}).css({opacity:1E-4}));this.fadeInSpinner();this.ready=new y(this.image[0],a.proxy(function(b){b=b.img;this.thumbnailFrame&&this._loading&&(this._loaded=!0,this._loading=!1,this._dimensions={width:b.naturalWidth,height:b.naturalHeight},this.resize(),this.show())},this),a.proxy(function(){this._error()},this),{method:this.view.options.loadedMethod})},_error:function(){this._loaded=!0;this._loading=!1;this.thumbnail.addClass("fr-thumbnail-error");
this.image.hide();this.thumbnailWrapper.append(a("<div>").addClass("fr-thumbnail-image"));this.show()},fadeInSpinner:function(){if(w.supported&&this.view.options.spinner){this._clearDelay();var b=this.view.options.effects.thumbnail;this._delay=setTimeout(a.proxy(function(){this.spinner.stop(!0).fadeTo(b.show||0,1)},this),this.view.options.spinnerDelay||0)}},show:function(){this._clearDelay();var b=this.view.options.effects.thumbnail;this.loading.stop(!0).delay(b.delay).fadeTo(b.show,0)},_clearDelay:function(){this._delay&&
(clearTimeout(this._delay),this._delay=null)},resize:function(){if(this.thumbnailFrame){var b="horizontal"==E._orientation;if(this.thumbnailFrame.css({width:E._vars.thumbnailFrame[b?"width":"height"],height:E._vars.thumbnailFrame[b?"height":"width"]}),this.thumbnailFrame.css({top:b?0:E._vars.thumbnailFrame.width*(this._position-1),left:b?E._vars.thumbnailFrame.width*(this._position-1):0}),this.thumbnailWrapper)if(b=E._vars.thumbnail,this.thumbnail.css({width:b.width,height:b.height,"margin-top":Math.round(-.5*
b.height),"margin-left":Math.round(-.5*b.width),"margin-bottom":0,"margin-right":0}),this._dimensions){var c,b={width:b.width,height:b.height},d=Math.max(b.width,b.height),g=a.extend({},this._dimensions);g.width>b.width&&g.height>b.height?(c=B.within(b,g),g=d=1,c.width<b.width&&(d=b.width/c.width),c.height<b.height&&(g=b.height/c.height),d=Math.max(d,g),1<d&&(c.width*=d,c.height*=d),a.each(["width","height"],function(b,a){c[a]=Math.round(c[a])})):c=B.within(this._dimensions,g.width<b.width||g.height<
b.height?{width:d,height:d}:b);d=Math.round(.5*b.width-.5*c.width);b=Math.round(.5*b.height-.5*c.height);this.image.removeAttr("style").css(a.extend({},c,{top:b,left:d}))}}}});var A={_modes:["fullclick","outside","inside"],_ui:!1,_validClickTargetSelector:".fr-content-element, .fr-content, .fr-content > .fr-stroke, .fr-content > .fr-stroke .fr-stroke-color",initialize:function(b){a.each(this._modes,a.proxy(function(b,a){this[a].initialize()},this));d.element.addClass("fr-ui-inside-hidden fr-ui-fullclick-hidden")},
set:function(b){this._ui&&(d.element.removeClass("fr-window-ui-"+this._ui),C.element.removeClass("fr-overlay-ui-"+this._ui));d.element.addClass("fr-window-ui-"+b);C.element.addClass("fr-overlay-ui-"+b);this._enabled&&this._ui&&this._ui!=b&&(this[this._ui].disable(),this[b].enable(),A[b].show());this._ui=b},_onWindowResize:function(){v.mobileTouch&&this.show()},enable:function(){a.each(this._modes,a.proxy(function(b,a){A[a][a==this._ui?"enable":"disable"]()},this));this._enabled=!0},disable:function(){a.each(this._modes,
a.proxy(function(b,a){A[a].disable()},this));this._enabled=!1},adjustPrevNext:function(b,a){A[this._ui].adjustPrevNext(b,a)},show:function(b,a){A[this._ui].show(b,a)},hide:function(b,a){A[this._ui].hide(b,a)},reset:function(){a.each(this._modes,a.proxy(function(b,a){A[a].reset()},this))},update:function(){var b=m.page;b&&this.set(b._ui)}};return A.fullclick={initialize:function(){this.build();this._scrollLeft=-1},build:function(){d._box.append(this._previous=a("<div>").addClass("fr-side fr-side-previous fr-side-previous-fullclick fr-toggle-ui").append(a("<div>").addClass("fr-side-button").append(a("<div>").addClass("fr-side-button-background")).append(a("<div>").addClass("fr-side-button-icon")))).append(this._next=
a("<div>").addClass("fr-side fr-side-next fr-side-next-fullclick fr-toggle-ui").append(a("<div>").addClass("fr-side-button").append(a("<div>").addClass("fr-side-button-background")).append(a("<div>").addClass("fr-side-button-icon")))).append(this._close=a("<div>").addClass("fr-close fr-close-fullclick").append(a("<div>").addClass("fr-close-background")).append(a("<div>").addClass("fr-close-icon")));c.IE&&7>=c.IE&&this._previous.add(this._next).add(this._close).hide();this._close.on("click",a.proxy(function(b){b.preventDefault();
d.hide()},this));this._previous.on("click",a.proxy(function(b){d.previous();this._onMouseMove(b)},this));this._next.on("click",a.proxy(function(b){d.next();this._onMouseMove(b)},this))},enable:function(){this.bind()},disable:function(){this.unbind()},reset:function(){d.timers.clear("ui-fullclick");this._scrollLeft=this._y=this._x=-1;this.resetPrevNext();this._onMouseLeave()},resetPrevNext:function(){this._previous.add(this._next).stop(!0).removeAttr("style")},bind:function(){this._onMouseUpHandler||
(this.unbind(),d._pages.on("mouseup",".fr-container",this._onMouseUpHandler=a.proxy(this._onMouseUp,this)),v.mobileTouch||(d.element.on("mouseenter",this._showHandler=a.proxy(this.show,this)).on("mouseleave",this._hideHandler=a.proxy(this.hide,this)),d.element.on("mousemove",this._mousemoveHandler=a.proxy(function(b){var a=b.pageX;b=b.pageY;this._hoveringSideButton||b==this._y&&a==this._x||(this._x=a,this._y=b,this.show(),this.startTimer())},this)),d._pages.on("mousemove",".fr-container",this._onMouseMoveHandler=
a.proxy(this._onMouseMove,this)).on("mouseleave",".fr-container",this._onMouseLeaveHandler=a.proxy(this._onMouseLeave,this)).on("mouseenter",".fr-container",this._onMouseEnterHandler=a.proxy(this._onMouseEnter,this)),d.element.on("mouseenter",".fr-side",this._onSideMouseEnterHandler=a.proxy(this._onSideMouseEnter,this)).on("mouseleave",".fr-side",this._onSideMouseLeaveHandler=a.proxy(this._onSideMouseLeave,this)),a(window).on("scroll",this._onScrollHandler=a.proxy(this._onScroll,this))))},unbind:function(){this._onMouseUpHandler&&
(d._pages.off("mouseup",".fr-container",this._onMouseUpHandler),this._onMouseUpHandler=null,this._showHandler&&(d.element.off("mouseenter",this._showHandler).off("mouseleave",this._hideHandler).off("mousemove",this._mousemoveHandler),d._pages.off("mousemove",".fr-container",this._onMouseMoveHandler).off("mouseleave",".fr-container",this._onMouseLeaveHandler).off("mouseenter",".fr-container",this._onMouseEnterHandler),d.element.off("mouseenter",".fr-side",this._onSideMouseEnterHandler).off("mouseleave",
".fr-side",this._onSideMouseLeaveHandler),a(window).off("scroll",this._onScrollHandler),this._showHandler=null))},adjustPrevNext:function(b,c){var f=m.page;if(!f)return void(b&&b());var g=d.element.is(":visible");g||d.element.show();var p=this._previous.attr("style");this._previous.removeAttr("style");var l=parseInt(this._previous.css("margin-top"));this._previous.attr({style:p});g||d.element.hide();p=f._infoHeight||0;g=this._previous.add(this._next);l={"margin-top":l-.5*p};p="number"==a.type(c)?
c:m.page&&m.page.view.options.effects.content.show||0;this.opening&&(p=0);g.stop(!0).animate(l,p,b);this._previous[(d.mayPrevious()?"remove":"add")+"Class"]("fr-side-disabled");this._next[(d.mayNext()?"remove":"add")+"Class"]("fr-side-disabled");g[(2>f._total?"add":"remove")+"Class"]("fr-side-hidden");b&&b()},_onScroll:function(){this._scrollLeft=a(window).scrollLeft()},_onMouseMove:function(b){if(!v.mobileTouch){b=this._getEventSide(b);var a=x.String.capitalize(b),a=b?d["may"+a]():!1;if(b!=this._hoveringSide||
a!=this._mayClickHoveringSide)switch(this._hoveringSide=b,this._mayClickHoveringSide=a,d._box[(a?"add":"remove")+"Class"]("fr-hovering-clickable"),b){case "previous":d._box.addClass("fr-hovering-previous").removeClass("fr-hovering-next");break;case "next":d._box.addClass("fr-hovering-next").removeClass("fr-hovering-previous")}}},_onMouseLeave:function(b){d._box.removeClass("fr-hovering-clickable fr-hovering-previous fr-hovering-next");this._hoveringSide=!1},_onMouseUp:function(b){if(!(1<b.which)){if(1==
m.pages.length)return void d.hide();var a=this._getEventSide(b);d[a]();this._onMouseMove(b)}},_onMouseEnter:function(b){this._onMouseMove(b)},_getEventSide:function(b){b=(-1<this._scrollLeft?this._scrollLeft:this._scrollLeft=a(window).scrollLeft(),b.pageX-d._boxPosition.left-this._scrollLeft);return.5*d._boxDimensions.width>b?"previous":"next"},_onSideMouseEnter:function(b){this._hoveringSideButton=!0;this._hoveringSide=this._getEventSide(b);this._mayClickHoveringSide=d["may"+x.String.capitalize(this._hoveringSide)]();
this.clearTimer()},_onSideMouseLeave:function(b){this._mayClickHoveringSide=this._hoveringSide=this._hoveringSideButton=!1;this.startTimer()},show:function(b){return this._visible?(this.startTimer(),void("function"==a.type(b)&&b())):(this._visible=!0,this.startTimer(),d.element.addClass("fr-visible-fullclick-ui").removeClass("fr-hidden-fullclick-ui"),c.IE&&7>=c.IE&&this._previous.add(this._next).add(this._close).show(),void("function"==a.type(b)&&b()))},hide:function(b){var c=m.page&&m.page.view.type;
return!this._visible||c&&("youtube"==c||"vimeo"==c)?void("function"==a.type(b)&&b()):(this._visible=!1,d.element.removeClass("fr-visible-fullclick-ui").addClass("fr-hidden-fullclick-ui"),void("function"==a.type(b)&&b()))},clearTimer:function(){v.mobileTouch||d.timers.clear("ui-fullclick")},startTimer:function(){v.mobileTouch||(this.clearTimer(),d.timers.set("ui-fullclick",a.proxy(function(){this.hide()},this),d.view?d.view.options.uiDelay:0))}},A.inside={initialize:function(){},enable:function(){this.bind()},
disable:function(){this.unbind()},bind:function(){this._onMouseUpHandler||(this.unbind(),d._pages.on("mouseup",".fr-content",this._onMouseUpHandler=a.proxy(this._onMouseUp,this)),d._pages.on("click",".fr-content .fr-close",a.proxy(function(b){b.preventDefault();d.hide()},this)).on("click",".fr-content .fr-side-previous",a.proxy(function(b){d.previous();this._onMouseMove(b)},this)).on("click",".fr-content .fr-side-next",a.proxy(function(b){d.next();this._onMouseMove(b)},this)),d.element.on("click",
".fr-container, .fr-thumbnails, .fr-thumbnails-wrapper",this._delegateOverlayCloseHandler=a.proxy(this._delegateOverlayClose,this)),v.mobileTouch||(d.element.on("mouseenter",".fr-content",this._showHandler=a.proxy(this.show,this)).on("mouseleave",".fr-content",this._hideHandler=a.proxy(this.hide,this)),d.element.on("mousemove",".fr-content",this._mousemoveHandler=a.proxy(function(b){var a=b.pageX;b=b.pageY;this._hoveringSideButton||b==this._y&&a==this._x||(this._x=a,this._y=b,this.show(),this.startTimer())},
this)),d._pages.on("mousemove",".fr-info, .fr-close",a.proxy(function(b){b.stopPropagation();this._onMouseLeave(b)},this)),d._pages.on("mousemove",".fr-info",a.proxy(function(b){this.clearTimer()},this)),d._pages.on("mousemove",".fr-content",this._onMouseMoveHandler=a.proxy(this._onMouseMove,this)).on("mouseleave",".fr-content",this._onMouseLeaveHandler=a.proxy(this._onMouseLeave,this)).on("mouseenter",".fr-content",this._onMouseEnterHandler=a.proxy(this._onMouseEnter,this)),d.element.on("mouseenter",
".fr-side",this._onSideMouseEnterHandler=a.proxy(this._onSideMouseEnter,this)).on("mouseleave",".fr-side",this._onSideMouseLeaveHandler=a.proxy(this._onSideMouseLeave,this)),a(window).on("scroll",this._onScrollHandler=a.proxy(this._onScroll,this))))},unbind:function(){this._onMouseUpHandler&&(d._pages.off("mouseup",".fr-content",this._onMouseUpHandler),this._onMouseUpHandler=null,d._pages.off("click",".fr-content .fr-close").off("click",".fr-content .fr-side-previous").off("click",".fr-content .fr-side-next"),
d.element.off("click",".fr-container, .fr-thumbnails, .fr-thumbnails-wrapper",this._delegateOverlayCloseHandler),this._showHandler&&(d.element.off("mouseenter",".fr-content",this._showHandler).off("mouseleave",".fr-content",this._hideHandler).off("mousemove",".fr-content",this._mousemoveHandler),d._pages.off("mousemove",".fr-info, .fr-close"),d._pages.off("mousemove",".fr-info"),d._pages.off("mousemove",".fr-content-element",this._onMouseMoveHandler).off("mouseleave",".fr-content",this._onMouseLeaveHandler).off("mouseenter",
".fr-content",this._onMouseEnterHandler),d.element.off("mouseenter",".fr-side",this._onSideMouseEnterHandler).off("mouseleave",".fr-side",this._onSideMouseLeaveHandler),a(window).off("scroll",this._onScrollHandler),this._showHandler=null))},reset:function(){d.timers.clear("ui-fullclick");this._scrollLeft=this._y=this._x=-1;this._hoveringSide=!1;this._onMouseLeave()},adjustPrevNext:function(b){b&&b()},_onScroll:function(){this._scrollLeft=a(window).scrollLeft()},_delegateOverlayClose:function(b){var c=
m.page;c&&c.view.options.overlay&&!c.view.options.overlay.close||a(b.target).is(".fr-container, .fr-thumbnails, .fr-thumbnails-wrapper")&&(b.preventDefault(),b.stopPropagation(),d.hide())},_onMouseMove:function(b){if(!v.mobileTouch){b=this._getEventSide(b);var a=x.String.capitalize(b),a=b?d["may"+a]():!1;if((1==m.pages.length||m.page&&"close"==m.page.view.options.onClick)&&(b=!1),b!=this._hoveringSide||a!=this._mayClickHoveringSide)if(this._hoveringSide=b,this._mayClickHoveringSide=a,b)switch(d._box[(a?
"add":"remove")+"Class"]("fr-hovering-clickable"),b){case "previous":d._box.addClass("fr-hovering-previous").removeClass("fr-hovering-next");break;case "next":d._box.addClass("fr-hovering-next").removeClass("fr-hovering-previous")}else d._box.removeClass("fr-hovering-clickable fr-hovering-previous fr-hovering-next")}},_onMouseLeave:function(b){d._box.removeClass("fr-hovering-clickable fr-hovering-previous fr-hovering-next");this._hoveringSide=!1},_onMouseUp:function(b){if(!(1<b.which)&&a(b.target).is(A._validClickTargetSelector)){if(1==
m.pages.length||m.page&&"close"==m.page.view.options.onClick)return void d.hide();var c=this._getEventSide(b);d[c]();this._onMouseMove(b)}},_onMouseEnter:function(b){this._onMouseMove(b)},_getEventSide:function(b){b=(-1<this._scrollLeft?this._scrollLeft:this._scrollLeft=a(window).scrollLeft(),b.pageX-d._boxPosition.left-this._scrollLeft);return.5*d._boxDimensions.width>b?"previous":"next"},_onSideMouseEnter:function(b){this._hoveringSideButton=!0;this._hoveringSide=this._getEventSide(b);this._mayClickHoveringSide=
d["may"+x.String.capitalize(this._hoveringSide)]();this.clearTimer()},_onSideMouseLeave:function(b){this._mayClickHoveringSide=this._hoveringSide=this._hoveringSideButton=!1;this.startTimer()},show:function(b){return this._visible?(this.startTimer(),void("function"==a.type(b)&&b())):(this._visible=!0,this.startTimer(),d.element.addClass("fr-visible-inside-ui").removeClass("fr-hidden-inside-ui"),void("function"==a.type(b)&&b()))},hide:function(b){return this._visible?(this._visible=!1,d.element.removeClass("fr-visible-inside-ui").addClass("fr-hidden-inside-ui"),
void("function"==a.type(b)&&b())):void("function"==a.type(b)&&b())},clearTimer:function(){v.mobileTouch||d.timers.clear("ui-inside")},startTimer:function(){v.mobileTouch||(this.clearTimer(),d.timers.set("ui-inside",a.proxy(function(){this.hide()},this),d.view?d.view.options.uiDelay:0))}},A.outside={initialize:function(){this.build();this._scrollLeft=-1},build:function(){d._box.append(this._previous=a("<div>").addClass("fr-side fr-side-previous fr-side-previous-outside").append(a("<div>").addClass("fr-side-button").append(a("<div>").addClass("fr-side-button-background")).append(a("<div>").addClass("fr-side-button-icon")))).append(this._next=
a("<div>").addClass("fr-side fr-side-next fr-side-next-outside").append(a("<div>").addClass("fr-side-button").append(a("<div>").addClass("fr-side-button-background")).append(a("<div>").addClass("fr-side-button-icon")))).append(this._close=a("<div>").addClass("fr-close fr-close-outside").append(a("<div>").addClass("fr-close-background")).append(a("<div>").addClass("fr-close-icon")));c.IE&&7>=c.IE&&this._previous.add(this._next).add(this._close).hide();this._close.on("click",a.proxy(function(b){b.preventDefault();
d.hide()},this));this._previous.on("click",a.proxy(function(b){d.previous();this._onMouseMove(b)},this));this._next.on("click",a.proxy(function(b){d.next();this._onMouseMove(b)},this))},enable:function(){this.bind()},disable:function(){this.unbind()},reset:function(){d.timers.clear("ui-outside");this._scrollLeft=this._y=this._x=-1;this._onMouseLeave()},bind:function(){this._onMouseUpHandler||(this.unbind(),d.element.on("mouseup",".fr-content",this._onMouseUpHandler=a.proxy(this._onMouseUp,this)),
d.element.on("click",".fr-container, .fr-thumbnails, .fr-thumbnails-wrapper",this._delegateOverlayCloseHandler=a.proxy(this._delegateOverlayClose,this)),v.mobileTouch||(d._pages.on("mousemove",".fr-content",this._onMouseMoveHandler=a.proxy(this._onMouseMove,this)).on("mouseleave",".fr-content",this._onMouseLeaveHandler=a.proxy(this._onMouseLeave,this)).on("mouseenter",".fr-content",this._onMouseEnterHandler=a.proxy(this._onMouseEnter,this)),d.element.on("mouseenter",".fr-side",this._onSideMouseEnterHandler=
a.proxy(this._onSideMouseEnter,this)).on("mouseleave",".fr-side",this._onSideMouseLeaveHandler=a.proxy(this._onSideMouseLeave,this)),a(window).on("scroll",this._onScrollHandler=a.proxy(this._onScroll,this))))},unbind:function(){this._onMouseUpHandler&&(d.element.off("mouseup",".fr-content",this._onMouseUpHandler),this._onMouseUpHandler=null,d.element.off("click",".fr-container, .fr-thumbnails, .fr-thumbnails-wrapper",this._delegateOverlayCloseHandler),this._onMouseMoveHandler&&(d._pages.off("mousemove",
".fr-content",this._onMouseMoveHandler).off("mouseleave",".fr-content",this._onMouseLeaveHandler).off("mouseenter",".fr-content",this._onMouseEnterHandler),d.element.off("mouseenter",".fr-side",this._onSideMouseEnterHandler).off("mouseleave",".fr-side",this._onSideMouseLeaveHandler),a(window).off("scroll",this._onScrollHandler),this._onMouseMoveHandler=null))},adjustPrevNext:function(b,a){var c=m.page;if(!c)return void(b&&b());var f=this._previous.add(this._next);this._previous[(d.mayPrevious()?"remove":
"add")+"Class"]("fr-side-disabled");this._next[(d.mayNext()?"remove":"add")+"Class"]("fr-side-disabled");f[(2>c._total?"add":"remove")+"Class"]("fr-side-hidden");b&&b()},_onScroll:function(){this._scrollLeft=a(window).scrollLeft()},_delegateOverlayClose:function(b){var c=m.page;c&&c.view.options.overlay&&!c.view.options.overlay.close||a(b.target).is(".fr-container, .fr-thumbnails, .fr-thumbnails-wrapper")&&(b.preventDefault(),b.stopPropagation(),d.hide())},_onMouseMove:function(b){if(!v.mobileTouch){b=
this._getEventSide(b);var a=x.String.capitalize(b),a=b?d["may"+a]():!1;if((1==m.pages.length||m.page&&"close"==m.page.view.options.onClick)&&(b=!1),b!=this._hoveringSide||a!=this._mayClickHoveringSide)if(this._hoveringSide=b,this._mayClickHoveringSide=a,b)switch(d._box[(a?"add":"remove")+"Class"]("fr-hovering-clickable"),b){case "previous":d._box.addClass("fr-hovering-previous").removeClass("fr-hovering-next");break;case "next":d._box.addClass("fr-hovering-next").removeClass("fr-hovering-previous")}else d._box.removeClass("fr-hovering-clickable fr-hovering-previous fr-hovering-next")}},
_onMouseLeave:function(b){d._box.removeClass("fr-hovering-clickable fr-hovering-previous fr-hovering-next");this._hoveringSide=!1},_onMouseUp:function(b){if(!(1<b.which)&&a(b.target).is(A._validClickTargetSelector)){if(1==m.pages.length||m.page&&"close"==m.page.view.options.onClick)return void d.hide();var c=this._getEventSide(b);d[c]();this._onMouseMove(b)}},_onMouseEnter:function(b){this._onMouseMove(b)},_getEventSide:function(b){b=(-1<this._scrollLeft?this._scrollLeft:this._scrollLeft=a(window).scrollLeft(),
b.pageX-d._boxPosition.left-this._scrollLeft);return.5*d._boxDimensions.width>b?"previous":"next"},show:function(){c.IE&&7>=c.IE&&this._previous.add(this._next).add(this._close).show()},hide:function(){},_onSideMouseEnter:function(b){this._hoveringSideButton=!0;this._hoveringSide=this._getEventSide(b);this._mayClickHoveringSide=d["may"+x.String.capitalize(this._hoveringSide)]()},_onSideMouseLeave:function(b){this._mayClickHoveringSide=this._hoveringSide=this._hoveringSideButton=!1},clearTimer:function(){}},
a(document).ready(function(b){I.initialize()}),l});
(function(){function a(){}function k(a,g){for(var c=a.length;c--;)if(a[c].listener===g)return c;return-1}function h(a){return function(){return this[a].apply(this,arguments)}}var e=a.prototype,t=this,u=t.EventEmitter;e.getListeners=function(a){var g=this._getEvents(),c,l;if("object"===typeof a)for(l in c={},g)g.hasOwnProperty(l)&&a.test(l)&&(c[l]=g[l]);else c=g[a]||(g[a]=[]);return c};e.flattenListeners=function(a){var g=[],c;for(c=0;c<a.length;c+=1)g.push(a[c].listener);return g};e.getListenersAsObject=
function(a){var g=this.getListeners(a),c;g instanceof Array&&(c={},c[a]=g);return c||g};e.addListener=function(a,g){var c=this.getListenersAsObject(a),l="object"===typeof g,e;for(e in c)c.hasOwnProperty(e)&&-1===k(c[e],g)&&c[e].push(l?g:{listener:g,once:!1});return this};e.on=h("addListener");e.addOnceListener=function(a,g){return this.addListener(a,{listener:g,once:!0})};e.once=h("addOnceListener");e.defineEvent=function(a){this.getListeners(a);return this};e.defineEvents=function(a){for(var g=0;g<
a.length;g+=1)this.defineEvent(a[g]);return this};e.removeListener=function(a,g){var c=this.getListenersAsObject(a),l,e;for(e in c)c.hasOwnProperty(e)&&(l=k(c[e],g),-1!==l&&c[e].splice(l,1));return this};e.off=h("removeListener");e.addListeners=function(a,g){return this.manipulateListeners(!1,a,g)};e.removeListeners=function(a,g){return this.manipulateListeners(!0,a,g)};e.manipulateListeners=function(a,g,c){var e,l,h=a?this.removeListener:this.addListener;a=a?this.removeListeners:this.addListeners;
if("object"!==typeof g||g instanceof RegExp)for(e=c.length;e--;)h.call(this,g,c[e]);else for(e in g)g.hasOwnProperty(e)&&(l=g[e])&&("function"===typeof l?h.call(this,e,l):a.call(this,e,l));return this};e.removeEvent=function(a){var g=typeof a,c=this._getEvents(),e;if("string"===g)delete c[a];else if("object"===g)for(e in c)c.hasOwnProperty(e)&&a.test(e)&&delete c[e];else delete this._events;return this};e.removeAllListeners=h("removeEvent");e.emitEvent=function(a,g){var c=this.getListenersAsObject(a),
e,h,l,k;for(l in c)if(c.hasOwnProperty(l))for(h=c[l].length;h--;)e=c[l][h],!0===e.once&&this.removeListener(a,e.listener),k=e.listener.apply(this,g||[]),k===this._getOnceReturnValue()&&this.removeListener(a,e.listener);return this};e.trigger=h("emitEvent");e.emit=function(a){var g=Array.prototype.slice.call(arguments,1);return this.emitEvent(a,g)};e.setOnceReturnValue=function(a){this._onceReturnValue=a;return this};e._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:
!0};e._getEvents=function(){return this._events||(this._events={})};a.noConflict=function(){t.EventEmitter=u;return a};"function"===typeof define&&define.amd?define("eventEmitter/EventEmitter",[],function(){return a}):"object"===typeof module&&module.exports?module.exports=a:this.EventEmitter=a}).call(this);
(function(a){function k(e){var h=a.event;h.target=h.target||h.srcElement||e;return h}var h=document.documentElement,e=function(){};h.addEventListener?e=function(a,e,g){a.addEventListener(e,g,!1)}:h.attachEvent&&(e=function(a,e,g){a[e+g]=g.handleEvent?function(){var c=k(a);g.handleEvent.call(g,c)}:function(){var c=k(a);g.call(a,c)};a.attachEvent("on"+e,a[e+g])});var t=function(){};h.removeEventListener?t=function(a,e,g){a.removeEventListener(e,g,!1)}:h.detachEvent&&(t=function(a,e,g){a.detachEvent("on"+
e,a[e+g]);try{delete a[e+g]}catch(c){a[e+g]=void 0}});h={bind:e,unbind:t};"function"===typeof define&&define.amd?define("eventie/eventie",h):a.eventie=h})(this);
(function(a,k){"function"===typeof define&&define.amd?define(["eventEmitter/EventEmitter","eventie/eventie"],function(h,e){return k(a,h,e)}):"object"===typeof exports?module.exports=k(a,require("wolfy87-eventemitter"),require("eventie")):a.imagesLoaded=k(a,a.EventEmitter,a.eventie)})(window,function(a,k,h){function e(a,c){for(var g in c)a[g]=c[g];return a}function t(a){var c=[];if("[object Array]"===B.call(a))c=a;else if("number"===typeof a.length)for(var g=0,e=a.length;g<e;g++)c.push(a[g]);else c.push(a);
return c}function u(a,g,h){if(!(this instanceof u))return new u(a,g);"string"===typeof a&&(a=document.querySelectorAll(a));this.elements=t(a);this.options=e({},this.options);"function"===typeof g?h=g:e(this.options,g);if(h)this.on("always",h);this.getImages();c&&(this.jqDeferred=new c.Deferred);var l=this;setTimeout(function(){l.check()})}function l(a){this.img=a}function g(a){this.src=a;v[a]=this}var c=a.jQuery,q=a.console,x="undefined"!==typeof q,B=Object.prototype.toString;u.prototype=new k;u.prototype.options=
{};u.prototype.getImages=function(){this.images=[];for(var a=0,g=this.elements.length;a<g;a++){var e=this.elements[a];"IMG"===e.nodeName&&this.addImage(e);var h=e.nodeType;if(h&&(1===h||9===h||11===h))for(var e=c("img",e),h=0,l=e.length;h<l;h++)this.addImage(e[h])}};u.prototype.addImage=function(a){a=new l(a);this.images.push(a)};u.prototype.check=function(){function a(a,d){c.options.debug&&x&&q.log("confirm",a,d);c.progress(a);g++;g===e&&c.complete();return!0}var c=this,g=0,e=this.images.length;
this.hasAnyBroken=!1;if(e)for(var h=0;h<e;h++){var l=this.images[h];l.on("confirm",a);l.check()}else this.complete()};u.prototype.progress=function(a){this.hasAnyBroken=this.hasAnyBroken||!a.isLoaded;var c=this;setTimeout(function(){c.emit("progress",c,a);c.jqDeferred&&c.jqDeferred.notify&&c.jqDeferred.notify(c,a)})};u.prototype.complete=function(){var a=this.hasAnyBroken?"fail":"done";this.isComplete=!0;var c=this;setTimeout(function(){c.emit(a,c);c.emit("always",c);if(c.jqDeferred)c.jqDeferred[c.hasAnyBroken?
"reject":"resolve"](c)})};c&&(c.fn.imagesLoaded=function(a,g){return(new u(this,a,g)).jqDeferred.promise(c(this))});l.prototype=new k;l.prototype.check=function(){var a=v[this.img.src]||new g(this.img.src);if(a.isConfirmed)this.confirm(a.isLoaded,"cached was confirmed");else if(this.img.complete&&void 0!==this.img.naturalWidth)this.confirm(0!==this.img.naturalWidth,"naturalWidth");else{var c=this;a.on("confirm",function(a,g){c.confirm(a.isLoaded,g);return!0});a.check()}};l.prototype.confirm=function(a,
c){this.isLoaded=a;this.emit("confirm",this,c)};var v={};g.prototype=new k;g.prototype.check=function(){if(!this.isChecked){var a=new Image;h.bind(a,"load",this);h.bind(a,"error",this);a.src=this.src;this.isChecked=!0}};g.prototype.handleEvent=function(a){var c="on"+a.type;if(this[c])this[c](a)};g.prototype.onload=function(a){this.confirm(!0,"onload");this.unbindProxyEvents(a)};g.prototype.onerror=function(a){this.confirm(!1,"onerror");this.unbindProxyEvents(a)};g.prototype.confirm=function(a,c){this.isConfirmed=
!0;this.isLoaded=a;this.emit("confirm",this,c)};g.prototype.unbindProxyEvents=function(a){h.unbind(a.target,"load",this);h.unbind(a.target,"error",this)};return u});
(function(a,k,h,e){function t(a,c){return a[c]===e?z[c]:a[c]}function u(){var a=k.pageYOffset;return a===e?y.scrollTop:a}function l(a,c){var d=z["on"+a];d&&(H(d)?d.call(c[0]):(d.addClass&&c.addClass(d.addClass),d.removeClass&&c.removeClass(d.removeClass)));c.trigger("lazy"+a,[c]);x()}function g(c){l(c.type,a(this).off("load error",g))}function c(c){if(p.length){c=c||z.forceLoad;G=Infinity;var e=u(),h=k.innerHeight||y.clientHeight,m=k.innerWidth||y.clientWidth,b,f;b=0;for(f=p.length;b<f;b++){var w=
p[b],q=w[0],n=w.lazyLoadXT,t=!1,x=c,B;if(!d(y,q))t=!0;else if(c||!n.visibleOnly||q.offsetWidth||q.offsetHeight){if(!x){var x=q.getBoundingClientRect(),v=n.edgeX,F=n.edgeY;B=x.top+e-F-h;x=B<=e&&x.bottom>-F&&x.left<=m+v&&x.right>-v}if(x){l("show",w);n=n.srcAttr;if(n=H(n)?n(w):q.getAttribute(n))w.on("load error",g),q.src=n;t=!0}else B<G&&(G=B)}t&&(p.splice(b--,1),f--)}f||l("complete",a(y))}}function q(){1<m?(m=1,c(),setTimeout(q,z.throttle)):m=0}function x(a){!p.length||a&&"scroll"===a.type&&a.currentTarget===
k&&G>=u()||(m||setTimeout(q,0),m=2)}function B(){D.lazyLoadXT()}function v(){c(!0)}var y=h.documentElement||h.body,z={autoInit:!0,selector:"img[data-src]",blankImage:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",throttle:99,forceLoad:k.onscroll===e||!!k.operamini||!y.getBoundingClientRect,loadEvent:"pageshow",updateEvent:"load orientationchange resize scroll touchmove focus",forceEvent:"",oninit:{removeClass:"lazy"},onshow:{addClass:"lazy-hidden"},onload:{removeClass:"lazy-hidden",
addClass:"lazy-loaded"},onerror:{removeClass:"lazy-hidden"},checkDuplicates:!0},J={srcAttr:"data-src",edgeX:0,edgeY:0,visibleOnly:!0},D=a(k),H=a.isFunction,F=a.extend,C=a.data||function(c,d){return a(c).data(d)},d=a.contains||function(a,c){for(;c=c.parentNode;)if(c===a)return!0;return!1},p=[],G=0,m=0;a.lazyLoadXT=F(z,J,a.lazyLoadXT);a.fn.lazyLoadXT=function(c){c=c||{};var d=t(c,"blankImage"),g=t(c,"checkDuplicates"),e=t(c,"scrollContainer"),b={},f;a(e).on("scroll",x);for(f in J)b[f]=t(c,f);return this.each(function(f,
e){if(e===k)a(z.selector).lazyLoadXT(c);else if(!g||!C(e,"lazied")){var h=a(e).data("lazied",1);d&&"IMG"===e.tagName&&!e.src&&(e.src=d);h.lazyLoadXT=F({},b);l("init",h);p.push(h)}})};a(h).ready(function(){l("start",D);D.on(z.loadEvent,B).on(z.updateEvent,x).on(z.forceEvent,v);a(h).on(z.updateEvent,x);z.autoInit&&B()})})(window.jQuery||window.Zepto||window.$,window,document);
PeerJ.Article.Annotation=new function(){var a,k,h,e,t,u=$("<i/>").addClass("icon-comment icon-flip-horizontal"),l=$("<a/>").addClass("plink").append(u),g=$(window),c=$("#questions-summaries"),q=$("#annotation-create-question").attr("href"),x=$("<a/>",{href:q}).addClass("btn btn-primary add-annotation").attr("data-toggle","annotation-form").attr("rel","nofollow").text("Ask a question about this section"),B=$("<div/>").addClass("annotation-form-container"),v=$(".annotation-learn-more"),y=$("<button/>").addClass("btn btn-default close-annotations").text("Close");
this.init=function(){var c=$("a.annotation-loader").map(function(){var a=$(this);return $.get(a.attr("href"),function(c){var d=$(c);d.replaceAll(a);c=d.data("collection-motivation");d=d.data("total-results");PeerJ.Article.Annotation.setMotivationCounts(c,d)})});a=$("main");$(".article-sidebar");k=$("#annotations-sidebar");$("#article-item-middle").imagesLoaded(function(){$.when.apply($,$.makeArray(c)).then(function(){$("article.preprint").length||($.each(["p",".fig",".table-wrap"],z),$(document).on("click",
".plink",D),$(document).on("click",".close-annotations",J),$(".annotation-container").length&&767<g.width()&&(h=$('<div class="annotations-outer-heatmap"><div class="annotations-heatmap"></div></div>').appendTo("body"),h.on("click",".annotation-marker",F),g.on("resize",H),g.on("scroll",PeerJ.Article.Throttle(d,25))),PeerJ.Article.Annotation.updateCounts());PeerJ.Annotation.Target.showAnnotation()})})};this.emptySummaries=function(){c.length||(c=$("<div/>",{id:"questions-summaries"}).insertBefore("#questions.annotations"));
c.empty()};this.updateCounts=function(){this.emptySummaries();$(".annotations-positioned").each(function(){var a=$(this),d=a.data("selector"),a=a.find(".annotation"),g=a.length,d=$(d).find(".plink");d.find(".annotations-count").remove();g&&($("<div/>",{text:g}).addClass("annotations-count").appendTo(d),a.each(function(){var a=$(this),d=$("<div/>").addClass("annotation-summary"),g=a.find(".annotation-title").clone();g.attr("href","#"+a.attr("id"));$("<div/>").append(g).appendTo(d);g=a.find(".user-name").clone();
a=a.find(".annotation-date-published").clone();$("<div/>").append(g).append("&middot;").append(a).appendTo(d);d.appendTo(c)}))});"undefined"!==typeof h&&H()};this.setMotivationCounts=function(a,c){$(".annotation-counter-"+a).text(c).css("display",c?"inline-block":"none")};this.getMotivationCount=function(a){a=$(".annotation-counter-"+a).eq(0).text();return Number(a)};var z=function(c,d){a.find("section > "+d).each(function(a){var c=$(this),d=c.attr("id");d||(d=c.get(0).nodeName.toLowerCase()+"-"+
(a+1),c.attr("id",d));var g="#"+d;a=l.clone();a.attr("href",g).attr("rel","nofollow");c.addClass("has-plink").prepend(a);d=$("#questions").data("target");c=$("<div/>").addClass("annotations annotations-positioned");c.data("counts",1);c.data("plink",a);c.attr("data-target",d);c.attr("data-selector",g);a.data("annotations-positioned",c);k.append(c);d=$(".annotation-container").filter(function(){return $(this).data("selector")==g});d.length&&(c.append(d),a.addClass("plink-content"));d.each(function(){MathJax.Hub.Queue(["Typeset",
MathJax.Hub,this])});a=x.clone();a.attr("href",q+"&selector="+encodeURIComponent(g));c.append(a);c.append(y.clone());c.append(v.clone());c.append(B.clone().show())})},J=function(a){a.preventDefault();$("body").removeClass("annotating");$(this).closest(".annotations-positioned").data("plink").parent().removeClass("plink-active")},D=function(a){var c=$(this),d=c.closest(".has-plink");d.hasClass("plink-active")?(a.preventDefault(),$("body").removeClass("annotating"),d.removeClass("plink-active")):($("body").addClass("annotating"),
$(".plink-active").removeClass("plink-active"),$(".annotations-positioned").fadeOut("fast"),d.addClass("plink-active"),a=c.data("annotations-positioned"),c=c.offset(),a.offset({top:c.top}),a.fadeIn("fast"),a.animate({width:k.width()},"fast"),$(window),c=c.top-100,$("html, body").animate({scrollTop:c}))},H=function(){h.empty();e=$("<div/>").addClass("current-scroll").appendTo(h);t=$("#article-item-middle").height();C();d();var a=$(".annotations-count"),c=[];a.each(function(){c.push(parseInt(this.textContent))});
var g=Math.max.apply(Math,c);a.each(function(){var a=$(this),c=a.closest(".plink"),d=c.offset().top/t,e=c.height()/t,c=c.attr("href"),a=parseInt(a.text()),b=1===a?"question":"questions";$("<a/>",{href:c}).addClass("annotation-marker").css({top:100*d+"%",height:100*e+"%",opacity:a/g}).tooltip({placement:"right",title:a+" "+b}).appendTo(h)})},F=function(a){a=$(a.target).attr("href");$(a).find(".plink").click()},C=function(){var a=g.height()/t*100;e.css("height",a+"%")},d=function(){var a=g.scrollTop()/
t*100;e.css({top:a+"%"})}};$(PeerJ.Article.Annotation.init);
$(function(){function a(){return!this.hostname.match(/(doi\.org|scholar\.google)/)}function k(a,c,e){c=(c=(e||c).match(/(\d{4})-(\d{1,2})-(\d{1,2})/))?c.splice(1).map(h).join(""):"*";return"https://web.archive.org/web/"+c+"/"+a}function h(a){return 1===a.length?"0"+a:a}function e(){var a=$(this);a.popover("show").siblings(".popover").on("mouseleave",function(){a.popover("hide")})}function t(){var a=$(this),c=function(){setTimeout(function(){$(".popover:hover").length?c():a.popover("hide")},100)};
c()}var u=$("meta[name=citation_date]").attr("content"),l={trigger:"manual",animation:!1,container:"body",placement:"left",html:!0,template:'<div class="popover archive-popover"><div class="arrow"></div><div class="popover-inner"><div class="popover-content"></div></div></div>',delay:{show:250,hide:500}};$("article .body a.ext-link").filter(a).popover($.extend({},l,{content:function(){var a=$(this);return $("<a/>",{text:"Find in Wayback Machine",href:k(a.attr("href"),u),target:"_blank"})}})).hover(e,
t);$("article a.uri").filter(a).popover($.extend({},l,{content:function(){var a=$(this),c=a.closest(".citation").find(".access-date time.date-in-citation").attr("datetime");return $("<a/>",{text:"Find in Wayback Machine",href:k(a.attr("href"),u,c),target:"_blank"})}})).hover(e,t);$("article .citation").find("a.article-title, a.data-title").not(".uri").filter(a).popover($.extend({},l,{content:function(){var a=$(this),c=a.closest(".citation").find(".access-date time.date-in-citation").attr("datetime");
return $("<a/>",{text:"Find in Wayback Machine",href:k(a.attr("href"),u,c),target:"_blank"})}})).hover(e,t)});PeerJ.Article.Counter=new function(){this.init=function(){var a=$(".article-item-metrics-counts"),k=a.filter("[data-src]").data("src");$.getJSON(k,function(h){a.each(function(a,k){$(k).find("[data-count]").each(function(a,e){var g=$(e),c=g.data("count");h[c]&&g.text(h[c]).closest(".article-item-metrics-count").show()})}).fadeIn("slow")})}};$(PeerJ.Article.Counter.init);
PeerJ.Article.DownloadModal={showSignupAfterDownload:!0,modal:$("#download-article-modal"),modalTrigger:$(".js-download-modal-trigger"),buttonsContainer:$("#download-modal-buttons-container"),signupContainer:$("#download-modal-signup-container"),downloadMessageContainer:$("#download-modal-downloading-message"),downloadButtons:$(".js-download-btn"),closeModalButton:$(".js-close-download-modal"),downloadConfirmText:$(".download-modal-confirm-title-text"),showDownloadUrl:$(".show-download-link"),downloadUrl:$(".article-modal-download-url"),
init:function(){this.eventListeners()},eventListeners:function(){var a=this;this.modalTrigger.click(this.showModal.bind(this));this.downloadButtons.click(function(k){a.downloadClick(k,$(this))});this.closeModalButton.click(this.hideModal.bind(this));this.showDownloadUrl.click(this.toggleUrl.bind(this))},reset:function(){this.signupContainer.hide();this.downloadMessageContainer.hide();this.buttonsContainer.show()},showSignupForm:function(){this.downloadUrl.removeClass("show");$(".modal-header").hide();
this.signupContainer.show();this.buttonsContainer.hide()},showDownloadingMessage:function(){this.buttonsContainer.hide();this.downloadMessageContainer.show()},showModal:function(){this.reset();this.modal.modal("show")},hideModal:function(){this.modal.modal("hide")},toggleUrl:function(){this.downloadUrl.toggleClass("show")},downloadClick:function(a,k){if(1==a.which){this.downloadConfirmText.text(k.data("download-confirm-text"));var h=k.attr("href");this.downloadUrl.attr("href",h);this.downloadUrl.text(h);
h=k.data("format");"undefined"!=typeof ga&&ga("send","event","Article Download",h);this.showSignupAfterDownload?this.showSignupForm():this.hideModal()}}};PeerJ.Article.DownloadModal.init();
PeerJ.Article.Figures=new function(){this.init=function(){h();var e={html:!0,placement:"right",content:a,delay:{show:250,hide:500}};$("a.xref-fig").popover(e)};var a=function(){var a=$("<div/>").addClass("popover-figure");k(this).find(".heading").clone().appendTo(a);var h=k(this).find("img[data-thumb]").data("thumb");$("<img/>",{src:h}).appendTo(a);return a.get(0).outerHTML},k=function(a){a=$(a).data("jats-rid").replace(/\./g,"\\.");return $("#"+a)},h=function(){$(".fig img.graphic").each(function(){this.clientWidth<
this.naturalWidth&&(this.style.height="auto")})}};$(PeerJ.Article.Figures.init);PeerJ.Article.Footnotes=new function(){this.init=function(){var k={html:!0,placement:"right",content:a,delay:{show:250,hide:3E3}};$("a.xref-fn").popover(k)};var a=function(){var a=$(this).data("jats-rid");return $("#"+a).html()}};$(PeerJ.Article.Footnotes.init);
PeerJ.Article.Item=new function(){this.init=function(){h();$('sub[data-jats-arrange="stack"]').superStack();1<window.devicePixelRatio&&"undefined"!=typeof lazyLoadXT&&($.lazyLoadXT.srcAttr="data-src-2x");$("table").each(g);y();v();var c=$("#article-information");c.addClass("article-item-section");var d=z("Author and article information","article-item-article-information");d.insertBefore(c).attr("id","article-item-article-information-container");d.find(".article-item-section-content").append(c);var e=
$("header.front .abstract"),l=e.parent(),d=z("Abstract","article-item-abstract"),q=$(".self-citation > dd").html(),c=$("<div style='margin-top:20px'></div>").addClass("alert alert-info self-citation");c.append("<p style='color:#444;font-weight:bold;font-size:14px;'>Cite this as</p>").append(q);if(q=$("#article-preexisting a[rel='published-article']").attr("href"))q=$("<a/>",{text:"the subsequent peer-reviewed version of this article",href:q}),$("<p/>").addClass("preprint-cite-article-message").append("<span class='label label-warning'>note</span>").append(" This preprint is not peer-reviewed. You may wish to reference ").append(q).append(".").appendTo(c);
d.find(".article-item-section-content").append(e);d.find(".abstract").after(c);d.insertAfter("#article-item-article-information-container").attr("id","article-item-abstract-container").show();l.remove();x()&&(e=$("link[rel=alternate][type='application/pdf']").get(0))&&(e=e.href,499<d.width()?$("<iframe/>",{src:B(e)||e,allowfullscreen:"true",height:1.41*d.width(),width:d.width()}).addClass("pdf-viewer").insertAfter(c):(d=$("<i/>").addClass("icon-white icon-file").css("margin-right","5px"),$("<a/>",
{href:e,text:"View Preprint PDF",rel:"tooltip",title:"View as PDF"}).addClass("btn btn-primary").prepend(d).insertAfter(c)));c=$("header.front .notes");c.length&&(d=c.parent(),e=z("Author comment","article-item-notes"),e.find(".article-item-section-content").append(c),e.insertAfter("#article-item-abstract-container").attr("id","article-item-notes-container").show(),d.remove());a();k();x()&&$(".abstract:hidden").closest("#article-item-abstract-container").find(".row-article-item-section-heading").click()};
var a=function(){var a=$(".subjects-navigation"),c=$("#article-item-middle"),d=c.data("ms-type-entity"),e=c.data("ms-type-id"),c=c.data("ms-type-text").replace(/\-/g," "),d=$("<a/>",{href:"/search/?type="+d+"&manuscriptType="+e,text:c});$("<div/>").addClass("subject-item manuscriptType-item").append(d).appendTo(a);$(".subject").each(function(){var c=$(this),c=$("<a/>",{href:c.attr("href"),text:c.text()});$("<div/>").addClass("subject-item").append(c).appendTo(a)});$("h1.article-title").after(a)},
k=function(){$("#article-item-article-information").click();768>$(window).width()&&$(".article-section-indicator").each(function(a){$(this).hasClass("icon-chevron-down")&&($(this).removeClass("icon-chevron-down"),$(this).addClass("icon-chevron-right"))})},h=function(){window.requestAnimationFrame&&t();l();$("body").on("click",".article-navigation .article-anchor a",c).on("click","a.xref",c);$("#flag-current-issue").on("hover",function(){$("#item-flag-button").tooltip("hide")});$("[data-counter-target]").each(H).on("keyup",
F).trigger("keyup");if($(".save-flag-btn").length)$(".save-flag-btn").on("click",J);$("article").on("click",".row-article-item-section-heading",q);u();$(".article-sidebar").on("click",".article-similar-publication",function(a){C(a,"Similar","Publication",this.href)});$(".article-sidebar").on("click",".article-similar-preprint",function(a){C(a,"Similar","Preprint",this.href)});$(".article-sidebar").on("click",".article-similar-editor",function(a){C(a,"Similar","Editor",this.href)});$(".article-sidebar").on("click",
".article-similar-editor-cat",function(a){C(a,"Similar","EditorCat",this.href)});var a=$("#article-identifiers, #article-collections, #article-corrections, #article-preexisting");a.length&&($(".article-authors").after(a),a.show());$(".article-authors").after(d());e()},e=function(){$("#article-tweets-container").length&&($("#btn-view-tweets").on("click",function(){$("#article-main-container").hide();$(".sidebar-heading").hide();$(".article-navigation").hide();$("#article-tweets-container").show();
$("html, body").animate({scrollTop:0},500)}),$("#btn-view-article").on("click",function(){$("#article-tweets-container").hide();$(".sidebar-heading").show();$(".article-navigation").show();$("#article-main-container").show()}));if($(".tweet-pagination").length)$("#article-tweets-container").on("click",".tweet-pagination a",function(a){a.preventDefault();$.ajax({type:"GET",url:$(this).attr("href"),dataType:"json",success:function(a){$(".tweet-items").html(a.html);$("html, body").animate({scrollTop:0},
500)}})})},t=function(){var a=document.querySelector(".item-top-navbar");a&&(new Headroom(a)).init()},u=function(){var a=$(document),c=$(".navbar"),d=$(".item-top-navbar");c.addClass("visible");a.on("scroll",PeerJ.Article.Throttle(function(){0<a.scrollTop()?(c.filter(".visible").removeClass("visible").hide(),d.not(".visible").addClass("visible").show()):(c.not(".visible").addClass("visible").show(),d.filter(".visible").removeClass("visible").hide())},250))},l=function(){$("#top-return").on("click",
function(){$("html, body").animate({scrollTop:0},1E3)})},g=function(){var a=$(this).find('th[data-jats-content-type="table-heading-vertical"]');if(a.length){a.css("white-space","nowrap");var c=a.eq(0).height();a.each(function(){var a=$(this),d=$("<span/>").css({transform:"rotate(-90deg)","transform-origin":"left bottom",position:"absolute",bottom:"8px"});d.append(a.contents());a.append(d);a.css({"vertical-align":"bottom",position:"relative",height:d.width()+16,"min-width":d.height()});d.css("left",
(c+a.width()+8)/2)})}},c=function(){var a=$(this).attr("href"),a=$(a);a.is(":visible")||a.closest(".row-article-item-section").prev(".row-article-item-section-heading").click()},q=function(){var a=$(this);a.children(".article-item-section-toggle").length&&(a.next(".row-article-item-section").toggle(),a.find(".article-section-indicator").toggleClass("icon-chevron-down").toggleClass("icon-chevron-right"))},x=function(){return $("article[itemscope].preprint").length},B=function(a){var c=$("link[rel=pdf-viewer]");
return c.length?c.attr("href")+"?file="+encodeURIComponent(a):!1},v=function(){var a=$(".body > *, footer > .sec"),c=$("<div/>",{id:"article-item-main-sections"});c.append(a);a=$("article.preprint").length;a=z(a?"Sections":"Main article text","article-item-main-text");a.appendTo("main");a.find(".article-item-section-content").append(c);var d=$("article > footer");d.find("> section").each(function(){var a=$(this),c="article-item-"+a.attr("id")+"-text",e=a.find("h2.heading"),g=e.text();e.hide();c=z(g,
c);d.append(c);c.find(".article-item-section-content").append(a)})},y=function(){var a=$("<ul/>").addClass("nav nav-list");$("main .sec > h2.heading").each(function(){var c=$(this),d=c.parent().attr("id");d||(d=c.text().toLowerCase().replace(/\W/g,"-"),c.parent().attr("id",d));c=$("<a/>",{href:"#"+d,text:c.text()});$("<li/>").addClass("article-anchor").append(c).appendTo(a)});a.appendTo(".article-navigation")},z=function(a,c){var d=$("<div/>"),e=$("<div/>").addClass("row-fluid row-article-item-section-heading").appendTo(d),
g=$("<div/>").addClass("span1 article-main-left-span1").appendTo(e);$("<i/>").addClass("article-section-indicator icon-chevron-down").appendTo(g);$("<h2/>").text(a).appendTo(e);$("<div/>",{id:c}).addClass("article-item-section-toggle").appendTo(e);e=$("<div/>").addClass("row-fluid row-article-item-section").appendTo(d);$("<div/>").addClass("span1 article-main-left-span1").html("&nbsp;").appendTo(e);$("<div/>").addClass("span11 article-item-section-content").appendTo(e);return d},J=function(a){a.preventDefault();
a=$("#article-flag-form").data("href");var c=$("#article-flag-form").serialize(),d=$("#login_submit");$(".alert-error").remove();0==d.length&&$("#flag-modal-result").prepend('<div style="margin-left:40px;"><span class="label label-success" id="flag-modal-saving">Saving ...</span></div>');$.post(a,c,function(a){200==a.code?($("#flag-modal-saving").remove(),"login"==a.action?($("#flag-modal-result").before(a.form),$("#flag-modal-footer > .btn").text("Cancel"),$("#flag-modal-footer").append($("#login_submit")),
$(".form-actions").remove(),$("#login_submit").on("click",D)):(a='<div class="alert alert-success follow-success-alert" style="margin-left:40px;text-align:center">'+a.text+"</div>",$("#flag-modal-result").before(a),$("#flag-modal-footer > .btn").text("Close"),$("#login_submit").remove(),$("#ajax-login-container").remove(),$("#flag-modal-result").hide()),$(".save-flag-btn").hide()):(a='<div class="alert alert-error" style="margin-left:40px;text-align:center">'+a.text+"</div>",$("#flag-modal-result").prepend(a))}).fail(function(){alert("Sorry an error occurred. Please try again.")})},
D=function(a){a.preventDefault();var c=$("#ajax-login-form");a=c.attr("action");var d=c.serialize(),e=$("#login_submit");$("#ajax-login-error-row").hide();e.val("One moment ...");e.off("click",D);$.post(a,d,function(a){200==a.code&&("success"==a.auth?(c.remove(),$("#ajax-login-error-row").hide(),$("#notification__token").val(a.token),$(".save-flag-btn").trigger("click")):($("#login_submit").on("click",D),$("#login_submit").val("Sign in"),$("#ajax-login-error-row").show()))})},H=function(){var a=$(this),
c=a.data("counter-target"),c=$(c);c.parent().show();a.data("counter-target",c)},F=function(a){a=!isNaN(parseFloat(a))&&isFinite(a)?$("[data-counter-wiki]"):$(this);var c=a.val(),d=c.match(/\n/g),c=c.length+(d?d.length:0),c=a.attr("maxlength")-c;a=a.data("counter-target");a.text(c);0<c?a.removeClass("label-important").addClass("label-info"):a.removeClass("label-info").addClass("label-important")},C=function(a,c,d,e){"undefined"!=typeof ga&&1==a.which&&(a.shiftKey||a.altKey||a.metaKey||a.ctrlKey?ga("send",
"event",c,d,e):(event.preventDefault(),ga("send","event",c,d,e),window.setTimeout(function(){window.location=e},200)))},d=function(){var a=$(".article-dates time[itemprop=datePublished]").text(),c=$("#article-identifier-pmid").length,d=$("<div/>").addClass("article-publication-date");c&&$("<span/>",{text:"Published "}).addClass("article-meta-name").appendTo(d);$("<span/>",{text:moment(a).format("MMMM D, YYYY")}).addClass("article-meta-value").appendTo(d);return d}};$(PeerJ.Article.Item.init);
PeerJ.Article.References=new function(){this.init=function(){var e={html:!0,trigger:"hover",placement:"right",container:"body",content:a,delay:{show:250,hide:500}};$("a.xref-bibr").popover(e);e=$("#references");e.on("click",".show-all-authors",h);e.find(".citation").each(k)};var a=function(){var a=$(this).data("jats-rid").replace(/\./g,"\\.");return $("#"+a).html()},k=function(){var a=$(this).find(".citation-authors-year [itemprop=author]");if(!(10>=a.length)){var a=a.slice(10),h=$();a.each(function(){var a=
this.previousSibling;a&&a.nodeValue.match(/^,\s*$/)&&h.push(a);h.push(this)});h.wrapAll('<span class="hide hidden-authors"/>');$("<a/>",{href:"#",text:"+"+a.length+" more",title:"Show hidden authors"}).addClass("show-all-authors").insertAfter(h.parent())}},h=function(a){a.preventDefault();a=$(this);a.prev(".hidden-authors").contents().unwrap();a.remove()}};$(PeerJ.Article.References.init);
PeerJ.Article.RightAffixFollow=new function(){this.init=function(){$("nav.article-sidebar-block.follow").affix({offset:{top:function(){return $("#article-sidebar-main-content").height()},bottom:170}})}};$(PeerJ.Article.RightAffixFollow.init);
PeerJ.Article.Supplemental=new function(){this.init=function(){"function"===typeof document.createElement("video").canPlayType&&$("[data-jats-mimetype=video]").each(a)};var a=function(){var a=$(this),h=a.data("jats-mimetype")+"/"+a.data("jats-mime-subtype"),e=document.createElement("video");e.canPlayType(h)&&(e.setAttribute("preload","none"),e.setAttribute("controls","controls"),a=a.find("a[download][data-rel=supplement]"),h=$("<source/>",{src:a.attr("href"),type:h}),$(e).append(h).insertBefore(a))}};
$(PeerJ.Article.Supplemental.init);PeerJ.Article.Throttle=function(a,k,h){k||(k=250);var e,t;return function(){var u=h||this,l=+new Date,g=arguments;e&&l<e+k?(clearTimeout(t),t=setTimeout(function(){e=l;a.apply(u,g)},k)):(e=l,a.apply(u,g))}};
PeerJ.Article.Todos=new function(){this.init=function(){a()};var a=function(){var a=$("#article-sidebar-main-content"),e=a.data("todo-href");$.get(e,function(e){e.html&&(a.prepend(e.html),$("form.completed-task-form").each(function(){$(this).find("input[type=checkbox]").on("change",k)}))})},k=function(a){a.preventDefault();var e=$(this),h=e.closest("form"),k=h.find(".help-saving");k.show();$.ajax({url:h.attr("action"),type:h.attr("method"),data:h.serialize(),success:function(a){"success"==a.status?
($("#completed-todo-count").text(a.completed+"%"),h.attr("action",a.url)):(alert("There was an error saving"),e.prop("checked",!e.prop("checked")));k.hide()},error:function(){alert("There was an error saving");e.prop("checked",!e.prop("checked"));k.hide()}});return!1}};$(PeerJ.Article.Todos.init);
PeerJ.Event.Follow=new function(){this.init=function(){$(".update-follow-btn").on("click",a);$("#unfollowModal").on("show",g);e();$("#settings-below-fold").on("click",".get-unfollow-form",u);$(".notification-actions-btn").on("click",".unfollow-btn",h);$(".follow-btn").on("click",u);$(".notification-actions-btn").on("click",".follow-submit",l)};var a=function(a){a.preventDefault();a=$("form#article-unfollow-form").data("href");var c=$("form#article-unfollow-form").serialize()+"&_method=PUT";$(".alert-error").remove();
$("#unfollow-form-load-result").prepend('<div style="margin-left:40px;"><span class="label label-success" id="follow-modal-saving">Saving ...</span></div>');$.post(a,c,function(a){$("#follow-modal-saving").remove();200==a.code?(a='<div class="alert alert-success" style="margin-left:40px;text-align:center">'+a.text+"</div>",$(".update-follow-btn").show(),$("#unfollow-form-load-result").html(a),$("#unfollowModal").modal("hide")):(a='<div class="alert alert-error" style="margin-left:40px;text-align:center">'+
a.text+"</div>",$("#unfollow-form-load-result").prepend(a))}).fail(function(){alert("Sorry an error occurred. Please try again.")})},k=function(){var a=$(this),e=$("#notification__token").val(),g=a.data("href");a.text("One moment ...");$.ajax({url:g,type:"POST",dataType:"json",data:{"notification[_token]":e,_method:"DELETE"},success:function(c){200!=c.code?(c.text?alert(c.text):alert("Sorry, but an error occurred while trying to unfollow. Please try again."),a.text("Unfollow")):(a.text("You have been unsubscribed."),
$(".update-follow-btn").hide(),$("#item-left-unfollow-btn").before('<a href="#followModal" class="btn btn-success" id="item-left-follow-btn" data-toggle="modal"><span title="Receive article updates" data-toggle="tooltip"> Follow</span></a>'),$("#item-left-unfollow-btn").remove(),$("#item-left-follow-btn").show(),$(".save-follow-btn").show(),$("#follow-modal-result").show(),$(".follow-success-alert").remove())},error:function(c){alert("Sorry, but an error occurred while trying to unfollow. Please try again.");
a.show();$(".unfollowing-tmp-btn").remove()}})},h=function(a){a.preventDefault();a=$(this);var c=a.closest("form"),e=a.closest(".notification-actions-btn");a.html('<i class="icon-spinner icon-spin"></i>');$.ajax({type:c.attr("method"),url:c.attr("action"),data:c.serialize(),success:function(a){200!=a.code?alert(a.text):(e.html(a.html),e.find("form").show())},error:function(){alert("There was an error handling this unfollow")}})},e=function(){var a=$("#notification-actions"),e=a.is(":visible")?a:$("#notification-actions-mobile");
if(0==e.length)return!1;a=e.data("href");$.ajax({url:a,dataType:"json",success:function(a){a.isFollowing&&e.html(a.html)},error:function(){return!1}})},t=function(){$(".follow-btn.hasFollowClick").trigger("click")},u=function(){var a=$(this);a.addClass("hasFollowClick");btnText=a.text();var e=a.data("href"),g=a.closest(".notification-actions-btn");a.html('<i class="icon-spinner icon-spin"></i>');$.ajax({type:"post",url:e,data:{_method:"POST"},dataType:"json",success:function(c){var e=c.code;if(401==
e)return $("#ajax-form").peerjAuthenticate({onAuthenticate:t,html:c.html}),a.text(btnText),!1;200!=e&&202!=e?(c.text?alert(c.text):alert("Sorry, but an error occurred. Please try again."),a.text(btnText)):(g.append(c.html),g.find("form").hide(),c=g.find(".follow-submit"),0==c.length&&(c=g.find(".unfollow-btn")),c.trigger("click"),c=$("#article-signup-p"),c.length&&c.fadeOut("slow"))},error:function(c){alert("Sorry, but an error occurred while trying to follow. Please try again.");a.text("Follow")}})},
l=function(a){a.preventDefault();var c=$(this).closest("form"),e=c.find("button");0==c.find(".icon-spin").length&&e.html('<i class="icon-spinner icon-spin"></i>');$.ajax({type:c.attr("method"),url:c.attr("action"),data:c.serialize(),success:function(a){c.parent().html(a.html)},error:function(){e.txt(btnText);alert("There was an error handling this follow")}})},g=function(){var a=$("#unfollow-form-load-result").data("href");$("#unfollow-form-load-result").load(a,function(a,c,e){$(".unfollow-item-btn").on("click",
k);"error"==c&&$("#unfollow-form-load-result").html("<div class='alert alert-error'>Oops. We have a problem. Please close and try again. Error: "+e.status+" "+e.statusText+"</div>")})}};
PeerJ.Article.External=new function(){this.init=function(){$("#metricsModal").one("shown",a)};var a=function(){if(!document.getElementById("altmetric-button")){var a=$(".altmetric-embed"),h=a.data("doi");$.getJSON("https://api.altmetric.com/v1/doi/"+h).then(function(e){var h=$("<a/>",{target:"_blank",href:"http://www.altmetric.com/details/"+e.altmetric_id});e=$("<img/>",{src:"https://d1uo4w7k31k5mn.cloudfront.net/v2/"+Math.ceil(e.score)+".png",alt:"Altmetric button",id:"altmetric-button"}).css({width:"88px",
height:"18px",border:"none"});h.append(e).appendTo(a)})}}};$(PeerJ.Article.External.init);
PeerJ.Annotation.Accept=new function(){this.init=function(){$(document).on("click","a.annotation-accept",a)};var a=function(a){a.preventDefault();var h=$(this),e=h.closest(".annotation");h.addClass("annotation-saving");$.ajax({type:"PUT",url:h.attr("href"),data:{accept:!e.hasClass("annotation-accepted"),_token:h.data("token")},dataType:"text",success:function(a){h.removeClass("annotation-saving");e.toggleClass("annotation-accepted",a.accepted);window.location.reload()},error:function(a){h.removeClass("annotation-saving");
h.addClass("annotation-saving-error")}})}};$(PeerJ.Annotation.Accept.init);
PeerJ.Annotation.DeleteAnnotation=new function(){this.init=function(){$(document).on("submit",".form-annotation-delete",a)};var a=function(a){a.preventDefault();if(!confirm("Are you sure you want to delete this item?"))return!1;var h=$(this),e=h.find(":submit");e.removeClass("btn-danger").addClass("btn-warning").html("Deleting&hellip;");$.ajax({type:"POST",url:h.attr("action"),data:h.serialize(),dataType:"text",error:function(a){e.removeClass("btn-warning").addClass("btn-danger").text("Error").closest("form").css("opacity",1)},
success:function(a){var e=h.closest(".annotation");e.next(".annotation-section").remove();e.fadeOut(function(){e.remove();if("undefined"==typeof PeerJ.Article.Annotation){if(!$(".annotation").length){var a=$(".annotation-target-title").attr("href");window.location=a?a.replace(/#.*/,""):$(".brand").attr("href")}}else{PeerJ.Article.Annotation.updateCounts();var a=e.data("motivation"),g=PeerJ.Article.Annotation.getMotivationCount(a);PeerJ.Article.Annotation.setMotivationCounts(a,g-1)}})}})}};$(PeerJ.Annotation.DeleteAnnotation.init);
PeerJ.Annotation.Form=new function(){this.init=function(){$(document).on("click","[data-toggle=annotation-form]",a).on("click",".annotation-cancel",k).on("submit",".form-annotation",h);$(".open-ask-form").length&&$("[data-toggle=annotation-form]").trigger("click");if($("#annotation-create-question-btn-clone").length)$("#annotation-create-question-btn-clone").on("click",function(){$("#annotation-create-question").trigger("click")})};var a=function(a){a.preventDefault();a=$(this);var e=a.data("target");
if(e){if("add-answer"==e){$(".annotation-add-answer").trigger("click");return}var c=$(e)}else e=a.closest(".annotation,.annotation-section"),e.length||(e=a.closest(".annotations-positioned")),c=e.find(".annotation-form-container").last();c.html('<div style="text-align:center;font-weight:bold">one moment&hellip;</div><div class="progress progress-striped active"><div class="bar bar-info" style="width: 100%;"></div></div>').show();$.ajax({url:this.href,success:function(a){c.html(a).find(":input:visible:first").focus();
$(".search-annotation-form").length&&c.append("<hr>");(a=c.closest("[data-selector]").data("selector"))&&c.find("input#question_annotation_selector").val(a);$("[data-counter-target]").each(t).on("keyup",u).trigger("keyup");$(".add-annotation,.close-annotations",c.parent()).hide();PeerJ.Annotation.Target.scrollTo(c)},error:function(a){switch(a.status){case 401:c.html(a.responseText).show();break;default:alert("There was an error fetching the form")}}})},k=function(a){a.preventDefault();$(this).closest(".annotation-form-container").fadeOut("fast",
function(){$(this).empty()});$(this).closest(".annotations-positioned").find(".annotation-container").length?($(".add-annotation,.close-annotations").show().children().show(),$(".annotation-actions").children().show()):$(".close-annotations").trigger("click")},h=function(a){var g=$(this);if(!$("#annotation-question-create-container[data-nonajaxpost]").length){var c=g.find(":submit");c.removeClass("btn-primary").addClass("btn-warning").html("Saving&hellip;");a.preventDefault();a=g.attr("action");$.ajax({type:"POST",
url:a,data:g.serialize(),dataType:"html",error:function(a){c.removeClass("btn-warning").addClass("btn-danger").text("Error").css("opacity",1)},statusCode:{201:function(a,c,h){g.closest(".annotation-index-form").length?window.location.reload():(a=h.getResponseHeader("x-location"),e(g)&&(a+="?_counts=1"),$.get(a,function(a){a=$(a);g.closest(".annotation-form-container").prevAll(".add-annotation").last().before(a);g.remove();a.fadeIn();window.location.hash=a.attr("id");PeerJ.Annotation.Popover.add(a);
MathJax.Hub.Queue(["Typeset",MathJax.Hub,a.get(0)]);if("undefined"!=typeof PeerJ.Article.Annotation){PeerJ.Article.Annotation.updateCounts();var c=a.data("motivation"),e=PeerJ.Article.Annotation.getMotivationCount(c);PeerJ.Article.Annotation.setMotivationCounts(c,e+1)}a.closest("[data-motivation=answering]").length&&$(".annotation-add-answer").remove();$(".add-annotation").show()}))},204:function(a,c,h){a=h.getResponseHeader("x-location");e(g)&&(a+="?_counts=1");$.get(a,function(a){a=$(a);g.closest(".annotation,.annotations").replaceWith(a).fadeIn();
PeerJ.Annotation.Popover.add(a);MathJax.Hub.Queue(["Typeset",MathJax.Hub,a.get(0)]);"undefined"!=typeof PeerJ.Article.Annotation&&PeerJ.Article.Annotation.updateCounts();$(".add-annotation").show()})},400:function(a){g.replaceWith(a.responseText).fadeIn()}}})}},e=function(a){return a.closest(".annotations[data-counts]").length||a.closest(".annotations").data("counts")?!0:!1},t=function(){var a=$(this),e=a.data("counter-target"),e=$(e);e.parent().show();a.data("counter-target",e)},u=function(){var a=
$(this),e=a.val(),c=e.match(/\n/g),e=e.length+(c?c.length:0);a.data("ideallength");a.data("counter-target").text("total: "+e)}};$(PeerJ.Annotation.Form.init);PeerJ.Annotation.Popover=new function(){this.add=function(a){a.find("[data-toggle=popover]").popover({trigger:"hover",placement:"right",container:"body"})}};
PeerJ.Annotation.Publish=new function(){this.init=function(){$(document).on("click",".form-annotation-public :submit",a)};var a=function(a){a.preventDefault();var h=$(this);h.addClass("btn-warning");var e=h.closest("form"),k=h.find(".button-text");k.data("original",k.text()).text(k.data("status"));$.ajax({type:"PUT",url:e.attr("action"),data:{_token:e.find("[name=_token]").val(),isPublic:h.val()},dataType:"json",error:function(a){h.removeClass("btn-warning").addClass("btn-danger");k.text("Error");
e.css("opacity",1)},success:function(a){h.removeClass("btn-warning");k.text(k.data("original"));e.css("opacity",1);e.closest(".annotation").toggleClass("annotation-public",a.isPublic)}})}};$(PeerJ.Annotation.Publish.init);PeerJ.Annotation.Social=new function(){this.init=function(){$(document).on("click",".annotation-social",a)};var a=function(a){a.preventDefault();window.open(this.href,"popupwindow","width=500,height=500,scrollbars,resizable")}};$(PeerJ.Annotation.Social.init);
PeerJ.Annotation.Target=new function(){this.init=function(){$(window).on("hashchange",PeerJ.Annotation.Target.showAnnotation).trigger("hashchange")};this.showAnnotation=function(){if(window.location.hash){var k=window.location.hash,h=$(k);h.length&&(h.is(".annotation")?(h.addClass("annotation-active"),(k=h.closest(".annotation-container").data("selector"))?(h=$(k),h.hasClass("plink-active")||h.find(".plink-content").click()):(k=h.closest(".tab-pane:hidden"),k.length&&a("#"+k.attr("id")),PeerJ.Annotation.Target.scrollTo(h))):
h.is(".tab-pane")?(h=a(k),PeerJ.Annotation.Target.scrollTo(h.closest(".nav-tabs"))):PeerJ.Annotation.Target.scrollTo(h))}};var a=function(a){var h=$("a[data-toggle=tab]").filter(function(){return $(this).attr("href")===a});h.click();return h};this.scrollTo=function(a){if(a.length){a=a.offset().top;var h;h=$(".navbar-fixed-top:visible");h.length?h=h.height():(h=$(".item-top-navbar:visible"),h=h.length?h.height():0);a-=h+10;$("html,body").animate({scrollTop:a+"px"})}}};$(PeerJ.Annotation.Target.init);
PeerJ.Annotation.Vote=new function(){this.init=function(){$(document).on("click",".annotation-vote",a)};var a=function(a){a.preventDefault();var e=$(this),h=e.closest(".annotation");if(e.hasClass("annotation-vote-disabled")&&!PeerJ.User.anonymous)return!1;e.addClass("annotation-vote-saving");a=e.hasClass("annotation-voted")?0:e.data("vote");var u=h.find(".form-annotation-vote");u.find("input[name=vote]").val(a);$.ajax({type:"PUT",url:u.attr("action"),data:u.serialize(),dataType:"json",success:function(a){k(u,
a);e.removeClass("annotation-vote-saving")},error:function(a,g){e.removeClass("annotation-vote-saving");switch(a.status){case 403:break;case 401:h.find(".annotation-form-container").html(a.responseText).show();break;default:alert("Sorry, there was an error saving this vote")}}})},k=function(a,e){var h=a.closest(".annotation");h.find(".annotation-score").text(e.score);h.find(".annotation-voted").removeClass("annotation-voted");0!=e.vote&&h.find(".annotation-vote").filter(function(){return $(this).data("vote")==
e.vote}).addClass("annotation-voted")}};$(PeerJ.Annotation.Vote.init);
(function(a){a.fn.peerjAuthenticate=function(k){function h(g){g.on("click",".switch-loginsubmit-form",function(c){c.preventDefault();c=a(this).data("id");var h=document.getElementById(c).cloneNode(!0);g.html(h);"loginsubmit-signup-form"==c&&e(g);a("#loginsubmit-academic-rank-row select").change()});c.on("click","#modal-cancel",function(){l()});c.on("click","#modal-submit",function(){c.find(":submit").click()});a("#login-form").on("submit",function(a){a.preventDefault();t()});c.on("click","#terms-view",
function(a){a.preventDefault();u()})}function e(a){var c=a.find("#fos_user_registration_form_email"),e=a.find("#loginsubmit-show-email"),g=e.find("span"),h=a.find("#fos_user_registration_form_plainPassword"),k=a.find("#loginsubmit-show-password");c.on("keyup",function(){e.slideDown(800);g.text(c.val())});k.on("click",function(){k.text(h.val());a.find(".loginsubmit-small-password-help").show();h.on("keyup",function(){k.text(h.val())})})}function t(){var g=a(this),h=c.find("form"),k=h.find(".loginsubmit-form-inputs"),
t=h.find(".switch-loginsubmit-form").data("href"),u=a("#modal-server-message"),J=h.find(".loginsubmit-password-reset"),D=a(".peerj-authenticate-bubblingG"),H=a(".authentication-copy-btn");J.hide();u.text("");H.hide();D.show();u.text("");a.ajax({type:"post",url:t,data:h.serialize(),dataType:"json",success:function(c){200==c.code&&"success"==c.auth?(l(),c.nav&&(a(".navbar-fixed-top").remove(),a("body").prepend(c.nav),a(PeerJ.Search.Nav.init)),q.onAuthenticate.call()):(0==c.auth&&J.show(),0==c.signup&&
(k.html(c.html),e(k),u.text("There was a problem creating your account. See above for errors to correct.")),g.prop("disabled",!1),g.removeClass("disabled"));H.show();D.hide()}})}function u(){var c=a("#terms-view").data("href"),e=a(".signup-terms-container"),g=a(".authentication-copy");a("#modal-server-message").html("");a("#terms-details").html().trim()?e.show():a.ajax({url:c,success:function(c){400!=c.code&&(a("#terms-details").html(c.r),e.show())}},"json");g.hide();a("#ret-sign").click(function(){e.hide();
g.show()})}function l(){var e=c.find(".modal");e.modal("hide");e.on("hidden",function(){c.html("");a(".modal-backdrop").remove()})}function g(c){a("#loginsubmit-academic-rank-other").toggle("Other"===a(this).find("option:selected").text())}var c=this,q=a.extend({},{onAuthenticate:function(){},form:"register",html:null,reload:!1},k);c.html(q.html);(function(){var k=c.find("#loginsignup-dialog"),l=c.find(".loginsubmit-form-inputs"),t=("register"==q.form?document.getElementById("loginsubmit-signup-form"):
document.getElementById("loginsubmit-login-form")).cloneNode(!0);l.html(t);"register"==q.form&&e(l);k.length&&(k.modal(),a("body").addClass("modal-open"),k.on("hidden",function(){a("body").removeClass("modal-open")}),k.on("change","#loginsubmit-academic-rank-row select",g).change(),a("#loginsubmit-academic-rank-row select").change(),h(l))})()}})(jQuery);
