(function(){this.MobileRegPath||(this.MobileRegPath={}),this.MobileRegPath.notifier=new c.Server.Notification("msutd"),this.MobileRegPath.notifier.notifyAndLog=function(e,t){return null==t&&(t={}),$a.log(e),this.notify({event_type:e,location:null!=t.location?t.location:void 0,attachment_id:null!=t.attachment_id?t.attachment_id:void 0,auvid:$auvid})}}).call(this),function(){this.JST||(this.JST={}),this.JST["mobile_reg_path/templates/layout"]=function(e){var t=[],i=e||{};return function(e){t.push('<div id="mobile_reg_path" class="DesignSystem"><div class="full-screen-modal-header u-pv4x u-taCenter"><img'+jade.attr("src",""+e("academia-logo-redesign-2015.svg"),!0,!1)+jade.attr("onerror","this.onerror=null;this.src="+e("academia-logo-redesign-2015.png"),!0,!1)+' class="swp-mobile-signup-modal-header-logo"/><span class="swp-mobile-signup-modal-header-close u-positionAbsolute close-full-screen-modal u-clickable u-fs18 u-tcGrayDark">&times;</span></div><div class="container-fluid"><div class="row"><div class="col-xs-12"><div class="full-screen-modal-page-header u-taCenter u-mv4x"><span class="modal-page-header js-modal-page-header u-fs16"></span></div></div><div class="col-xs-12"><div class="full-screen-modal-page-content u-p0x"></div></div></div></div></div>')}.call(this,"$image_url"in i?i.$image_url:"undefined"!=typeof $image_url?$image_url:undefined),t.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["mobile_reg_path/templates/no_suggested_users"]=function(){var e=[];return e.push('<li class="u-pv8x"><div class="u-fs24 u-tcGray u-lineHeight1_3">None of your friends are on Academia</div></li>'),e.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["mobile_reg_path/templates/pages/enter_email_page"]=function(){var e=[];return e.push('<form class="js-mobile-signup-modal-email-form"><input type="email" placeholder="Email" class="js-email TextInput"/><div class="u-mt3x"><input type="submit" disabled="disabled" value="Submit" class="js-submit-email Button Button--block Button--disabled"/></div></form>'),e.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["mobile_reg_path/templates/pages/enter_name_page"]=function(){var e=[];return e.push('<form class="js-mobile-signup-modal-final-form"><input type="text" placeholder="First Name" id="user_first_name" class="TextInput js-first-name"/><div class="u-mt3x"><input type="text" placeholder="Last Name" id="user_last_name" class="TextInput js-last-name"/></div><div class="u-mt3x"><input type="password" placeholder="Password" id="user_password" class="TextInput js-password"/></div><div class="u-mt3x"><input type="submit" disabled="disabled" value="Submit" class="js-submit-name Button Button--block Button--green"/></div></form>'),e.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["mobile_reg_path/templates/pages/sent_email_page"]=function(){var e=[];return e.push('<div class="u-taCenter u-mb4x"><i class="fa fa-check-circle-o u-tcGreen u-fs16"></i>&nbsp;&nbsp;<span class="u-tcGreen u-fw700 u-fs16">Email Sent</span></div><button class="js-sent-email-finished Button Button--inverseGray Button--mobile-xxl Button--block">Continue Reading</button>'),e.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["mobile_reg_path/templates/pages/sent_email_with_fb_page"]=function(){var e=[];return e.push('<div class="u-taCenter"><i class="fa fa-check-circle-o u-tcGreen u-fs16"></i>&nbsp;&nbsp;<span class="u-tcGreen u-fw700 u-fs16">Email Sent</span></div><div class="u-mb6x"><button class="js-swp-mobile-signup-fb-connect Button Button--facebook Button--block u-mt4x"><i class="fa fa-facebook"></i>&nbsp;&nbsp; Find Friends</button></div><div class="js-suggested-academics u-fs20 u-pb6x hidden u-taCenter">Suggested Academics</div><ul class="js-user-suggestions-list swp-mobile-signup-user-suggestions-list list-unstyled"></ul><div class="swp-mobile-signup-close-fb-bar u-p4x u-bgColorWhite js-mobile-follow-all hidden"><button class="js-sent-email-finished Button Button--green Button--lg Button--block">follow all</button></div>'),e.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["mobile_reg_path/templates/suggested_user"]=function(e){var t,i=[],n=e||{};return function(e,n){var s=n.user;i.push('<div class="u-displayFlex u-alignItemsCenter"><img'+jade.attr("src",s.photo,!0,!1)+' class="Avatar Avatar--sm u-mr2x"/><div class="u-flexGrow1 u-textTruncate"><div class="u-fs14 u-textTruncate u-fw700">'+jade.escape(null==(t=s.display_name)?"":t)+'</div><div class="u-fs13 u-textTruncate">'+jade.escape(null==(t=e)?"":t)+'</div></div><div class="u-ml2x"><button'+jade.attr("data-follow-user-id",s.id,!0,!1)+' data-follow-user-source="mobile_signup_to_download"'+jade.attr("style",!!n.followedByCurrentUser&&"display: none",!0,!1)+' class="Button Button Button--green Button--sm u-ph2x">Follow</button><button'+jade.attr("data-unfollow-user-id",s.id,!0,!1)+jade.attr("style",!n.followedByCurrentUser&&"display: none",!0,!1)+' class="Button Button--inverseGreen Button--sm u-ph2x">Following</button></div></div>')}.call(this,"reason"in n?n.reason:"undefined"!=typeof reason?reason:undefined,"suggestion"in n?n.suggestion:"undefined"!=typeof suggestion?suggestion:undefined),i.join("")}}.call(this),function(){this.MobileRegPath.Layout=Backbone.View.extend({template:"mobile_reg_path/templates/layout",events:{"click .close-full-screen-modal":"closeMobileRegPath","click .js-sent-email-finished":function(){return this.closeMobileRegPath(!1)}},initialize:function(e){return this.container=$("#full-screen-modal"),this.attachment_id=e.attachment_id,this.model=new MobileRegPath.newUser({attachment_id:this.attachment_id,user_source:"mobile_download"}),this.container.html(this.render().el),this.container.fadeIn()},render:function(){return this.$el.html(JST[this.template]()),this.postRender(),this},postRender:function(){return this.ui={$headerText:this.$(".js-modal-page-header"),$pageContent:this.$(".full-screen-modal-page-content")},this.initializePageManager()},resetModel:function(){return this.model=new MobileRegPath.NewUser({attachment_id:this.attachment_id,user_source:"mobile_download"})},closeMobileRegPath:function(e){if(null==e&&(e=!0),e&&MobileRegPath.notifier.notifyAndLog("download_closed",{attachment_id:this.attachment_id,location:this.pageManager.currentView.el.id}),this.container.fadeOut(),this.container.html(""),MobileRegPath.close=!1,"sent-email-page"===this.pageManager.currentView.el.id||"sent-email-fb-page"===this.pageManager.currentView.el.id)return $(".js-swp-mobile-get-pdf-footer").remove()},steps:function(){return[{viewClass:MobileRegPath.EnterEmailPage,options:{model:this.model}},{viewClass:MobileRegPath.EnterNamePage,shouldSkip:function(e){return function(){return e.skipNamePage()}}(this),options:{model:this.model}},{viewClass:MobileRegPath.SentEmailPage,shouldSkip:function(e){return function(){return e.skipSentEmailPage()}}(this),options:{model:this.model}},{viewClass:MobileRegPath.SentEmailWithFbPage,shouldSkip:function(e){return function(){return e.skipSentEmailFbPage()}}(this),options:{model:this.model}}]},initializePageManager:function(){return this.pageManager=new Aedu.RegPath.PageManagerView({el:this.ui.$pageContent,steps:this.steps(),headerText:this.ui.$headerText})},skipNamePage:function(){return MobileRegPath.user_exists||!1},skipSentEmailPage:function(){return MobileRegPath.user_confirmed||!1},skipSentEmailFbPage:function(){return MobileRegPath.user_exists||!MobileRegPath.user_confirmed}})}.call(this),function(){this.MobileRegPath.EnterEmailPage=Backbone.View.extend({id:"email-page",stepNumber:1,headerText:"Enter your email address",template:"mobile_reg_path/templates/pages/enter_email_page",events:{"submit .js-mobile-signup-modal-email-form":"submitEmail","change input.js-email":"toggleSubmitButton","keydown input.js-email":"toggleSubmitButton","keyup input.js-email":"toggleSubmitButton","keydown input.js-email":"logEmailTyping"},initialize:function(){return this.sentLog=!1,this.render()},render:function(){return this.$el.html(JST[this.template]()),this.postRender()},postRender:function(){return $(".js-modal-page-header").html=this.headerText,this.ui={$email:this.$(".js-email"),$submit:this.$(".js-submit-email")},this.ui.$email.focus()},checkEmail:function(){return $.ajax({type:"POST",url:$r.partial_create_registrations_path(),data:{partial_registration:{email:this.model.get("email"),attachment_id:this.model.get("attachment_id")}}})},saveEmail:function(){return this.model.set({email:this.ui.$email.val()})},submitEmail:function(e){return e.preventDefault(),MobileRegPath.notifier.notifyAndLog("attempted_submit_email"),this.saveEmail(),this.checkEmail().done(function(e){return function(t){return t.email_invalid===!0?(alert("Please enter a valid email"),MobileRegPath.notifier.notifyAndLog("validation_failure",{attachment_id:e.model.get("attachment_id"),error:"email_invalid"})):t.user_exists===!0?(MobileRegPath.notifier.notifyAndLog("email_valid",{attachment_id:e.model.get("attachment_id"),location:"existing_user"}),MobileRegPath.user_exists=!0,e.trigger("step_complete")):(MobileRegPath.notifier.notifyAndLog("email_valid",{attachment_id:e.model.get("attachment_id"),location:"new_user"}),MobileRegPath.user_exists=!1,e.trigger("step_complete"))}}(this)).fail(function(){return alert("Something went wrong")})},disableSubmitButton:function(){return this.ui.$submit.attr("disabled",!0).removeClass("Button--green").addClass("Button--disabled")},enableSubmitButton:function(){return this.ui.$submit.removeAttr("disabled").removeClass("Button--disabled").addClass("Button--green")},toggleSubmitButton:function(){return this.ui.$email.val().length>0?this.enableSubmitButton():this.disableSubmitButton()},logEmailTyping:function(){return this.sentLog||MobileRegPath.notifier.notifyAndLog("started_typing",{attachment_id:this.model.get("attachment_id"),location:"user_email"}),this.sentLog=!0}})}.call(this),function(){this.MobileRegPath.EnterNamePage=Backbone.View.extend({id:"name-page",stepNumber:2,headerText:"Enter your name and password",template:"mobile_reg_path/templates/pages/enter_name_page",events:{"submit .js-mobile-signup-modal-final-form":"toNextPage","change input":"toggleSubmitButtonAndLog","keydown input":"toggleSubmitButtonAndLog","keyup input":"toggleSubmitButtonAndLog"},initialize:function(){return this.log={user_first_name:!1,user_last_name:!1,user_password:!1},this.render()},render:function(){return this.$el.html(JST[this.template]()),this.postRender(),this},postRender:function(){return this.ui={$password:this.$(".js-password"),$submit:this.$(".js-submit-name"),$first_name:this.$(".js-first-name"),$last_name:this.$(".js-last-name")},this.ui.$first_name.focus()},saveFields:function(){return this.model.set({password:this.ui.$password.val(),first_name:this.ui.$first_name.val(),last_name:this.ui.$last_name.val()})},generateErrorMessages:function(e){var t;return 0===e.length?"Something went wrong":(t=[],e.forEach(function(e){if("user[display_name]"!==e[0])return t.push(e[1])}),t.join("\n"))},toNextPage:function(e){return e.preventDefault(),MobileRegPath.notifier.notifyAndLog("attempted_submit"),this.saveFields(),this.model.save().done(function(e){return function(t){var i,n,s;return s=t[0],i=t[1],n=t[2],s?(window.$current_user=JSON.parse(i.user),Aedu.User.set_current($current_user),MobileRegPath.user_confirmed=!Aedu.User.current.unconfirmed,e.trigger("step_complete")):(MobileRegPath.notifier.notifyAndLog("validation_failure",{error:JSON.stringify(n)}),alert(e.generateErrorMessages(n)))}}(this)).fail(function(){return alert("Something went wrong")})},disableSubmitButton:function(){return this.ui.$submit.attr("disabled",!0).removeClass("Button--green").addClass("Button--disabled")},enableSubmitButton:function(){return this.ui.$submit.removeAttr("disabled").removeClass("Button--disabled").addClass("Button--green")},toggleSubmitButtonAndLog:function(e){if(this.ui.$password.val().length>0&&this.ui.$first_name.val().length>0&&this.ui.$last_name.val().length>0?this.enableSubmitButton():this.disableSubmitButton(),!this.log[e.target.id])return MobileRegPath.notifier.notifyAndLog("started_typing",{location:e.target.id}),this.log[e.target.id]=!0}})}.call(this),function(){this.MobileRegPath.SentEmailPage=Backbone.View.extend({id:"sent-email-page",stepNumber:3,headerText:" ",template:"mobile_reg_path/templates/pages/sent_email_page",initialize:function(){return this.render()},render:function(){return this.$el.html(JST[this.template]()),this}})}.call(this),function(){this.MobileRegPath.SentEmailWithFbPage=Backbone.View.extend({id:"sent-email-fb-page",stepNumber:3,headerText:" ",template:"mobile_reg_path/templates/pages/sent_email_with_fb_page",events:{"click .js-swp-mobile-signup-fb-connect":"connectFB","click .js-sent-email-finished":"toNextPage"},initialize:function(){return this.suggestedUsers=new Aedu.RegPath.SuggestedUsers,this.render()},connectFB:function(){var e,t;return t=function(e){return Facebook.register_connected(e)},e=function(){var e;return e=$r.api_v0_user_following_index_path({user_id:$current_user.id,subdomain_param:"api"}),$.getJSON(e)},Facebook.authorize().then(t).then(e).done(function(e){return function(t){var i,n,s,a;for(s=t.following,i=0,n=s.length;i<n;i++)a=s[i],Aedu.User.current.record_follow_of(a.id);return e.suggestedUsers.fetch(),e.disableFacebookButton(),alert("Facebook connect success")}}(this)).fail(function(){return alert("Facebook connect fail")})},render:function(){return this.$el.html(JST[this.template]()),this.postRender()},postRender:function(){return this.userSuggestionsView=new MobileRegPath.SuggestedUserListView({collection:this.suggestedUsers})},toNextPage:function(){return this.suggestedUsers.save(),this.trigger("step_complete")},disableFacebookButton:function(){return $(".js-swp-mobile-signup-fb-connect").removeClass("Button--facebook").addClass("Button--disabled").attr("disabled",!0).html("<i class='fa fa-facebook'></i>&nbsp;&nbsp; connected")}})}.call(this),function(){this.MobileRegPath.SuggestedUserView=Backbone.View.extend({tagName:"li",className:"u-borderTop1 u-borderColorGray u-pt2x u-mt2x",template:"mobile_reg_path/templates/suggested_user",initialize:function(){var e;return e=$a.is_logged_in()&&(Aedu.User.current.follows(this.model.get("user").id)||0===this.model.get("sources").length||_.contains(this.model.get("sources"),"AuthorsBookmarked")),this.model.set("followedByCurrentUser",e),this.render()},render:function(){return this.$el.html(JST[this.template]({suggestion:this.model.toJSON(),reason:this.reason(this.model.get("sources"))})),this},reason:function(e){return _.contains(e,"Owner")?"Author":_.contains(e,"AuthorsBookmarked")?"Co-Author":0===e.length?"Facebook Friend":user.affiliationString()}})}.call(this),function(){this.MobileRegPath.SuggestedUserListView=Backbone.View.extend({el:$("ul.js-user-suggestions-list"),initialize:function(){return this.changeButton=!0,this.listenTo(this.collection,"sync",function(e){return function(){var t;return t=e.collection.filter(function(e){return MobileRegPath.author===e.get("user").id&&e.get("sources").push("Owner"),_.contains(MobileRegPath.workCoauthors,e.get("user").id)&&e.get("sources").push("AuthorsBookmarked"),!0}),e.collection.reset(t),e.collection.length>0?(e.collection.each(function(t){if(e.addUser(t),e.changeButton)return e.changeButton=e.checkSource(t)}),e.showFollowAllButton(),e.changeButton?e.changeFollowAllToContinue():void 0):e.noResults()}}(this))},addUser:function(e){var t;return t=new MobileRegPath.SuggestedUserView({model:e}),$(this.$el.selector).append(t.el)},noResults:function(){return $(this.$el.selector).append(JST["mobile_reg_path/templates/no_suggested_users"])},showFollowAllButton:function(){return $(".js-mobile-follow-all").removeClass("hidden"),$(".js-suggested-academics").removeClass("hidden")},changeFollowAllToContinue:function(){return $(".js-sent-email-finished").removeClass("Button--green").addClass("Button--inverseGray").text("continue")},checkSource:function(e){return _.contains(e.get("sources"),"AuthorsBookmarked")||0===e.get("sources").length}})}.call(this),function(){this.MobileRegPath.newUser=Backbone.Model.extend({save:function(){return this.savingToServer?$.Deferred():(this.savingToServer=!0,$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:$r.registrations_path(),data:this.dataForSave(),complete:function(e){return function(){return e.savingToServer=!1}}(this)}))},dataForSave:function(){var e;return e={user:{email:this.get("email"),first_name:this.get("first_name"),last_name:this.get("last_name"),password:this.get("password")},doc_id:this.get("attachment_id"),user_source:this.get("user_source"),splash:this.get("splash"),login_redirect:this.get("login_redirect"),user_occupation:this.get("user_occupation")},JSON.stringify(e)}})}.call(this);
//# sourceMappingURL=//academia.edu/assets/maps/mobile_reg_path-ef95da8a24dc298c707f8651deb3474ca9f69f6b5ba23cdd5c89069a8252d87a.js.map
