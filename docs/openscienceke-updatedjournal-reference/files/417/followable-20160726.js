YUI.add("bepress.follow",function(e){var c=e.namespace("bepress.follow"),f="message_overlay",l='{message}            	<p class="close-window"><button type="button" class="follow_cancel close">x</button></p>            	<p>Please log in with your bepress Digital Commons or SelectedWorks account.</p>            	',u='<p> <a             			class="btn btn-mini pull-right"            			href="{signup_url}"><strong>Create a free account <i class="icon-arrow-right"></i></strong></a>            	</p>            	<hr />            	<form class="login-form">            		<p class="row-fluid">            			<label for="email" class="span4">Email:</label>            			<input class="follow_login span8" type="text" id="email" placeholder="you@email.com">            		</p>                	<p class="row-fluid">                		<label for="password" class="span4">Password:</label>                		<input type="password" class="follow_password span8" id="password">                	</p>                	<p class="row-fluid">                		<label for="save_password" class="span4">Remember Me:</label>                		<input type="checkbox" class="save_password" id="save_password" value="1">                	</p>                	<p class="row-fluid">                		<span class="forgot span8"><input                			type="submit"                			class="follow do_login btn btn-primary btn-mini"                			value="Sign in"><a                					href="{reset_url}" target="_new"><small>Forgot Password?</small></a></span>                	</p>                </form>',z='            	<form class="login-oidc-form">                	<p class="row-fluid">                		<span class="forgot span8"><input                			type="submit"                			class="follow do_oidc_login btn btn-primary btn-mini"                			value="Sign in"></span>                	</p>                </form>',m=l+u,p=l+z,F="<p><strong>Log in to {target}</strong></p>",D=/(http(?:s)?):\/\/(.+?)\//,B='<b class="{message_class}">{message}</b><p style="{style}">{details}</p>',I="bp",A="net",L=".followable",s=100,r,H=e.bepress.webservice.SWSRequest,j=e.bepress.webservice.ConfigLoader,t=e.bepress.webservice.getMessagePanel;new j(function(N){r=N;if(e.bepress.webservice.shouldDelayForTesting("__dflw")){setTimeout(function(){b();},5000);}else{b();}}).run();function K(R){var Q=R.getAttribute("data-follow-set").split(/[ ;]/),O={},N,P;for(P=0;P<Q.length;P++){N=Q[P].split(":");O[N[0]]=N[1];}return O;}function i(N){var Q=e.getLocation(),O=Q.host,P={path:"/"};if(N){if(N.expires){P.expires=new Date(N.expires);}if(!(/\bbepress\.com$/.exec(O)||/works\.qa1\.bdev\.us$/.exec(O))){e.bepress.webservice.setAuthCookie(N.cookie_name,N.cookie_value,P);}}}function d(N,S,Q,R){N.preventDefault();var P=window.location.pathname+"?",O="/cgi/login.cgi?return_to="+escape(P)+"&follow_subscribe="+escape(e.QueryString.stringify(Q));window.location=O;}function n(R,O,V,P){var N=R.target,T=N.one(".follow_login").get("value"),U=N.one(".follow_password").get("value"),Q=N.one(".save_password").get("checked"),S="email="+encodeURIComponent(T)+"&password="+encodeURIComponent(U);if(Q){S+="&save_password=1";}swsRequestConfig={method:"POST",data:S,"arguments":{eventNode:O,followSet:V,eventDate:P,loginName:T},on:{success:function(W,X){if(W.status=="OK"){i(W.update_authn);a(X.eventNode);panel=t(X.eventNode);panel.hide();}else{v("E_REJECTED",X.eventNode,X.followSet,X.eventDate,X.loginName);}},failure:function(W){panel=t(W.eventNode);panel.setMessage({message:h("E_GENERAL"),classnames:"error",details:""});panel.show(5000);}}};R.halt();new H(r[I].wsurl+"/login/login",swsRequestConfig);}var C={E_REJECTED:'<i class="icon-exclamation-sign"></i> The email address and/or password you entered is invalid.',E_GENERAL:"Oops!  An error occurred processing your<br>request.  Our team is investigating and will<br>fix the problem as soon as possible."};var J='<div class="{message_class}">{message}</div>';function h(P,O){var N=P?P:"";if(C[P]){N=e.substitute(J,{message_class:O?O:P.match(/^E_/)?"error":"note",message:C[P]});}return N;}function g(O){var N=e.stamp(O);e.all(".followable").each(function(Q){if(e.stamp(Q)!==N){var P=t(Q);if(P){P.hide();}}});}function v(O,P,V,Q,S){var R,T=h(O),N=K(P),U;g(P);panel=t(P);panel.set("headerContent",e.substitute(F,{target:P.get("title")}));if(r[I].oidc){panel.set("bodyContent",e.substitute(p,{message:T}));}else{U=r[I].wsurl+"/signup/?return_to="+escape(window.location)+"&follow_subscribe="+escape(e.QueryString.stringify(N))+"&login_site="+window.location.host;panel.set("bodyContent",e.substitute(m,{signup_url:U,reset_url:r[I].wsurl+"/reset",message:T}));}panel.show();R=panel.getOverlay().getStdModNode(e.WidgetStdMod.BODY);if(R.one("form.login-form")){R.one("form.login-form").on("submit",n,null,P,V,Q);}else{if(R.one("form.login-oidc-form")){R.one("form.login-oidc-form").on("submit",d,null,P,V,Q);}}R.one(".follow_cancel").on("click",function(){panel.hide();});if(R.one(".follow_login")){if(S){R.one(".follow_login").set("value",S);R.one(".follow_password").focus();}else{R.one(".follow_login").focus();}}}function M(N,O){if(N.reason==="NOT_AUTHORIZED"){v("",O.eventNode,O.followSet,O.eventDate);}else{panel=t(O.eventNode);panel.setMessage({message:h("E_GENERAL"),classnames:"error",details:e.dump(N),showDetails:N.is_dev?true:false});panel.show(5000);}}function y(O){var N=O.getData("initialClasses");if(N&&N.indexOf("followable-unsubscribe")>-1){O.set("innerHTML",O.getData("initialContent"));O.setAttribute("class",O.getData("initialClasses"));O.setAttribute("title",O.getData("initialTitle"));}else{O.set("innerHTML",'<i class="icon-ok"></i> Following');O.removeClass("btn-primary");O.addClass("following");}}function G(N){N.set("innerHTML",'<i class="icon-exclamation-sign icon-white"></i> Removed');N.removeClass("btn-danger");N.removeClass("followable-unsubscribe");N.addClass("btn-warning");N.set("title","Click to follow again.");}function a(R){var O=K(R),N=e.bepress.webservice.getAuthCookie(),P,Q=new Date();if(R.getData(f)){R.getData(f).hide();if(R.getData("hideTimer")){clearTimeout(R.getData("hideTimer"));R.setData("hideTimer",null);}}if(N){O.auth_cookie=N;}P=r[A].wsurl+"/follow/subscribe?"+e.QueryString.stringify(O);new H(P,{"arguments":{eventNode:R,followSet:O,eventDate:Q},on:{success:function(S,T){i(S.update_authn);if(S.status==="OK"){y(T.eventNode);}else{M(S,T);}},failure:function(S){M({status:"ERROR_HTTP"},S);}}});}function o(R){var O=K(R),N=e.bepress.webservice.getAuthCookie(),P,Q=new Date();if(R.getData(f)){R.getData(f).hide();if(R.getData("hideTimer")){clearTimeout(R.getData("hideTimer"));R.setData("hideTimer",null);}}if(N){O.auth_cookie=N;}P=r[A].wsurl+"/follow/unsubscribe?"+e.QueryString.stringify(O);new H(P,{"arguments":{eventNode:R,followSet:O,eventDate:Q},on:{success:function(S,T){i(S.update_authn);if(S.status==="OK"){G(T.eventNode);}else{M(S,T);}},failure:function(S){M({status:"ERROR_HTTP"},S);}}});}function E(U,S){var O=U.get("winHeight"),R=U.get("winWidth"),Q,W,N=x(U),P=x(S),V,T;if(document.documentElement&&typeof(document.documentElement.scrollTop)=="number"){Q=document.documentElement.scrollTop;W=document.documentElement.scrollLeft;}else{Q=document.body.scrollTop;W=document.body.scrollLeft;}if((N.left+N.width)+(P.width)<R-W){V=N.left+N.width;}else{if(N.left+(N.width/2)+P.width<R-W){V=N.left+(N.width/2);}else{V=(N.left+(N.width/2))-P.width;}}if(N.top+N.height+P.height<O+Q){T=N.top+N.height;}else{T=N.top-P.height;}return[V,T];}function x(O){var N={left:O.getX(),top:O.getY(),width:parseInt(O.get("offsetWidth")),height:parseInt(O.get("offsetHeight"))};return N;}function k(O){var P=O.target;while(P.get("nodeName")!=="A"){P=P.ancestor("a");}if(P.hasClass("followable-unsubscribe")){O.halt();o(P);}else{if(P.hasClass("following")){var N=e.substitute("{proto}//{host}/do/dcn/mgr/follows",{proto:r.protocol,host:r[I].host});P.setAttribute("href",N);P.setAttribute("target","_blank");}else{O.halt();a(P);}}}function w(N){if(!N.hasClass("followable-enabled")){N.addClass("followable-enabled");N.removeAttribute("onclick");N.on("click",k);N.setData("initialClasses",N.getAttribute("class"));N.setData("initialTitle",N.getAttribute("title"));N.setData("initialContent",N.get("innerHTML"));if(N.hasClass("followable-unsubscribe")){N.setData("canUnsubscribe",true);}N.setStyle("opacity",1);if(window.queuedFollows){e.Array.each(window.queuedFollows,function(O){if(O==N.getDOMNode()){a(N);}});}}}function q(){var N=e.all(L);N.each(w);if(!c.domReadyFired){e.later(s,null,q);}}function b(){var N=e.bepress.webservice.getAuthCookie(),O=e.all(L),P=r[A].wsurl+"/follow/list";q();if(N&&O.size()){new H(P,{data:"auth_cookie="+encodeURIComponent(N),on:{success:function(V,T){i(V.update_authn);if(V.status==="OK"){var U=0,R,Q,S=e.all(L);for(U=0;U<V.content.subscriptions.length;U++){R=V.content.subscriptions[U].split(";");Q=R.join(" ");S.each(function(W){if(W.getAttribute("data-follow-set")===Q){y(W);}});}}},failure:function(Q){}}});}}e.on("domready",function(){c.domReadyFired=true;});},"0.3",{requires:["bepress.webservice","bepress.followcss","dump"]});